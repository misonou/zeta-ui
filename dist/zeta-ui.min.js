/*! zeta UI v1.0.0-pre | https://github.com/misonou/zeta-ui | The MIT License (MIT) */

!function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o){"use strict";!function(){function m(){}function n(a){return f.isArray(a)&&a}function p(a){return"function"==typeof a&&a}function q(a){var b="object"==typeof a&&null!==a&&d.getPrototypeOf(a);return(b===d.prototype||null===b)&&a}function r(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||p(g)||(g={});h<i;h++)if(null!==(a=arguments[h]))for(b in a)c=g[b],d=a[b],g!==d&&(j&&d&&(q(d)||(e=n(d)))?(e?(e=!1,f=c&&n(c)?c:[]):f=c&&q(c)?c:{},g[b]=r(j,f,d)):void 0!==d&&(g[b]=d));return g}function s(a){if(p(a)||a===b)return!1;var c=!!a&&"length"in a&&a.length;return n(a)||0===c||"number"==typeof c&&c>0&&c-1 in a}function t(a,b){if(a){var c,d=0;if("string"==typeof a?a=a.split(" "):a instanceof o.Set&&(a=p(a.values)?a.values():function(a,b){return a.forEach(function(a){b[b.length]=a}),b}(a,[])),s(a))for(var e=a.length;d<e&&!1!==b(d,a[d++]););else if(p(a.entries))for(a=a.entries();!(c=a.next()).done&&!1!==b(c.value[0],c.value[1]););else if(p(a.forEach)){var f;a.forEach(function(a,c){f=!1===f||b(c,a)})}else if(p(a.next))for(;!(c=a.next()).done&&!1!==b(d++,c.value););else if(p(a.nextNode))for(;(c=a.nextNode())&&!1!==b(d++,c););else for(d in a)if(!1===b(d,a[d]))return}}function u(a,b){var c=[];return t(a,function(a,d){var e=b.call(this,d,a);null!==e&&void 0!==e&&(n(e)?c.push.apply(c,e):c[c.length]=e)}),c}function v(a,b){var c;return t(a,function(a,d){return!(c=b.call(this,d,a)&&d)}),c}function w(a,b){var c;return t(a,function(a,d){return!(c=b.call(this,d,a))}),c}function x(a,b){var c={};return c[a]=b,c}function y(a){if(n(a))return a.slice(0);if("string"==typeof a)return[a];if(a&&(s(a)||p(a.forEach))){var b=[];return t(a,function(a,c){b[b.length]=c}),b}return null!==a&&void 0!==a?[a]:[]}function z(a){if(!a[0])return Ua();var b,c=$.Deferred(),d=a.length;return t(a,function(a,e){B(e,function(a){b|=!a,0==--d&&c[b?"reject":"resolve"]()})}),c.promise()}function A(a){return $.Deferred().reject(a).promise()}function B(a,b){a.then(function(a){b(!0,a)},function(a){b(!1,a)})}function C(a,b){return b=b||a.currentNode,b&&a.whatToShow&(V(b,h)?1<<b.nodeType-1:b.nodeType)?a.filter?(a.filter.acceptNode||a.filter).call(a.filter,b):1:3}function D(a,b,c,d){var e=0;switch(a.currentNode=c=c||a.currentNode,b=b||m,C(a)){case 2:return;case 1:b(c,e++)}for(var f;(f=a.nextNode())&&(!d||(p(d)?d(f):f!==d||void b(f,e++)));b(f,e++));}function E(a,b,c,d){var e=[];return D(a,function(a){e[e.length]=a},c,d),b?u(e,b):e}function F(){var a=new o.WeakMap;return function(b,c){return c&&a.set(b,c),c||a.get(b)}}function G(a,b,c){return a.get(b)||c&&(a.set(b,new c),a.get(b))}function H(a){var b={};return t(d.getOwnPropertyNames(a||{}),function(c,e){b[e]=d.getOwnPropertyDescriptor(a,e)}),b}function I(a,b,c,d){Ra(a,b,{configurable:!0,enumerable:!0,get:c,set:d})}function J(a,b,c){Ra(a,b,{configurable:!0,enumerable:!1,writable:!0,value:c})}function K(a,b){t(H(b),function(b,c){c.enumerable=!p(c.value),Ra(a.prototype,b,c)})}function L(a,b){var c=d.create(p(a)?a.prototype:a||d.prototype);return t(H(b),function(a,b){Ra(c,a,b)}),c}function M(){return g.random().toString(36).substr(2,8)}function N(a,b){return new f(b+1).join(a)}function O(a){return e(a).replace(/-([a-z])/g,function(a,b){return b.toUpperCase()})}function P(a){return e(a).replace(/[A-Z](?![A-Z])|[A-Z]{2,}(?=[A-Z])/g,function(a,b){return(b?"-":"")+a.toLowerCase()})}function Q(a){return a=e(a||""),a.charAt(0).toUpperCase()+a.slice(1)}function R(a){return a=e(a||""),a.charAt(0).toLowerCase()+a.slice(1)}function S(a){return e(a||"").replace(/^(?:\u200b|[^\S\u00a0])+|(?:\u200b|[^\S\u00a0])+$/g,"")}function T(a,b){return(Wa[b]||(Wa[b]=new k("(?:^|\\s)("+b.replace(/\s+/g,"|")+")(?=$|\\s)"))).test(e(a||""))&&k.$1}function U(a){return a&&a.tagName&&a.tagName.toLowerCase()}function V(a,b){return!(!a||!b)&&(b.prototype?a instanceof b&&a:b.toFixed?a.nodeType&b&&a:("*"===b||U(a)===b||$(a).is(b))&&a)}function W(a,b){if(U(a)!==U(b))return!1;var c=a.attributes,d=b.attributes;return c.length===d.length&&!v(c,function(a){return!d[a.nodeName]||a.value!==d[a.nodeName].value})}function X(a,b,c){if(a===b)return 0;var d=a&&b&&Pa.call(a,b);return 2&d?c&&8&d||1&d?NaN:1:4&d?c&&16&d||1&d?NaN:-1:NaN}function Y(a,b){return a&&b&&!(1&Pa.call(a.commonAncestorContainer||a,b.commonAncestorContainer||b))}function Z(a,b){return a=(a||"").element||a,b=(b||"").element||b,a===b||$.contains(a,b)}function _(a,b){for(b=b||a;a&&a!==b&&20!==Pa.call(a,b);a=a.parentNode);return a}function aa(a,b){var c=a.length||a.childNodes.length;return 1/b<0?g.max(0,c+b):g.min(c,b)}function ba(a,b,d,e){if(a&&p(a.getRange))return a.getRange();var f;if(V(a,h)?(f=c.createRange(),+b!==b?(f["contents"!==b&&a.parentNode?"selectNode":"selectNodeContents"](a),"boolean"==typeof b&&f.collapse(b)):f.setStart(a,aa(a,b)),V(d,h)&&Y(a,d)&&f.setEnd(d,aa(d,e))):V(a,i)&&(f=a.cloneRange(),f.collapsed||"boolean"!=typeof b||f.collapse(b)),V(b,i)&&Y(f,b)){var g=f.collapsed&&b.collapsed?-1:1;Qa.call(f,0,b)*g<0&&f.setStart(b.startContainer,b.startOffset),Qa.call(f,2,b)*g>0&&f.setEnd(b.endContainer,b.endOffset)}return f}function ca(a,b){return a=V(a,i)||ba(a),b=V(b,i)||ba(b),Y(a,b)&&Qa.call(a,3,b)<=0&&Qa.call(a,1,b)>=0}function da(a,b){return a=V(a,i)||ba(a),b=V(b,i)||ba(b),Y(a,b)&&Qa.call(a,0,b)<=0&&Qa.call(a,2,b)>=0}function ea(a,b){return a=V(a,i)||ba(a),b=V(b,i)||ba(b),Y(a,b)&&0===Qa.call(a,0,b)&&0===Qa.call(a,2,b)}function fa(a,b,c){a=V(a,i)||ba(a),b=V(b,i)||ba(b);var d=Y(a,b)?Qa.call(a,0,b)+Qa.call(a,2,b):NaN;return c&&(0!==d&&ca(a,b)||0===d&&!ea(a,b))?NaN:d&&d/g.abs(d)}function ga(a,d){var e;if(a=a||Va,a.getRect)return a.getRect();if((a=a.element||a)===Va||a===b){Z(c.body,Xa)||c.body.appendChild(Xa);var f=ga(Xa);e=ia(0,0,Va.offsetWidth,Va.offsetHeight).translate(f.left,f.top)}else if(Z(Va,a)){if(e=ia(a.getBoundingClientRect()),d){var h=Ta(a);e.top-=g.max(0,l(h.marginTop)),e.left-=g.max(0,l(h.marginLeft)),e.right+=g.max(0,l(h.marginRight)),e.bottom+=g.max(0,l(h.marginBottom))}}else e=ia(0,0,0,0);return e}function ha(a){return u((V(a,i)||ba(a,"contents")).getClientRects(),ia)}function ia(a,b,c,d){function e(a){return g.round(1e3*a)/1e3}return void 0!==a.top?new Ja(e(a.left),e(a.top),e(a.right),e(a.bottom)):void 0===c?new Ja(a,b,a,b):new Ja(a,b,c,d)}function ja(a,b){function c(c){return g.abs(a[c]-b[c])<1}return c("left")&&c("top")&&c("bottom")&&c("right")}function ka(a,b){return b.left>=a.left&&b.right<=a.right&&b.top>=a.top&&b.bottom<=a.bottom}function la(a,b,c,d){return d=d||0,c.width&&c.height&&a-c.left>=-d&&a-c.right<=d&&b-c.top>=-d&&b-c.bottom<=d}function ma(a,b){return ia(g.min(a.left,b.left),g.min(a.top,b.top),g.max(a.right,b.right),g.max(a.bottom,b.bottom))}function na(a,b,d){if(d=d||c.body,Oa)return v(Oa.call(c,a,b),function(a){return Z(d,a)&&"none"!==Ta(a).pointerEvents})||null;var e=c.elementFromPoint(a,b);if(!Z(d,e)&&la(a,b,ga(d))){var f=[];try{for(;X(d,e,!0);){var g=$(e).parentsUntil(_(d,e)).slice(-1)[0]||e;if(g===f[f.length-1])return null;g.style.pointerEvents="none",f[f.length]=g,e=c.elementFromPoint(a,b)}}finally{$(f).css("pointer-events","")}}return Z(d,e)?e:null}function oa(a){return V(a,j)||$(c.createDocumentFragment()).append(a)[0]}function pa(a){return c.createTextNode(a||"​")}function qa(a){return c.createElement(a)}function ra(a,b,d){return c.createNodeIterator(a,b,p(d)||null,!1)}function sa(a,b,c,d,e){q(c)?t(c,function(c,e){b[a](c,e,d)}):t(c.split(" "),function(c,f){b[a](f,d,e)})}function ta(a,b,c,d){return sa("addEventListener",a,b,c,d),function(){ua(a,b,c)}}function ua(a,b,c){sa("removeEventListener",a,b,c)}function va(a){a.parentNode&&a.parentNode.removeChild(a)}function wa(a,b){var c=new k("(?:^|\\s)\\s*"+b+"(?:-(\\S+)|\\b)$","ig"),d=[!1];return(a.className||"").replace(c,function(a,b){d[b?d.length:0]=b||!0}),d[1]?d.slice(1):d[0]}function xa(a,b,c){var d=new k("(^|\\s)\\s*"+b+"(?:-(\\S+)|\\b)|\\s*$","ig"),e=0;q(c)&&(c=u(c,function(a,b){return a?b:null})),a.className=(a.className||"").replace(d,function(){return e++||!c||0===c.length?"":" "+b+(c[0]?[""].concat(c).join(" "+b+"-"):"")})}function ya(a){if(!Y(Va,a))return!1;var b=ga(a);if(!(b.top||b.left||b.width||b.height))for(var c=a;c;c=c.parentNode)if("none"===Ta(c).display)return!1;return!0}function za(a,b){var c=Ta(a,b||null);return T(c.position,"absolute fixed relative")&&"auto"!==c.zIndex?parseInt(c.zIndex):-1}function Aa(a){var b=-1;return D(c.createTreeWalker(c.body,1,function(c){if(X(c,a,!0))return 2;var d=za(c);return d>=0?(b=g.max(b,d),2):(b=g.max(b,za(c,"::before"),za(c,"::after")),1)},!1)),b+1}function Ba(a,b){a.style.zIndex=Aa(b),"static"===Ta(a).position&&(a.style.position="relative")}function Ca(a,c,d,e){var f=ga(V(e||d,h)||b),g=T(d||c,"left right")||"left",i=T(d||c,"top bottom")||"top",j={};return c=(0|(a.top||a.clientY||a.y||c))-f.top,a=(0|(a.left||a.clientX||a.x||a))-f.left,j[g]=("left"===g?a:f.width-a)+"px",j[i]=("top"===i?c:f.height-c)+"px",j[Ma[g]]="auto",j[Ma[i]]="auto",j}function Da(a,b){var c=Ca(a,null,b);return c.width=(0|a.width)+"px",c.height=(0|a.height)+"px",c}function Ea(a,b,d,e){Z(Va,a)||c.body.appendChild(a),$(a).css({position:"fixed",maxWidth:"",maxHeight:""});var f=q(b)||!b?{}:ga(b);"left"in f||(f.left=f.right=0|(b.left||b.clientX||b.x),f.top=f.bottom=0|(b.right||b.clientY||b.y));var h=T(d,"inset-x inset-y inset")||"inset-x",i="inset"===h?f:ga(e),j=ga(a,!0),k={},l={},m={transform:""},n=function(a,b,c,d,e,h){if(m[e]=i[d]+k[c]-k[Ma[c]],!Ma[a]){var n=(f[Ma[c]]+f[c])/2;return a=n-i[c]<j[d]/2?c:i[Ma[c]]-n<j[d]/2?Ma[c]:"",a||(m.transform+=" "+h),l[c]=a?i[a]:n+k[c],a}var o=b?Ma[a]:a;if(f[a]*Na[o]+j[d]<=i[o]*Na[o])l[c]=f[a]+k[Ma[o]];else{if(!(f[Ma[a]]*Na[o]-j[d]>i[Ma[o]]*Na[o]))return l[c]=i[a],m[e]=b?m[e]:g.abs(f[a]-l[c])-Na[a]*k[a],a;a=Ma[a],l[c]=f[a]+k[o]}return b||(a=Ma[a]),m[e]=g.abs(i[Ma[a]]-l[c]),a},o=ga(a);Sa(Ma).forEach(function(a){k[a]=j[a]-o[a]});var p=T(d,"left right center")||"left",s=T(d,"top bottom center")||"bottom",t=n(p,Ma[s]&&"inset-x"===h,"left","width","maxWidth","translateX(-50%)"),u=n(s,Ma[p]&&"inset-y"===h,"top","height","maxHeight","translateY(-50%)");$(a).css(r(m,Ca(l,t+" "+u)))}function Fa(a){var b={};return t(a,function(c,d){b[d]=a[d]}),b}function Ga(a,b){return/\b(?:[+-]?(\d+(?:\.\d+)?)(px|%)?|#[0-9a-f]{3,}|(rgba?|hsla?|matrix|calc)\(.+\))\b/.test(a)&&(b||!k.$1||k.$2)}function Ha(a){return a.replace(/^-(webkit|moz|ms|o)-/,"")}function Ia(a,b){xa(a,b,!0);var c=E(ra(a,1,function(a){var b=Ta(a);return"0s"!==b.transitionDuration||"none"!=b.animationName}));if(!c[0])return Ua();xa(a,b,!1),$(c).css("transition","none"),xa(a,b,!0);var d=c.map(function(a){return Fa(Ta(a))});xa(a,b,!1);var e=new o.Map;if(t(c,function(a,b){var c=Ta(b),f={};t(c,function(b,e){var g=c[e],h=d[a][e];if(g!==h){var i=Ha(e),j=T(e,"opacity line-height");if("animation-name"===i){var k=g.replace(/,/g,"");t(h.split(/,\s*/),function(a,b){"none"===b||T(k,b)||(f["@"+b]=!0)})}else Ga(g,j)&&Ga(h,j)&&!/^scroll-limit/.test(i)&&(f[i]=!0)}}),Sa(f)[0]&&e.set(b,f)}),$(c).css("transition",""),xa(a,b,!0),!e.size)return Ua();var f=$.Deferred(),g=function(b){var c=e.get(b.target)||{};delete c[T(b.type,La)?Ha(b.propertyName):"@"+b.animationName],Sa(c)[0]||!e.delete(b.target)||e.size||(ua(a,Ka+" "+La,g),f.resolveWith(a,[a]))};return ta(a,Ka+" "+La,g),f.promise()}function Ja(a,b,c,d){var e=this;e.left=a,e.top=b,e.right=c,e.bottom=d}var Ka="animationend oanimationend webkitAnimationEnd",La="transitionend otransitionend webkitTransitionEnd",Ma={top:"bottom",left:"right",right:"left",bottom:"top"},Na={top:-1,left:-1,right:1,bottom:1},Oa=c.msElementsFromPoint||c.elementsFromPoint,Pa=c.compareDocumentPosition,Qa=i.prototype.compareBoundaryPoints,Ra=d.defineProperty,Sa=d.keys,Ta=b.getComputedStyle,Ua=a.when,Va=c.documentElement,Wa={},Xa=$('<div style="position:fixed; top:0; left:0;">')[0];K(Ja,{get width(){return this.right-this.left},get height(){return this.bottom-this.top},get centerX(){return(this.left+this.right)/2},get centerY(){return(this.top+this.bottom)/2},collapse:function(a){var b=this;return"left"===a||"right"===a?ia(b[a],b.top,b[a],b.bottom):ia(b.left,b[a],b.right,b[a])},translate:function(a,b){var c=this;return ia(c.left+a,c.top+b,c.right+a,c.bottom+b)}});var Ya={IS_IOS:/iPad|iPhone|iPod/.test(navigator.userAgent)&&!b.MSStream,IS_IE10:!!b.ActiveXObject,IS_IE:!!b.ActiveXObject||void 0!==Va.style.msTouchAction||void 0!==Va.style.msUserSelect,IS_MAC:navigator.userAgent.indexOf("Macintosh")>=0,IS_TOUCH:"ontouchstart"in b};Ya.shim={MutationObserver:o.MutationObserver,WeakMap:o.WeakMap,Map:o.Map,Set:o.Set},Ya.helper={extend:r,noop:m,isArray:n,isFunction:p,isPlainObject:q,each:t,map:u,any:v,single:w,kv:x,makeArray:y,iterate:D,iterateToArray:E,mapGet:G,createPrivateStore:F,getOwnPropertyDescriptors:H,defineGetterProperty:I,defineHiddenProperty:J,definePrototype:K,inherit:L,randomId:M,repeat:N,camel:O,hyphenate:P,ucfirst:Q,lcfirst:R,trim:S,matchWord:T,tagName:U,is:V,isVisible:ya,sameElementSpec:W,comparePosition:X,connected:Y,containsOrEquals:Z,getCommonAncestor:_,createRange:ba,rangeCovers:da,rangeEquals:ea,rangeIntersects:ca,compareRangePosition:fa,getRect:ga,getRects:ha,toPlainRect:ia,rectEquals:ja,rectCovers:ka,pointInRect:la,mergeRect:ma,elementFromPoint:na,createDocumentFragment:oa,createTextNode:pa,createElement:qa,createNodeIterator:ra,getState:wa,setState:xa,getZIndex:za,getZIndexOver:Aa,setZIndexOver:Ba,cssFromPoint:Ca,cssFromRect:Da,runCSSTransition:Ia,position:Ea,removeNode:va,bind:ta,unbind:ua,when:Ua,waitAll:z,reject:A,always:B},b.zeta=Ya}(),function(a,i){function j(a){return a.isContentEditable||qa(a,"input,textarea,select")}function k(a){for(var b=[];a&&a!==c&&b.push(a);a=a.parentNode||a.parent);return b}function l(){var a=b.event&&b.event.type;return a&&ya("k"===a[0]?"keyboard":"t"===a[0]?"touch":"m"===a[0]||ya(a,"wheel click dblclick contextmenu")?"mouse":a,_)||"script"}function n(a){for(var b=a;b&&!Da.has(b);b=b.parentNode);return xa(Da,b)||V}function p(a,d){return a===b?!Y:Ga.has(a)&&(!d||la(a,c.activeElement))}function q(a){var b=wa(k(a),function(a){return Ea.get(a)});return ja(Fa,function(c){return la(c,a)||b.indexOf(c)>=0})}function r(b){return Aa(Ha,function(c,d){return a(c).find(b)[0]&&d})}function s(a,b,c,d,e,f){var g=new H(a,V,c,d,b,e,f);return g.emit(U,"tap",n(c).element,!1)||g.emit()}function t(a,b,c,d,e){var f=null;return ja(va(c),function(c){var g=n(c);if(f!==g){if(f=g,s(a,b,c,d,e))return!0;if("keystroke"===a)return s(d,b,c,null,!0)||"space"===d&&j(c)&&s("textInput",b,c," ",!0)}})}function u(a,b,c,d,e){na(c,function(c,f){Ga[b](f),Da.has(f)&&s(a,null,f,{relatedTarget:d},!1,e)})}function v(b,d,e){if(la(Ca,b)){if(Fa[0]){var f=q(b);if(!f){var g=r(b);b=p(g)?Fa[0]:g,f=q(b)}if(!f)return!1;u("focusout","delete",Fa.splice(0,Fa.indexOf(f)),b,e)}if(la(Ca,b)){d&&!qa(b,aa)&&(b=a(aa,b).filter(":visible:not(:disabled,.disabled)")[0]||b);var h=k(b).filter(function(a){return!Ga.has(a)}),i=wa(h,function(a){return Ea.get(a)})[0];if(i&&!p(i)){var j=v(i);if(void 0!==j)return j&&v(b)}return h[0]&&(Fa.unshift.apply(Fa,h),u("focusin","add",h,null,e||new E(h[0],Fa))),la(Fa[0],c.activeElement)||new A(Fa[0]).focus(),!0}}}function w(a){for(;a!==Ca&&"visible"===ia(a).overflow;a=a.parentNode);return a}function x(a,b){var c=w(a),d=new A(c),e=d.getUnobscuredRect(a);b=b||pa(a);var f=g.max(0,b.right-e.right)||g.min(b.left-e.left,0),h=g.max(0,b.bottom-e.bottom)||g.min(b.top-e.top,0),i=f&&h?d.scrollBy(f,h):ca;if(c!==Ca){var j=x(c.parentNode,b.translate(i.x,i.y));j&&(i.x+=j.x,i.y+=j.y)}return!(!i.x&&!i.y)&&i}function y(a,c){if(ta(a)&&(c.to===b||ta(c.to))){var d=c.dir;if("auto"===d)if(c.to===b)d="center inset";else{var e=pa(),f=pa(w(c.to)),h=[e.height*(f.left-e.left),e.height*(e.right-f.right),e.width*(f.top-e.top),e.width*(e.bottom-f.bottom)];d="left right top bottom".split(" ")[h.indexOf(g.max.apply(null,h))]+" center"}ha.position(a,c.to,d)}}function z(b,d,e){var f,g=a.Deferred(),i=b,j=w(qa(d,h)||b.target),k={keydown:function(a){27===a.which&&(g.reject(),k.mouseup(a))},mousemove:function(a){if(!a.which)return void k.mouseup(a);a.clientX===i.clientX&&a.clientY===i.clientY||(i=a,g.notify(a.clientX,a.clientY)),a.preventDefault()},mouseup:function(b){clearInterval(f),a(c.body).off(k),a(j).off(l),g.resolve()}},l={mouseout:function(a){f||la(j,a.relatedTarget)&&(j!==Ca||a.relatedTarget!==Ca)||(f=setInterval(function(){x(j,ha.toPlainRect(i.clientX-50,i.clientY-50,i.clientX+50,i.clientY+50))?g.notify(i.clientX,i.clientY):(clearInterval(f),f=null)},20))},mouseover:function(a){a.target!==Ca&&(clearInterval(f),f=null)}};return a(c.body).on(k),a(j).on(l),g.promise().progress(e||d)}function A(a){this.element=a}function B(a){(new A)[a]||(A.prototype[a]=function(){var b=this.support(a);return b?b.apply(null,arguments):console.warn("Method "+a+" not handled",this.element)})}function C(a){Ka.push(a),na(a,function(a,b){ra(b)&&"canHandle"!==a&&"support"!==a&&B(a)})}function D(a,b){var c=(xa(Da,a)||"").context,d=c&&(ra(c[b])||ra(c.support)&&ra(c.support(b)));return d?d.bind(c):!!(d=xa(La,a,function(){var b={};return na(Ka,function(c,d){d.element&&!qa(a,d.element)||d.canHandle&&!d.canHandle(a)||oa(b,d)}),b})[b])&&d.bind(a,a)}function E(a,b){var c=this;b=b||(X?X.path:Fa.slice(0)),c.path=b,c.source="script",(la(b[0]||Ca,a)||b.indexOf(a)>=0)&&(c.source=X?X.source:l()),c.sourceKeyName="keyboard"!==c.source?null:(X||W||"").sourceKeyName}function F(a,b,c,d){var e=oa(this,a.properties);e.eventName=b,e.context=c.context,e.target=la(a.target,c.element)?c.element:a.target,e.data=null,e.context.typer&&(e.typer=e.context.typer,e.widget=e.context),sa(d)?oa(e,d):void 0!==d&&(e.data=d),Pa(e,a)}function G(a,b,c){var d=this,e={};na(c,function(a,b){ra(b)&&(e[a]=b)}),d.element=a,d.context=b,d.handlers=e}function H(a,b,c,d,e,f,g){c=c||b.element,g=g||new E(c);var h={source:g.source,sourceKeyName:g.sourceKeyName,timestamp:performance.now(),originalEvent:e||null};oa(this,{container:b,eventName:a,target:c,data:d,bubbles:f,properties:h,sourceObj:g},h)}function I(){this.states={}}function J(a,b){var c=this;a&&Da.set(a,c),c.element=a||Ca,c.context=b||null,c.components=new fa,c.asyncEvents=new fa,c.autoDestroy=la(Ca,a),a&&Da.set(a,c)}function K(a){for(a.timeout=null;a.asyncEvents.size;){var b=a.asyncEvents;a.asyncEvents=new fa,na(b,function(a,b){na(b,function(b,c){sa(a)&&!a.handlers[b]||c.emit(null,null,a)})}),na(b,function(b,c){var d=xa(a.components,b.element||b);d&&!d.attached&&a.components.delete(b.element||b)})}}function L(a,b,c){var d=xa(a.asyncEvents,c);if(d&&d[b]){var e=d[b].data;return delete d[b],e||{data:e}}}function M(a,b,c,e,f,g){var h=xa(a.asyncEvents,c,d);h[b]=new H(b,a,c.element||c,g&&h[b]?g(h[b].data,e):e,null,f),a.timeout=a.timeout||m(K,null,a)}function N(a,b,c){var d=["destroy","init"];b.attached^c&&!L(a,d[+!c],b)&&M(a,d[+c],b),b.attached=c}function O(a,b){return a===U||(Da.get(b)||a)===a}function P(a,b,c){function d(d){var e=[],g=new fa;na(d,function(b,c){("id"!==c.attributeName||"sizzle"!==(c.oldValue||"").slice(0,6)&&c.target.id!==(c.oldValue||""))&&(la(a.element,c.target)?O(a,c.target)&&(na(c.removedNodes,function(a,b){g.has(b)&&e.push.apply(e,g.get(b))}),e.push(c)):xa(g,c.target,f).push(c))}),e=e.filter(function(a){return c[a.type]}),e[0]&&b(e)}var e=oa({},c);e.subtree=!0,e.childList=!0,e.attributeOldValue|=c.attributes;var g=new da(d);return g.observe(a.element,e),function(){d(g.takeRecords())}}function Q(a,b){for(var c,d=b;d&&!c;d=d.parentNode)c=a.components.get(d);return c||null}function R(a,b,c){var d=xa(a.components,b,I);if((d.context||c)!==c)throw new Error("Element has already been set to another context");return d.element=b,d.context=c,d}function S(a){this.element=a,Ia.set(a,this),Pa(this,{promises:new fa})}function T(a,b){var c;return function(){return c||(c=Ba(a()).then(b,function(){return c=null,za("user_cancelled")}))}}var U,V,W,X,Y,Z,$=JSON.parse('{"8":"backspace","9":"tab","13":"enter","16":"shift","17":"ctrl","18":"alt","19":"pause","20":"capsLock","27":"escape","32":"space","33":"pageUp","34":"pageDown","35":"end","36":"home","37":"leftArrow","38":"upArrow","39":"rightArrow","40":"downArrow","45":"insert","46":"delete","48":"0","49":"1","50":"2","51":"3","52":"4","53":"5","54":"6","55":"7","56":"8","57":"9","65":"a","66":"b","67":"c","68":"d","69":"e","70":"f","71":"g","72":"h","73":"i","74":"j","75":"k","76":"l","77":"m","78":"n","79":"o","80":"p","81":"q","82":"r","83":"s","84":"t","85":"u","86":"v","87":"w","88":"x","89":"y","90":"z","91":"leftWindow","92":"rightWindowKey","93":"select","96":"numpad0","97":"numpad1","98":"numpad2","99":"numpad3","100":"numpad4","101":"numpad5","102":"numpad6","103":"numpad7","104":"numpad8","105":"numpad9","106":"multiply","107":"add","109":"subtract","110":"decimalPoint","111":"divide","112":"f1","113":"f2","114":"f3","115":"f4","116":"f5","117":"f6","118":"f7","119":"f8","120":"f9","121":"f10","122":"f11","123":"f12","144":"numLock","145":"scrollLock","186":"semiColon","187":"equalSign","188":"comma","189":"dash","190":"period","191":"forwardSlash","192":"backtick","219":"openBracket","220":"backSlash","221":"closeBracket","222":"singleQuote"}'),_="script mouse touch keyboard input drop cut copy paste",aa=":input, [contenteditable], a[href], area[href], iframe",ba=[16,17,18,91,93],ca={x:0,y:0},da=o.MutationObserver,ea=o.WeakMap,fa=o.Map,ga=o.Set,ha=i.helper,ia=b.getComputedStyle,ja=ha.any,ka=ha.bind,la=ha.containsOrEquals,ma=ha.definePrototype,na=ha.each,oa=ha.extend,pa=ha.getRect,qa=ha.is,ra=ha.isFunction,sa=ha.isPlainObject,ta=ha.isVisible,ua=ha.kv,va=ha.makeArray,wa=ha.map,xa=ha.mapGet,ya=ha.matchWord,za=ha.reject,Aa=ha.single,Ba=ha.when,Ca=c.documentElement,Da=new ea,Ea=new ea,Fa=[],Ga=new ga,Ha=new fa,Ia=new ea,Ja=new fa,Ka=[],La=new ea,Ma=new ea,Na={},Oa={},Pa=ha.createPrivateStore();ma(A,{support:function(a){return D(this.element,a)}}),ma(F,{handled:function(a){var b=Pa(this);b.handled||(b.handled=Ba(a))},isHandled:function(){return!!Pa(this).handled},preventDefault:function(){var a=this.originalEvent;a?a.preventDefault():Pa(this).defaultPrevented=!0},isDefaultPrevented:function(){return!!(this.originalEvent||Pa(this)).defaultPrevented}}),ma(H,{emit:function(a,b,c,d){var e=this;a=a||e.container,d=void 0===d?e.bubbles:d;var f=function(b,c,d,f){if("init"===c||"destroy"===c){if(b.lastEvent===c)return!1;b.lastEvent=c}var g=b.handlers[c||d];if(!g)return!1;var h=qa(b.context,J)||a,i=new F(e,d,b,void 0===f?L(a,d,b):f),j=X,k=h.event;h.event=i,X=e.sourceObj;try{var l=g.call(i.context,i,i.context);void 0!==l&&(e.handled=Ba(l))}catch(a){console.error(a),e.handled=za(a)}if(X=j,h.event=k,e.handled&&"mouse"===e.source){var m=Fa[0];ha.always(e.handled,function(){if(m===Fa[0])for(var a=n(m),b=1,c=Fa.length;b<c;b++)if(!la(Fa[b],Fa[b-1])&&n(Fa[b])!==a){v(Fa[b]);break}})}return e.handled};if(qa(c,G))return f(c,b,e.eventName,e.data);var g=a.getContext(c||e.target);return Aa((d?k:va)(g),function(c){var d=a.components.get(c.element||c);return d&&Aa(d.states,function(a){return f(a,b,e.eventName,e.data)})})}}),ma(J,{event:null,tap:function(a){U.setContext(this.element,this),U.add(this.element,{tap:a})},getContext:function(a){return(Q(this,a)||"").context},setContext:function(a,b){R(this,a,b),this!==U&&qa(a,h)&&Da.set(a,this)},add:function(a,b,c){"string"!=typeof b&&(c=b,b=ha.randomId());var d=this,e=qa(a,h)||a.element||a,f=qa(e,h)?Q(d,e):R(d,a,a);if(!f||f.states[b])return!1;var g=new G(e,qa(a,h)?f.context:a,c);return f.attached=!0,f.states[b]=g,N(d,g,!0),b},delete:function(a,b){var c=this,d=xa(c.components,a);if(d)if(b){var e=d.states[b];e&&(delete d.states[b],N(c,e,!1))}else d.attached=!1,na(d.states,function(a,b){N(c,b,!1)})},observe:function(a,b){return P(this,a,b)},emit:function(a,b,c,d){return(qa(a,F)?Pa(a):new H(a,this,b,c,null,d)).emit(this,null,b,d)},emitAsync:function(a,b,c,d,e){M(this,a,b||this.element,c,d,e)},flushEvents:function(){K(this)},destroy:function(){var a=this;U.delete(a.element),Da.delete(a.element),na(a.components,function(b,c){Da.delete(b),a.emit("destroy",b)})}}),ma(S,{get locked(){return Pa(this).promises.size>0},cancel:function(a){var b=this,c=Pa(b),d=c.promises;return a||!d.size?(d.size&&s("cancelled",null,b.element),d.clear(),c.handler=null,c.deferred&&c.deferred.resolve(),Ba()):(c.handler||(c.handler=T(function(){return va(d).reduce(function(a,b){return a.then(b)},Ba()).then(function(){b.cancel(!0)})})))()},wait:function(b,c){var d=this,e=Pa(d),f=e.promises,g=function(){f.delete(b)&&!f.size&&(s("asyncEnd",null,d.element),d.cancel(!0))};if(f.set(b,T(!0===c?Ba:c||za,g)),1===f.size){e.deferred=a.Deferred();for(var h=d.element.parentNode;h&&!Ia.has(h);h=h.parentNode);h&&Ia.get(h).wait(e.deferred,d.cancel.bind(d)),s("asyncStart",null,d.element)}return b.catch(function(a){a&&!Ma.has(a)&&(s("error",null,d.element,{error:a},!0),"object"==typeof a&&Ma.set(a,!0)),g()}),b.then(function(a){var c=!f.has(b);return g(),c?za("user_cancelled"):a})}}),U=new J,V=new J;var Qa={drag:z,scrollIntoView:x,focused:p,get activeElement(){return Fa[0]},get eventSource(){return l()},getContext:function(a){return n(a||Fa[0]).context},focus:function(a){if(ha.isArray(a)){var b=1/0;a=ja(a,function(a){var c=pa(a);return c.width&&c.height&&(b=g.min(b,c.top))===c.top})}v(a,!0)},setModal:function(a,b){var d=qa(b,h)||Ca;p(d)||v(d),Ha.set(a,Fa.splice(0,d===Ca||c.body?Fa.length:Fa.indexOf(d))),v(a,!0)},lock:function(a,b,c){var d=Ia.get(a)||new S(a);return b?d.wait(b,c):Ba()},locked:function(a,b){return!!ja(b?k(a):[a],function(a){return(Ia.get(a)||"").locked})},cancel:function(a,b){var c=Ia.get(a);return c?c.cancel(b):Ba()},getEventScope:function(a){var b=new E(a);return{source:b.source,sourceKeyName:b.sourceKeyName,wrap:function(a){return function(){var c=X;try{return X=b,a.apply(this,arguments)}finally{X=c}}}}},emit:function(a,b,c,d){return s(a,null,b,c,d)},on:function(a,b,c){qa(a,h)||(c=b,b=a,a=Ca),V.setContext(a,a),V.add(a,sa(b)||ua(b,c))},retainFocus:function(a,b){Ea.set(b,a)},releaseFocus:function(a,b){Ea.delete(b)},mixin:function(a){return qa(a,h)?new A(a):C(a)},support:function(a,b){var c=n(Fa[0]);return Aa(Fa,function(d){return(!b||n(d)!==c)&&D(d,a)})},snap:function(a,d,e){d=d||Ca;var f={to:d,dir:e||"left bottom"};Ja.set(a,f),la(Ca,a)||c.body.appendChild(a),ha.setZIndexOver(a,d===b?c.body:d),y(a,f)},unsnap:function(a){Ja.delete(a)},getShortcut:function(a){return Oa[a]?Oa[a].slice(0):[]},setShortcut:function(a,b){if(sa(a))return void na(a,Qa.setShortcut);var c=Oa[a]||(Oa[a]=[]),d=c.slice(0);na(b,function(b,e){var f=d.indexOf(e);f>=0?d.splice(f,1):(c[c.length]=e,(Na[e]||(Na[e]={}))[a]=!0)}),na(d,function(b,d){c.splice(c.indexOf(d),1),delete Na[d][a]})}};i.Container=J,i.dom=Qa,Qa.setShortcut({undo:"ctrlZ",redo:"ctrlY ctrlShiftZ",selectAll:"ctrlA"}),Qa.on("keystroke",function(a){var b=Aa(Na[a.data],function(a,b){return Qa.support(b)});return b&&a.handled(b())}),Qa.on("escape",function(a){v(c.body)}),Qa.lock(c),b.onbeforeunload=function(a){Qa.locked(c)&&(a.returnValue="",a.preventDefault())},a(function(){function d(a,b){var c=(a.ctrlKey||a.metaKey?"Ctrl":"")+(a.altKey?"Alt":"")+(a.shiftKey?"Shift":"");return c?ha.lcfirst(c+ha.ucfirst(b)):b}function f(a,b){if(W.sourceKeyName=a,t("keystroke",b,Fa,a,!0))return b.preventDefault(),!0}function h(a,b){var c=b.touches?b.touches[0]:b;return s(a,b,b.target,{target:b.target,clientX:c.clientX,clientY:c.clientY,metakey:d(b)})}function k(a){na(a,function(a,b){na(b.removedNodes,function(a,b){if(1===b.nodeType&&!la(Ca,b)){var c=Da.get(b);c&&c.autoDestroy&&c.element===b&&c.destroy();var d=Ia.get(b);d&&(Ia.delete(b),d.cancel(!0));var e=Ha.get(b);e&&(Ha.delete(b),p(b)&&(Fa.push.apply(Fa,e),v(e[0])));var f=Fa.indexOf(b);f>=0&&v(Fa[f+1]||z),na(Ja,function(a,c){(la(b,a)||la(b,c.to))&&Ja.delete(a)})}})}),l()}function l(){B=B||m(function(){B=null,na(Ja,y)})}var n,o,r,u,w,x,z=c.body;i.IS_IE10&&ka(z,"mousedown mouseup mousemove click",function(a){if("none"===ia(a.target).pointerEvents){a.stopPropagation(),a.stopImmediatePropagation();var b=c.createEvent("MouseEvent");b.initMouseEvent(a.type,a.bubbles,a.cancelable,a.view,a.detail,a.screenX,a.screenY,a.clientX,a.clientY,a.ctrlKey,a.altKey,a.shiftKey,a.metaKey,a.button,a.relatedTarget),ha.elementFromPoint(a.clientX,a.clientY).dispatchEvent(b)}}),ka(z,"mousedown mouseup wheel keydown keyup keypress touchstart touchend cut copy paste drop click dblclick contextmenu",function(a){var b=ya(a.type,"mousedown keydown touchend");W=null,q(a.target)?b&&v(a.target):(a.stopImmediatePropagation(),a.preventDefault(),b&&s("focusreturn",null,Fa.slice(-1)[0])),W=new E(a.target)},!0),ka(b,"blur",function(a){a.target===b&&(Y=!0)},!0),ka(z,{compositionstart:function(a){n=!0,t("typing",a,Fa[0])},compositionend:function(a){n=!1,t("typing",a,Fa[0]),t("textInput",a,Fa[0],a.data)&&a.preventDefault()},keydown:function(a){if(!n){var b=a.keyCode,c=ba.indexOf(b)>=0;c&&b!==r&&t("metakeychange",a,Fa,d(a),!0);var e=!c&&($[b]||"").length>1&&!(b>=186||b>=96&&b<=111);o=a.ctrlKey+a.shiftKey+a.altKey+a.metaKey+!c,o*=e||(o>2||o>1&&!a.shiftKey)&&!c,r=b,o&&f(d(a,$[b]||a.key),a)}},keyup:function(a){var b=ba.indexOf(a.keyCode)>=0;n||!b&&r!==a.keyCode||(r=null,o--,b&&t("metakeychange",a,Fa,d(a)||"",!0))},keypress:function(a){var b=a.char||a.key||e.fromCharCode(a.charCode);n||o||!a.synthetic&&"onbeforeinput"in a.target||(j(a.target)?(W.sourceKeyName=$[r]||b,t("textInput",a,Fa[0],b)):f(b,a))},beforeinput:function(a){!n&&a.cancelable&&t("textInput",a,Fa[0],a.data)},mousedown:function(a){u=0,w=0,x=a,1===a.buttons&&h("mousedown",a)},mousemove:function(a){x&&(u=g.max(u,g.abs(x.clientX-a.clientX)),w=g.max(w,g.abs(x.clientY-a.clientY)))},wheel:function(a){if(la(a.target,Fa[0])||!j(a.target)){var b=a.deltaY||a.detail;t("mousewheel",a,a.target,b/g.abs(b)*(i.IS_MAC?-1:1),!0)&&a.preventDefault()}for(var c=a.target;c!==z;c=c.parentNode){var d=ia(c);if(c.scrollHeight>c.offsetHeight&&("auto"===d.overflowY||"scroll"===d.overflowY)||c.scrollWidth>c.offsetWidth&&("auto"===d.overflowX||"scroll"===d.overflowX))break}q(c)||a.preventDefault()},click:function(a){u<=5&&w<=5&&h("click",a)},contextmenu:function(a){h("rightClick",a)},dblclick:function(a){h("dblclick",a)},focusin:function(a){Y=!1,q(a.target)?v(a.target,!1,W):a.target.blur()}},!0),new da(k).observe(Ca,{subtree:!0,childList:!0}),v(c.activeElement);var A=a('<div style="overflow:scroll;height:80px"><div style="height:100px"></div></div>').appendTo(z);Z=A.outerWidth()-A.children().width(),A.remove();var B;ka(b,"resize scroll orientationchange",l,{passive:!0}),ka(z,"mousemove wheel keyup touchend transitionend MSTransitionEnd",l,{passive:!0})}),"undo redo canUndo canRedo enable disable enabled".split(" ").forEach(B),C({focus:function(a){a.focus()},scrollBy:function(d,e,f){var g=d===Ca||d===c.body?b:d,h=a(g).scrollLeft(),i=a(g).scrollTop();return g.scrollBy?g.scrollBy(e,f):(g.scrollLeft=h+e,g.scrollTop=i+f),{x:a(g).scrollLeft()-h,y:a(g).scrollTop()-i}},getUnobscuredRect:function(a){var b=ia(a),d=a.offsetWidth<a.scrollWidth,e=a.offsetHeight<a.scrollHeight,f=pa(a===c.body?Ca:a);return"visible"===b.overflow&&a!==c.body||!d&&!e||(("scroll"===b.overflowY||("hidden"!==b.overflowY||a===c.body)&&e)&&(f.right-=Z),("scroll"===b.overflowX||("hidden"!==b.overflowX||a===c.body)&&d)&&(f.bottom-=Z)),f}}),C({element:":input",getValue:function(a){return a.value},setValue:function(a,b){a.value=b}})}(a,zeta),function(a,f){function i(a,b){var c=this;nb.set(c,{}),c.typer=a,c.baseCaret=new t(a,c),c.extendCaret=new t(a,c),b&&c.select(b)}function p(a,b,c,d){var e=this;e.id=b,e.typer=a,e.element=c||a.element,e.options=d}function q(a,b,c,d){var e=this;e.typer=a,e.childNodes=[],e.nodeType=b,e.element=c,e.widget=d}function r(a,b,c){var d=this;d.whatToShow=b,d.filter=c||null,d.currentNode=a,d.root=a}function s(a,b,c){var d=this;d.whatToShow=b,d.filter=c||null,V(d,a)}function t(a,b){this.typer=a,this.selection=b||null}function u(a,b){return b=b||a.currentNode,b&&a.whatToShow&(Qa(a,r)?b.nodeType:1<<b.nodeType-1)?a.filter?(a.filter.acceptNode||a.filter).call(a.filter,b):1:3}function v(a,b){return a[b<0?"previousNode":"nextNode"]()}
function w(a){return e(a||"").replace(/[^\S\u00a0]+/g," ").replace(/\u200b/g,"")}function x(a){return a&&1===a.nodeType&&a}function y(a){return a&&3===a.nodeType&&a}function z(a){return"br"===Za(a)&&a}function A(a,b,c){var d=a.data;return c>=0&&(b===a.length||d.slice(b)===ia)?1:c<=0&&(!b||d.slice(0,b)===ia)?-1:0}function B(a,b){return!!eb.test(a)||!/[^\s!-\/:-@\[\]^_`{|}~]/.test(a)&&b}function C(a){var b=kb(x(a)||a.parentNode);return bb[b.getPropertyValue("writing-mode")]^("rtl"===b.direction?2:0)}function D(a,b){for(;a&&!Qa(a,b);a=a.parentNode);return Qa(a,ma)?a.typer.getNode(a.widget.element):a}function E(a,b){var c=a.length||a.childNodes.length;return 1/b<0?g.max(0,c+b):g.min(c,b)}function F(a,b){for(var c,d=new s(new r(a,xa),5),e=0;(c=d.nextNode())&&c!==b;e+=c.length||0);return e}function G(a,b){var c=b/g.abs(b);b/=c;var d=2&b?-1:1,e=4&b?-1:1;c>0&&1&b&&(d^=e,e^=d,d^=e);var f=d<0?"right":"left",h=e<0?"bottom":"top";return a=1&b?$a(a[h]*e,a[f]*d,a[ab[h]]*e,a[ab[f]]*d):$a(a[f]*d,a[h]*e,a[ab[f]]*d,a[ab[h]]*e)}function H(a,b){b=+b===b?b:C(b),a=+a===a?a:db.indexOf(a);var c=a>>1&1^1&b?"left":"top";return!!(cb[a>>1]&1<<b)^1&a?ab[c]:c}function I(a){if(jb.rangeCount){var b=jb.getRangeAt(0);return Ea(a,b.commonAncestorContainer)&&b}}function J(a,b){switch(b){case"uppercase":return a.toUpperCase();case"lowercase":return a.toLowerCase();case"capitalize":return a.replace(/\b(.)/g,function(a){return a.toUpperCase()})}return a}function K(a,b){a.data!==b&&(a.data=b)}function L(b,c){return Ma(c,function(c,d){b=a(d.cloneNode(!1)).append(b)[0]}),Qa(b,h)||Fa(b)}function M(a){var b=a.baseCaret.getRange(),d=a.extendCaret.getRange();if(jb.setBaseAndExtent)return void jb.setBaseAndExtent(b.startContainer,b.startOffset,d.startContainer,d.startOffset);var e=Ia(b,d);try{jb.removeAllRanges()}catch(d){var f=c.body.createTextRange();f.collapse(),f.select(),jb.removeAllRanges()}try{jb.addRange(e)}catch(d){jb.rangeCount||(jb.addRange(Ia(c.body)),jb.removeAllRanges(),jb.addRange(e))}}function N(b){var d=N.cache||(N.cache={}),e=kb(x(b)||b.parentNode),f=[e.fontFamily,e.fontWeight,e.fontStyle].join("|");if(!d[f]){var g=a('<div style="position:fixed;font-size:1000px;"><span style="display:inline-block;width:0;height:0;"></span>&nbsp;</div>').css({fontFamily:e.fontFamily,fontWeight:e.fontWeight,fontStyle:e.fontStyle}).appendTo(c.body),h=g.children(),i=Oa(g[0]).top;d[f]={baseline:(Oa(h.css("vertical-align","baseline")[0]).top-i)/1e3,height:(Oa(h.css("vertical-align","text-bottom")[0]).top-i)/1e3,middle:(Oa(h.css("vertical-align","middle")[0]).top-i)/1e3,wsWidth:g.width()/1e3},g.remove()}var j=l(e.fontSize);return{fontSize:j,baseline:d[f].baseline*j,height:d[f].height*j,middle:d[f].middle*j,wsWidth:d[f].wsWidth*j}}function O(){var b=a.grep(arguments,Ra);return function(a){for(var c=1,d=0,e=b.length;d<e;d++){var f=b[d](a);if(2===f)return 2;c|=f}return c}}function P(k,l){function o(a){this.widget=a||null}function u(){aa.emit("stateChange",U.focusNode.widget.element,null,!0)}function A(a,b,c){var d=ba[a];return!(b in d)||"*"===d[b]||(" "+d[b]+" ").indexOf(" "+c+" ")>=0}function B(a,b){return b=D(b,ua),ba[a]&&ba[a].element&&(ba[a].inline||!Qa(b,oa))&&A(a,"allowedIn",b.widget.id)&&A(b.widget.id,"allow",a)}function C(){return U.getWidgets().reverse().concat(ca)}function E(a){return Ca(C(),function(b){return ba[b.id]&&Ra((ba[b.id].commands||{})[a])})}function F(b,e){function g(){u=null,ea&&M(),da.snapshot()}function h(a,b){var c=new p(w,b,a,Na({},ba[b].options));return a!==k&&aa.getContext(a)&&aa.delete(a),e&&(aa.setContext(a,c),aa.add(a,c.id,ba[c.id])),c}function i(a,b){for(var c=a.childNodes,d=c.length;d&&Da(b.element,c[d-1].element)<=0;d--);if(c[d]!==b)return b.parentNode?l(b):Sa(new r(b,-1),function(a){var b=a.widget;ob.delete(a.element),b.element===a.element&&aa.add(a.element,b.id,ba[b.id])}),c.splice(d,0,b),b.parentNode=a,b.previousSibling=c[d-1]||null,b.nextSibling=c[d+1]||null,(b.previousSibling||{}).nextSibling=b,(b.nextSibling||{}).previousSibling=b,!0}function l(a,b){var c=a.parentNode,d=a.previousSibling,e=a.nextSibling;c.childNodes.splice(c.childNodes.indexOf(a),1),(d||{}).nextSibling=e,(e||{}).previousSibling=d,a.parentNode=null,a.nextSibling=null,a.previousSibling=null,b&&Sa(new r(a,-1),function(a){ob.set(a.element,{node:(d||e||c).element,offset:!d&&(!!e||0)}),a.widget.element===a.element&&aa.delete(a.element)})}function n(a){var b=a.widget,c=a.parentNode,e=function(b){return Qa(a.element,ba[b].element)&&b};if(a.widget=(b||"").element!==a.element?c.widget:b,!Qa(c,ma|ra)){var f=Ca(d.keys(ba),e)||e(la);!f||a.widget!==c.widget&&a.widget.id===f||(a.widget=h(a.element,f))}b&&b!==a.widget&&aa.delete(a.element,b.id);var g=ba[a.widget.id];a.widget!==c.widget||Qa(c,ma|ra)?Qa(a.element,g.editable)||g.inline&&!g.editable?a.nodeType=g.inline?sa:Qa(a.element,ha)?oa:na:a.nodeType=g.inline&&a.widget!==c.widget&&Qa(c,xa)?ra:ma:a.nodeType=Qa(a.element,ha)?pa:qa}function o(b,c){Ma(b.childNodes.slice(0),function(a,c){Ea(b,c)||l(c,!0)}),a(b.element).children().not("br").each(function(a,d){var e=A.get(d)||new q(w,0,d);A.set(d,e),(i(b,e)||c)&&(n(e),o(e,!0))})}function s(a){var c=U&&!V,d=new za;Ma(a,function(a,e){var f=A.get(x(e.target)||e.target.parentNode);if(f){var g=Ea(b,e.target);!e.addedNodes[0]&&!e.removedNodes[0]||d.has(f)||(d.add(f),g&&o(f)),!c||!g||"style"===e.attributeName||e.attributeName&&e.target===b||(f.widget.id!==ka&&aa.emitAsync("contentChange",f.widget.element),aa.emitAsync("contentChange",k),ea=!0)}}),d.size&&U&&Z(function(){var a,b=U.getRange();d.forEach(function(c){a|=Va(b,c.element)}),a&&$(U)}),ea&&(u=u||m(g))}function t(a){if(f.IS_IE10&&!Ea(c,b)?o(B,!0):W(),(y(a)||z(a))&&(a=a.parentNode||a),Ea(b,a)){var d=A.get(a);return Qa(d,ma)?A.get(d.widget.element):d}}var u,v={},w=Ea(k,b)?Y:v,A=new ya;e&&(W=aa.observe(s,{childList:!0,attributes:!0,characterData:!0})),b.parentNode||(b=Qa(b,j)||Fa(b));var B=new q(w,_,b,h(b,ka));return A.set(b,B),o(B),Na(v,{rootNode:B,getNode:t})}function G(a,b,c){var d=Ta(Ha(a,4)),e="",f=[];b=b||function(a,b){return a+b},Ma(d,function(a,c){e=b(e,c.data),f[a]=e.length}),e=c(e),Ma(d,function(a,b){K(b,e.slice(f[a-1]||0,f[a]))})}function H(a){G(a,function(a,b){return(a+b).replace(/\u00a0{2}(?!\u0020?$)/g,"  ").replace(/[^\S\u00a0]{2}/g,"  ").replace(/\u00a0[^\S\u00a0]\u00a0(\S)/g,"   $1").replace(/(\S)\u00a0(?!$)/g,"$1 ")},function(a){return a.replace(/[^\S\u00a0]$/," ")})}function M(){W(),ea&&(V=!0,Sa(new r(Y.rootNode,xa|na|ta),function(b){var c=b.element;if(Qa(b,na))return b.firstChild?void a(c).contents().each(function(b,d){if(d.parentNode===c){for(var e=[];d&&(y(d)||z(d)||Qa(Y.getNode(d),wa));d=d.nextSibling)(e.length||x(d)||_a(d.data))&&e.push(d);e.length&&a(e).wrap("<p>")}}):void a(c).html("<p>"+(_a(c.textContent)||ja)+"</p>");if(Qa(b,pa|oa)){if(!c.firstChild)return void a(Ja()).appendTo(c);var d=a(">br:last-child",c)[0];d&&!d.nextSibling&&(a(Ja()).insertBefore(d),Xa(d));var e=a(">br:first-child",c)[0];e&&!e.previousSibling&&Xa(e),(!U||U.startNode!==b&&U.endNode!==b)&&Ma(Ta(Ha(c,4)),function(a,b){K(b,w(b.data)||ia),y(b.nextSibling)&&(b.nextSibling.data=w(b.data+b.nextSibling.data),Xa(b))})}!Qa(b,qa)||U&&(U.startElement===c||U.endElement===c)||_a(c.textContent)||Xa(c),a(">br",c).each(function(b,c){y(c.nextSibling)||a(Ja()).insertAfter(c)})}),a('br[type="_moz"]',k).remove(),W(),V=!1,ea=!1)}function N(b,c,d){var e="cut"===c?"extractContents":"paste"===c?"deleteContents":"cloneContents",f="paste"!==c,g="copy"!==c,h=Fa(),l=Qa(b,i)?b.clone():new i(Y,b),m=U.timestamp;if(b=l.getRange(),!l.isCaret){var n=[[k,h]],o=function(){var a=n.shift();a[2]&&a[2].element===a[0]&&aa.emit("extract",a[2].element,{extractedNode:a[1]})};for(Sa(l.createTreeWalker(-1,function(c){var d=c.element,h=Qa(c,ma|na|oa)&&ba[c.widget.id].extract,i=c.widget.element===d;if((!h||c===l.focusNode)&&!i&&Qa(c,na))return 3;for(;!Ea(n[0][0],d);)o();if(!h||i&&Ua(b,d)||(i?a(d):a(d).parentsUntil(n[0][0]).addBack()).each(function(a,b){n.unshift([b,b.cloneNode(!1),c.widget]),n[1][1].appendChild(n[0][1])}),Ua(b,d)){var k=d===n[0][0],m=g?d:d.cloneNode(!0);return g&&!k&&Qa(c,oa)&&(m=a(d.cloneNode(!1)).append(d.childNodes[0])),a(n[0][1]).append(k?m.childNodes:m),2}if(Qa(c,xa)){var p=Ia(d,b)[e](),q=Qa(p,j)?p.firstChild:p,r=Qa(q,Za(d)),s=!h;return f&&q&&(!r&&s?p=L(p,[Qa(c,oa)?Ga("p"):d]):r&&!s&&(p=Fa(q.childNodes)),h||G(p,null,function(b){return J(b,a.css(d,"text-transform"))}),a(n[0][1]).append(p)),2}return 1}));n[0];o());}if(g){if(U.timestamp!==m?l=U:l.direction>0?l.select(b):(l.select(Ia(b,!1)),l.extendCaret.moveTo(Ia(b,!0))),!l.isSingleEditable){var p=l.createTreeWalker(ua,function(a){return ba[a.widget.id].textFlow?1:3}),q=D(l.baseCaret.node,ua),r=D(l.extendCaret.node,ua);for(p.currentNode=q;v(p,l.direction););p.currentNode!==r&&(p.currentNode!==q?l.extendCaret.moveTo(p.currentNode.element,0*-l.direction):l.collapse())}U.select(l)}return Ra(d)&&d(l),a(h).find("[style]").removeAttr("style"),M(),h}function O(b,c){var d;Qa(c,h)?(Ea(k,c)&&Xa(c),c=Fa(c).childNodes,d=1===c.length&&!!Qa(c[0],"p:not([class])")):(c=a(e(c||"").replace(/\u000d/g,"").replace(/</g,"&lt;").replace(/\n{2,}/g,"</p><p>").replace(/\n/g,"<br>").replace(/.*/,"<p>$&</p>").replace(/\s/g," ")).get(),d=!0),N(b,"paste",function(b){var e,f=b.startNode,g=b.endNode,h=b.getCaret("start").clone(),i=Ia(D(f,ua).element,0),j=!!Qa(f,oa),k=!!Qa(f,xa),l=!0,m=[],n=Y.getNode(b.startElement);if(Qa(n,wa)){for(;n!==f;n=n.parentNode)Qa(n,qa)&&m.push(n.element);m.push(f.element)}else Qa(n,pa)?m[0]=f.element:Qa(n,oa)||(m[0]=Ga("p"));if(Ma(c,function(b,g){var n,o=Y.getNode(h.element),p=new q(Y,d?pa:qa,g),r=!!z(g),s=!1,t=!1;if(!r&&x(g)&&(i.insertNode(g),p=Y.getNode(g),Xa(g),p.widget!==o.widget))for(var u=o;Qa(u,wa|pa)||Qa(u,oa)&&u===o;u=u.parentNode){if(1===c.length&&p.widget.id===u.widget.id){var v={receivedNode:g,caret:h.clone()};if(aa.emit("receive",u.widget,v))return h=U.clone(),void(e=!0)}if(!B(p.widget.id,u)){var y=p.widget.id===la?w(_a(g.textContent)):Q(g);if(!y)return;g=Ja(y),p=new q(Y,qa,g);break}}if(!Qa(o,ua)){if(r){for(s=!Qa(o,pa);Qa(o.parentNode,wa);o=o.parentNode);n=Ia(o.element,!1)}else Qa(p,wa)||(o=D(o,pa)||o,n=Ia(o.element,!1),Qa(p,pa)?(t=!d&&!j&&Qa(o,pa)&&!Ya(p.element,o.element)&&!!_a(g.textContent),s=!l||t&&!!_a(Ia(Ia(o.element,!0),Ia(h))),l=!t,k=k&&l):_a(Ia(Ia(o.element,!0),Ia(h)))&&((s=_a(Ia(n,Ia(h))))||(o=o.nextSibling||o.parentNode,h.moveTo(n))));if(s){var A=Ia(Ia(h),n).extractContents();_a(A.textContent)||(A=Fa(L(Ja(),m)));var C=A.firstChild;n.insertNode(A);for(var E=Y.getNode(C);E&&!_a(E.element.textContent);E=E.firstChild)if(Qa(E,ra|sa)){a(E.element.childNodes).insertBefore(E.element),Xa(E.element);break}if(Qa(o,xa)&&!(o.element.firstChild||"").length&&a(Ja()).appendTo(o.element),_a(o.element.textContent)&&" "===o.element.textContent.slice(-1)&&H(o.element),_a(C.textContent)&&" "===C.textContent.charAt(0)&&H(C),r)return Ia(C,!0).insertNode(g),void h.moveTo(C,0);o=Y.getNode(C),h.moveTo(C,0),e=!0}}if(k=k&&!!Qa(p,xa|wa)){var F=Aa.makeArray(l&&!Qa(p,wa)?g.childNodes:g);F[0]&&(h.getRange().insertNode(Fa(F)),H(o.element),h.moveTo(F[F.length-1],-0)),l=j}else Qa(p,wa)&&(g=L(g,m)),(e||!Qa(f,ma)||_a(g.textContent))&&(Qa(o,ua)&&!Qa(o.parentNode,ua)?a(g).appendTo(o.element):a(g).insertBefore(o.element),k=!!Qa(p,xa|wa),l=t||!k,h.moveTo(g,!l&&-0)),e=!0}),!e&&f!==g)if(Q(f.element)){if(Qa(f,pa)&&Qa(g,pa)){var o=Fa(Ia(g.element,"contents").extractContents()),p=o.firstChild;for(h.moveTo(f.element,-0),Ia(f.element,-0).insertNode(o),Xa(g.element);x(p)&&Ya(p,p.previousSibling);){var r=p;p=a(p.childNodes).appendTo(p.previousSibling)[0],Xa(r)}H(f.element)}}else h.moveTo(g.element,!Qa(g,xa)||0),Xa(f.element);U.select(h)})}function Q(b){var c,d,e=Ia(b||k,"contents");Qa(b,h)&&!Aa.connected(k,b)?(d=F(b),c=new s(new r(d.rootNode,-1),5)):c=new s((Qa(b,i)||new i(Y,e)).createTreeWalker(-1),5,function(a){return Va(e,Ia(a,"contents"))?1:2});var f,g,j,l="",m="";return Sa(c,function(b){var c=(d||Y).getNode(b);if(j=ba[c.widget.id].text,c!==f&&(f&&(l+=J(m,g),m="",Qa(f,va)&&Qa(c,va)&&"\n\n"!==l.slice(-2)&&(l+="\n\n"),c.widget!==f.widget&&j&&(l+=j(c.widget))),f=c,g=a.css(c.element,"text-transform")),Qa(c,xa)&&!j)if(y(b)){var h=b.data;b===e.endContainer&&(h=h.slice(0,e.endOffset)),b===e.startContainer&&(h=h.slice(e.startOffset)),m+=h.replace(/\u200b/g,"").replace(" "," ")}else z(b)&&(m+="\n")}),l+=j?j(f.widget):J(m,g),_a(l).replace(/\u00a0/g," ")}function R(a){X=a,fa.attr("contenteditable",a?"true":null)}function S(a,b,c){ba[a]=Na({},b),ba[a].options=!c||Aa.isPlainObject(c)?Na({},b.options,c):c}function T(a){var b=new p(Y,a,k,ba[a].options);aa.add(b,a,ba[a]),ca.push(b)}Qa(k,h)||(l=k,k=k.element),l=Na(!0,{},(!l||!1!==l.defaultOptions)&&P.defaultOptions,l);var U,V,W,X,Y=this,_=l.inline||Qa(k,ha)?oa:na,aa=new f.Container(k,Y),ba={},ca=[],da={},ea=!0,fa=a(k);!function(){function a(a){for(var b=[],c=a.node;c.parentNode;c=c.parentNode)b.unshift(c.parentNode.childNodes.indexOf(c));return b[b.length]=a.textNode?a.wholeTextOffset:a.offset,b.join(" ")}function b(a,b){var c=b.split(" "),d=k,e=c.splice(-1)[0];c.forEach(function(a){d=d.children[+a]}),isNaN(e)?a.moveTo(d,"true"===e):a.moveToText(d,+e)}function c(){var b=da.getValue();f[0]&&b===f[h].value||(f.splice(0,h,{value:b}),f.splice(Y.historyLevel),h=0),f[h].basePos=a(U.baseCaret),f[h].extendPos=a(U.extendCaret),f[h].html=k.innerHTML,u(),n(e)}function d(a){fa.html(a.html),b(U,a.basePos),b(U.extendCaret,a.extendPos),u(),n(e)}var e,f=[],h=0,i=0;Na(da,{getValue:function(){return _a(k.innerHTML.replace(/\s+style(?:="[^"]*")?|\u200b+(?!<\/)|(^|[^>])\u200b+/g,"$1"))},canUndo:function(){return h<f.length-1},canRedo:function(){return h>0},undo:function(){da.canUndo()&&d(f[++h])},redo:function(){da.canRedo()&&d(f[--h])},snapshot:function(a){var b=+new Date;n(e),!0===a?c():(i=g.max(i,b+(a||0)),e=m(c,i-b))}})}(),function(){Ma(l.widgets,function(a,b){S(a,b,l[a])}),Ma(P.widgets,function(a,b){l[a]&&S(a,b,l[a])}),Ka(ba,ka,l),Ka(ba,la,{element:l.disallowedElement||":not("+ha+",br,b,em,i,u,strike,small,strong,sub,sup,ins,del,mark,span)"}),l.textFlow=!0,Na(Y,F(k,!0)),Ma(ba,function(a,b){b.element&&b.element!==k?Ra(b.setup)&&aa.add(new p(Y,a,k),a,{init:b.setup}):T(a)})}(),function(){function c(a){return U.isCaret?U.extendCaret.moveByCharacter("backspace"===a.data?-1:1)?(O(U,""),!0):void 0:(O(U,""),!0)}function d(a){if(U.startTextNode&&U.isCaret){if(a){var b=U.startTextNode;b.data=b.data.substr(0,U.startOffset)+a+b.data.slice(U.startOffset),H(U.startNode.element),U.moveToText(b,U.startOffset+a.length),da.snapshot(200)}}else O(U,a)}function e(b){var c=U.focusNode.widget,d="*"!==ba[c.id].disallowedElement,e=b.getData(f.IS_IE?"Text":i);if(d&&a.inArray(h,b.types)>=0){var g=Fa(a(b.getData(j)).filter("#Typer").contents());O(U,g)}else d&&e===lb.textContent?O(U,lb.htmlContent.cloneNode(!0)):Ba.emit("textInput",c.element,e,!1)}function g(c){var d=c.clipboardData||b.clipboardData,e=Q(U),g=N(U,c.type);f.IS_IE?d.setData("Text",e):(d.setData(i,e),d.setData(j,a('<div id="Typer">').append(g.cloneNode(!0))[0].outerHTML),d.setData(h,"true")),lb.textContent=e,lb.htmlContent=g,c.preventDefault()}var h="application/x-typer",i="text/plain",j="text/html";aa.add(k,"destroy",Aa.bind(k,{cut:g,copy:g,paste:function(a){if(e(a.clipboardData||b.clipboardData),a.preventDefault(),f.IS_IE){var c=U.clone();m(function(){U.select(c)})}},drop:function(a){U.moveToPoint(a.clientX,a.clientY)&&e(a.dataTransfer),U.focus(),a.preventDefault()}}));var l={backspace:c,delete:c};Ma({moveByLine:"upArrow downArrow shiftUpArrow shiftDownArrow",moveByWord:"ctrlLeftArrow ctrlRightArrow ctrlShiftLeftArrow ctrlShiftRightArrow",moveToLineEnd:"home end shiftHome shiftEnd",moveByCharacter:"leftArrow rightArrow shiftLeftArrow shiftRightArrow"},function(a,b){Ma(b,function(b,c){var d=1&b?1:-1,e=!!(2&b);l[c]=function(){e||U.isCaret?(e?U.extendCaret:U)[a](d):U.collapse(d<0?"start":"end")}})});var n={typing:function(a){var b=mb,c=I(k),d=c.startContainer,e=c.startOffset;if(x(d)&&(d=d.childNodes[e]||d.lastChild,e=d.length),mb="t"===a.originalEvent.type.slice(-1)&&{},V=!!mb,mb)mb.node=d,mb.offset=e;else{var f=a.originalEvent.data||b.node.data.slice(b.offset-e);Ia(d,e-f.length,d,e).deleteContents(),U.select(d,e-f.length)}},keystroke:function(a){/ctrl(?=[acfnprstvwx]|f5|shift[nt]$)/i.test(a.data)||a.preventDefault()},mousedown:function(a){("shift"===a.metakey?U.extendCaret:U).moveToPoint(a.clientX,a.clientY),U.focus(),Ba.drag(a,function(a,b){da.snapshot(200),U.extendCaret.moveToPoint(a,b)})},dblclick:function(a){U.select("word")},rightClick:function(a){var b=new t(Y);b.moveToPoint(a.clientX,a.clientY),!U.isCaret&&Va(U,b)||U.select(b)}},o={keystroke:function(a){a.data in l&&l[a.data](a)&&a.handled()},textInput:function(a){d(a.data),a.handled()},click:function(a){var b=Y.getNode(a.target);Qa(b,ma|ra)?U.select(b.widget.element):U.moveToPoint(a.clientX,a.clientY),U.focus(),da.snapshot()}};aa.tap(function(a){if(X){if((n[a.eventName]||Aa.noop)(a),!a.isHandled()){var b;Aa.matchWord(a.eventName,"rightClick focusin focusout focusreturn")?b=k:Aa.matchWord(a.eventName,"click")&&(b=a.target),aa.emit(a,b||U.focusNode.element)||(o[a.eventName]||Aa.noop)(a)}a.originalEvent&&a.isHandled()&&a.preventDefault()}})}(),R(!0),f.IS_IOS&&fa.css("-webkit-user-modify","read-write-plaintext-only"),Na(Y,da,{element:k,on:function(a,b){aa.add(k,Aa.isPlainObject(a)||Aa.kv(a,b))},enabled:function(){return X},enable:function(a,b){a?ba[a]||!P.widgets[a]||P.widgets[a].element||(S(a,P.widgets[a],b),T(a)):(R(!0),aa.emitAsync("stateChange"))},disable:function(){R(!1),aa.emitAsync("stateChange")},destroy:function(){R(!1),aa.destroy()},hasCommand:function(a){return!!E(a)},widgetEnabled:function(a){return!!ba[a]},widgetAllowed:function(a,b){return b=Qa(b,q)||Y.getNode(b||k),!!B(a,b)},getWidgetOption:function(a,b){return ba[a]&&ba[a][b]},getStaticWidget:function(a){return Ca(ca,function(b){return b.id===a})},getStaticWidgets:function(){return ca.slice(0)},getSelection:function(){return U},extractText:function(a){return Q(a)},invoke:function(a,b){var c=new o;"string"==typeof a&&(c.commandName=a,c.widget=E(a),a=c.widget&&ba[c.widget.id].commands[a]),Ra(a)&&(a.call(Y,c,b),M(),da.snapshot(),Y.focused(!0)&&U.focus())}}),La(o,{typer:Y,get selection(){return U},insertText:function(a){O(U,a)},insertHtml:function(a){O(U,Qa(a,h)||Fa(a))},insertWidget:function(a,b){var c=(ba[a]||"").create;Ra(c)&&c.call(Y,this,b)},removeWidget:function(a){var b=ba[a.id].remove;if(Ra(b))b.call(Y,new o(a));else if("keepText"===b){var c=Q(a.element);O(Ia(a.element,!0),c),Xa(a.element)}else O(Ia(a.element),"")}}),M(),U=new i(Y,Ia(k,0)),aa.emit("init")}function Q(a,b){return b&&(a.whatToShow&ta||b.element.offsetWidth>0||b.element.offsetHeight>0)&&b}function R(a,b,c){return c&&b!==a.root&&!Q(a,b)?2:Qa(b,ma)&&Qa(b.parentNode,ma)?3:u(a,b)}function S(a,b,c){if(R.returnValue=R(a,b,c),1===R.returnValue)return a.currentNode=b,!0}function T(a,b,c){for(var d=a.currentNode[b];d;){if(S(a,d,!0))return d;if(3===R.returnValue&&d[b])d=d[b];else{for(;!d[c];)if(!(d=Q(a,d.parentNode))||d===a.root||d===a.currentNode)return null;d=d[c]}}}function U(a,b,c){for(var d=a.currentNode;d&&d!==a.root;){for(var e=d[c];e;){if(S(a,e))return e;e=2!==R.returnValue&&e[b]?e[b]:e[c]}if(!(d=Q(a,d.parentNode))||d===a.root||1===R(a,d,!0))return null}}function V(a,b){var d=b.currentNode.typer,e=c.createTreeWalker(b.root.element,1|a.whatToShow,function(c){var e=d.getNode(c);return S(b,e,!0)?!y(c)&&!z(c)||Qa(e,xa)?1|u(a,c):2:R.returnValue},!1);Ka(a,"iterator",e)}function W(a,b,c){var d=Ia(a),e=nb.get(a).d,f=function(a){return Va(a.element,d)?1:2};return new r(a.focusNode,b&~ta,O(f,e&&e.acceptNode&&e.acceptNode.bind(e),c))}function X(a){var b=new s(W(a,xa),4);return b.currentNode=a.startTextNode||a.startElement,a.startOffset===(a.startTextNode||"").length&&b.nextNode(),Ta(b,null,null,function(b){return Da(b,a.endTextNode||a.endElement)<=(0!==a.endOffset?0:-1)})}function Y(a){var b=a.getCaret("start"),c=a.getCaret("end");c.textNode&&!A(c.textNode,c.offset,1)&&c.textNode.splitText(c.offset),b.textNode&&!A(b.textNode,b.offset,-1)&&ca(b,b.node,b.element,b.textNode.splitText(b.offset),0)}function Z(a,b,c){return Z.executing=!0,Z.run(a,b,c)}function $(a){if(Z.executing)return void pb.add(a);var b=nb.get(a);b.d=null,b.m=0,a.timestamp=performance.now(),a.direction=Aa.compareRangePosition(a.extendCaret.getRange(),a.baseCaret.getRange())||0,a.isCaret=!a.direction;for(var c=0,d=a.getCaret("start"),e=a.getCaret("end");c<4;c++)a[$.NAMES[c+4]]=d[$.NAMES[c]],a[$.NAMES[c+8]]=e[$.NAMES[c]];var f=a.typer.getNode(Aa.getCommonAncestor(a.baseCaret.element,a.extendCaret.element));a.focusNode=D(f,ma|ra|ua|sa),a===a.typer.getSelection()&&(a.typer.focused(!0)&&a.focus(),a.typer.snapshot())}function _(a,b,c){var d=new s(new r(b||a.typer.rootNode,xa|ma),4|c);return d.currentNode=a.textNode||a.element,d}function aa(a,b){return a.selection?Z(b,null,a):b.call(a)}function ba(a){var b=a.typer.element,c=a.element,d=a.textNode;if(!Ea(b,d||c)||d&&(d.parentNode!==c||a.offset>d.length))if(a.node)if(d&&Ea(b,d)&&a.offset<=d.length)a.moveTo(d,a.offset);else if(Ea(b,a.node.element))a.moveToText(a.node.element,a.wholeTextOffset);else{var e={node:c};for(a.typer.getNode(c);!Ea(b,e.node)&&ob.has(e.node);e=ob.get(e.node));a.moveTo(e.node,e.offset)}else a.moveTo(b,0);return a}function ca(a,b,c,d,e,f){var g=a.textNode||a.element,h=a.offset;a.node=b,a.element=c,a.textNode=d||null,a.offset=e,a.wholeTextOffset=(d?a.offset:0)+F(b,d||c),a.beforeSoftBreak=!!f;var i=g!==(d||c)||h!==e;return i&&a.selection&&$(a.selection),i}function da(b,c,d,e){var f,g;x(c)&&(g=d===c.childNodes.length,c=c.childNodes[d]||c.lastChild||c,d=g?c.length||0:0);var h=b.typer.getNode(c);if(Qa(h,ma))f=null;else if(Qa(h,ra))h=h.parentNode,c=h.element,f=y(g?c.nextSibling:c.previousSibling)||a(Ja())[g?"insertAfter":"insertBefore"](c)[0],d=1;else if(Qa(h,xa))f=z(c)?y(c.nextSibling)||a(Ja()).insertAfter(c)[0]:y(c);else{var i=Ca(h.childNodes,function(a){return Da(c,a.element)<0});h=i||h.lastChild||h,f=null,g=!i}if(b.selection&&b===b.selection.extendCaret&&Qa(h.previousSibling,ma)===b.selection.baseCaret.node&&(h=h.previousSibling,f=null,g=!0),!f&&Qa(h,xa)){for(var j=new s(new r(h,xa),4);j.nextNode()&&g;);f=y(j.currentNode)||a(Ja())[g?"appendTo":"prependTo"](h.element)[0],d=f&&g?f.length:0}if(f&&!e){for(var k=function(c,e,g,h){var i=A(f,d,c)&&x(f[e]);if(i&&!z(i)&&Qa(b.typer.getNode(i),xa))return f=y(i[g])||a(Ja())[h](i)[0],d=E(f,0*c),!0};k(-1,"previousSibling","lastChild","appendTo")||k(1,"nextSibling","firstChild","prependTo"););f.length||(f.data=ia,d=1)}return ca(b,D(h,va),f?f.parentNode:h.element,f,f?d:!g,e)}function ea(b,d,e,f){var g=C(b),h=d===b.length||!!e&&d>0,i=!!(2&g),j=b.data.charAt(d-h);if(B(j)!==i&&"override"!==a.css(b.parentNode,"unicode-bidi").slice(-8)){for(var l=b.parentNode;"inline"===a.css(l,"display")&&"isolate"!==a.css(l,"unicode-bidi").slice(0,7);l=l.parentNode);if((i?fb:eb).test(l.textContent)){var m=function(b,d,e){var f=c.createTreeWalker(l,5,function(b){if(x(b)&&!z(b)){if("inline"!==a.css(b,"display")||Qa(b,"audio,canvas,embed,iframe,img,input,object,video"))return 2;switch(a.css(b,"unicode-bidi")){case"normal":case"plaintext":return 3;case"isolate":case"isolate-override":return 2}}return 1},!1);for(f.currentNode=b;y(b);){for(;d!==E(b,0*-e);)if(d+=e,/(\S)/.test(b.data.charAt(d)))return B(k.$1,i);b=v(f,e),d=e>0?-1:(b||"").length}return!b||z(b)?i:"rtl"===a.css(b,"direction")},n=m(b,d-h,-1),o=m(b,d-h,1),p=n===o&&/\s/.test(j)?n:B(j,i);h||p===i||n!==i||(h=!0,p=n),g=-3&g|(p?2:0)}}var q=Pa(Ia(b,d-h,b,d+!h))[0]||$a(0,0);return f&&h&&/\s/.test(b.data.charAt(d-h))&&!G(q,g).width&&(q[H(3,g)]+=N(b).wsWidth),q.collapse(H(2|h,g))}function fa(b,c,d,e,f){function h(b){var c=q.indexOf(b);if(c>=0)return t[c];for(var d=kb(b),e=b;"inline"===a.css(e,"display");e=e.parentNode);var f=t[q.push(b)-1]=N(b);return f.lineHeight="px"===d.lineHeight.slice(-2)?l(d.lineHeight):("normal"===d.lineHeight?1.15:d.lineHeight)*f.fontSize,f.verticalAlign=d.verticalAlign,f.baselineOffset=f.baseline-f.height+i(b,e),f}function i(a,b){if(a===b)return 0;if(a.parentNode!==b)return i(a,a.parentNode)+i(a.parentNode,b);var c=h(a);switch(c.verticalAlign){case"baseline":return 0;case"middle":var d=h(a.parentNode);return-c.height/2+(d.baseline-d.middle);case"top":case"bottom":return NaN;case"text-top":return(c.lineHeight-c.height)/2;case"text-bottom":return(c.lineHeight+c.height)/2-h(a.parentNode).height;case"sub":return-.21*c.fontSize;case"super":return.34*c.fontSize}return isNaN(c.verticalAlign)?l(c.verticalAlign)/100*c.lineHeight:+c.verticalAlign||0}function j(a){var b,f;e?(f=e>0?a.right:a.left,b=(f-d.left)*e):(b=g.min(0,a.right-d.left)||g.max(0,a.left-d.left),f=d.left+b),(e?b>u:g.abs(b)<g.abs(u))&&(u=b,c=a.node,n=G($a(f,a.centerY),-p))}function m(a,b,c,e,f){var i,k=new s(new r(a,xa),4),l=c>0?"bottom":"top",m=d,n=[];if(y(b))k.currentNode=b;else{for(;k.nextNode()&&c<0;);if(b=k.currentNode,!y(b))return m[l]}do{var o=h(b.parentNode),q=Pa(b);c<0&&q.reverse();for(var t=0,u=q.length;t<u;t++){var w=G(q[t],p),x=o.lineHeight-w.height>>1,z=$a(w.left,w.top-x,w.right,w.bottom+x),A=w.bottom+o.baselineOffset,B=!1;if(z.node=b,!(void 0===i&&z[l]*c<m[ab[l]]*c)){if(isNaN(i)||g.abs(A-i)<1||z.top<m.bottom&&z.bottom>m.top)B=!0;else if(isNaN(A))if(o.verticalAlign===ab[l])B=z[ab[l]]*c<=m[l]*c;else{if(!n[0]||z[l]===n[0][l]){n.push(z);continue}var C=n.splice(0,n.length,z);C[0][l]===m[l]&&C.forEach(j)}if(void 0!==i&&isNaN(A)||(i=A),!B&&!--e||i*c>f*c)return m[l];m=Aa.mergeRect(m,z),1===e&&(n.splice(0).forEach(j),j(z))}}}while(b=v(k,c));return m[l]}var n,o=D(b.typer.getNode(c),va),p=C(c),q=[],t=[],u=-1/0;if(d=G($a(d.centerX,d.centerY),p),b.softPoint&&(d.left=d.right=G(b.softPoint,p).left),f){var w=m(o,c,f,2);if(!n){var x=new r(b.typer.rootNode,va);x.currentNode=o;for(var z;o=v(x,f);){var A=G(Oa(o.element),p),B=f>0?"bottom":"top";if(!(A[ab[B]]*f<w*f)){if(A[ab[B]]*f>=z*f)break;m(o,null,f,1,z),z=A[B]}}if(!n&&void 0!==z)return da(b,x.currentNode.element,0)}}else m(o,c,(e||1)*(2&p?-1:1),1);if(n){var E=e>0||u<0,F=function(b,c,d,e){function f(a){var f=G(ea(b,a,e),d);return(f.centerY-c.centerY|0)*(1/0)||f.left-c.left|0}var h=0,i=b.length;if("override"!==a.css(b.parentNode,"unicode-bidi").slice(-8)&&(2&d?fb:eb).test(b.data)){var j,l=2&d?[fb,gb]:[eb,hb],m=0;for(i=-1;!j&&l[1&++m].test(b.data.slice(i+1));)h=g.max(0,i),i=b.data.indexOf(k.$1,i+1),j=Ca(Pa(Ia(b,h,b,i)),function(a){return a.top<=c.top&&a.bottom>=c.top&&a.left<=c.left&&a.right>=c.left});d^=1&m?2:0,j||(i=b.length)}for(c=G(c,d);i-h>1;){var n=i+h>>1,o=f(n)<=0;h=o?n:h,i=o?i:n}return g.abs(f(h))<g.abs(f(i))?h:i}(c,n,p,E);return b.softPoint=f?G($a(d.left,G(n,p).centerY),-p):null,da(b,c,F,E)}return!1}var ga,ha="h1,h2,h3,h4,h5,h6,p,q,blockquote,pre,code,li,caption,figcaption,summary,dt,th",ia="​",ja="&#8203;",ka="__root__",la="__unknown__",ma=1,na=2,oa=32,pa=4,qa=16,ra=64,sa=128,ta=8192,ua=na|oa,va=ma|pa|ua,wa=qa|ra|sa,xa=pa|oa|qa|sa,ya=o.WeakMap,za=o.Set,Aa=f.helper,Ba=f.dom,Ca=Aa.any,Da=Aa.comparePosition,Ea=Aa.containsOrEquals,Fa=Aa.createDocumentFragment,Ga=Aa.createElement,Ha=Aa.createNodeIterator,Ia=Aa.createRange,Ja=Aa.createTextNode,Ka=Aa.defineHiddenProperty,La=Aa.definePrototype,Ma=Aa.each,Na=Aa.extend,Oa=Aa.getRect,Pa=Aa.getRects,Qa=Aa.is,Ra=Aa.isFunction,Sa=Aa.iterate,Ta=Aa.iterateToArray,Ua=Aa.rangeCovers,Va=Aa.rangeIntersects,Wa=Aa.rectEquals,Xa=Aa.removeNode,Ya=Aa.sameElementSpec,Za=Aa.tagName,$a=Aa.toPlainRect,_a=Aa.trim,ab={top:"bottom",left:"right",right:"left",bottom:"top"},bb={"horizontal-tb":0,"vertical-rl":5,"vertical-lr":1,"sideways-rl":5,"sideways-lr":11,lr:0,rl:0,tb:5,"lr-tb":0,"lr-bt":4,"rl-tb":0,"rl-bt":4,"tb-rl":5,"bt-rl":5,"tb-lr":1,"bt-lr":1},cb=[240,3276,1450,3840],db="block-start block-end inline-start inline-end over under line-left line-right".split(" "),eb=new k("([֐-߿‏‫‮יִ-﷽ﹰ-ﻼ])"),fb=new k("([^\\s֐-߿‏‫‮יִ-﷽ﹰ-ﻼ])"),gb=new k("(\\s|[֐-߿‏‫‮יִ-﷽ﹰ-ﻼ])"),hb=new k("(\\s|[^֐-߿‏‫‮יִ-﷽ﹰ-ﻼ])"),ib=/[\u200b\u0300-\u036f\u1ab0-\u1aff\u1dc0-\u1dff\u20d0-\u20ff\ufe20-\ufe2f\udc00-\udcff\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u0610-\u061a\u064b-\u065f\u0670\u06d6-\u06dc\u06df-\u06e4\u06e7\u06e8\u06ea-\u06ed\u08d4-\u08e1\u08e3-\u08ff\u0900-\u0903\u093a-\u093c\u093e-\u094f\u0951-\u0957\u0962\u0963\u3099\u309a]/,jb=b.getSelection(),kb=b.getComputedStyle,lb={},mb={},nb=new ya,ob=new ya,pb=new za;if(Na(P,{NODE_WIDGET:ma,NODE_PARAGRAPH:pa,NODE_EDITABLE:na,NODE_EDITABLE_PARAGRAPH:oa,NODE_INLINE:qa,NODE_INLINE_WIDGET:ra,NODE_INLINE_EDITABLE:sa,NODE_ANY_ALLOWTEXT:xa,NODE_ANY_BLOCK_EDITABLE:ua,NODE_ANY_INLINE:wa,ZWSP:ia,ZWSP_ENTITIY:ja,defaultOptions:{},widgets:{}}),f.Editor=P,La(P,{historyLevel:100,closest:D,getAbstractSide:H,createCaret:function(a,b){var c=new t(this);return a&&c.moveTo(a,b),c},createSelection:function(a,b,c,d){return new i(this,Ia(a,b,c,d))},createTreeWalker:function(a,b,c){return new r(a||this.rootNode,b,c)},nodeFromPoint:function(a,b,c){var d=Aa.elementFromPoint(a,b,this.element);if(d){var e=this.getNode(d);if(Qa(e,na)){var f=C(d),g=G($a(a,b),f);e=Ca(e.childNodes,function(a){var b=G(Oa(a.element,!0),f);return b.top<=g.top&&b.bottom>=g.top})||e}return D(e,c||-1)}},hasContent:function(){return!!Ea(this.element,mb.node)||(!!_a(this.element.textContent).length||!!new r(this.rootNode,~pa).nextNode())},setValue:function(a){this.selectAll(),this.invoke(function(b){b.insertHtml(a)})},validate:function(){return!0},select:function(a,b,c,d){this.getSelection().select(a,b,c,d)},selectAll:function(){this.getSelection().selectAll()},focus:function(){this.getSelection().focus()},focused:function(a){return Ba.focused(this.element,a)},retainFocus:function(a){Ba.retainFocus(this.element,a)},releaseFocus:function(a){Ba.releaseFocus(this.element,a)},support:function(a){return this.hasCommand(a)&&this.invoke.bind(this,a)}}),La(p,{get parent(){var a=this.element&&this.typer.getNode(this.element.parentNode);return a&&a.widget}}),La(q,{get firstChild(){return this.childNodes[0]||null},get lastChild(){var a=this.childNodes;return a[a.length-1]||null}}),La(r,{previousSibling:function(){return U(this,"lastChild","previousSibling")},nextSibling:function(){return U(this,"firstChild","nextSibling")},firstChild:function(){return T(this,"firstChild","nextSibling")},lastChild:function(){return T(this,"lastChild","previousSibling")},parentNode:function(){for(var a=this.currentNode;a&&a!==this.root;a=a.parentNode)if(S(this,a.parentNode,!0))return a.parentNode},previousNode:function(){for(var a=this,b=a.currentNode;b&&b!==a.root;){for(var c=b.previousSibling;c;c=b.previousSibling){b=c;for(var d=R(a,c);2!==d&&Q(a,b.firstChild);)b=b.lastChild,d=R(a,b,!0);if(1===d)return a.currentNode=b,b}if(!(b=Q(a,b.parentNode))||b===a.root)return null;if(S(a,b,!0))return b}},nextNode:function(){for(var a=this,b=1,c=a.currentNode;c;){for(;2!==b&&c.firstChild;){if(c=c.firstChild,S(a,c,!0))return c;b=R.returnValue}for(;c&&c!==a.root&&!c.nextSibling;)c=Q(a,c.parentNode);if(!c||c===a.root)return null;if(c=c.nextSibling,S(a,c,!0))return c;b=R.returnValue}}}),La(s,{get currentNode(){return this.iterator.currentNode},set currentNode(a){this.iterator.currentNode=a},previousNode:function(){return this.iterator.previousNode()},nextNode:function(){return this.iterator.nextNode()}}),Z.run=function(a){var b=0;return function(c,d,e){try{return b++,c.apply(e||this,d)}finally{0==--b&&a()}}}(function(){Z.executing=!1,pb.forEach($),pb.clear()}),$.NAMES="node element textNode offset startNode startElement startTextNode startOffset endNode endElement endTextNode endOffset".split(" "),La(i,{get isSingleEditable(){return this.isCaret||!W(this,ua).nextNode()},getCaret:function(a){var b=this.baseCaret,c=this.extendCaret;switch(a){case"extend":return c;case"start":return this.direction<0?c:b;case"end":return this.direction<0?b:c;default:return b}},getRange:function(a){var b=this.baseCaret,c=this.extendCaret;return void 0!==a||this.isCaret?(!1!==a?b:c).getRange():Ia(b.getRange(),c.getRange())},getWidget:function(a){return Ca(this.getWidgets(),function(b){return b.id===a})},getWidgets:function(){
for(var a=[],b=this.focusNode;b.widget.id!==ka;b=b.parentNode)a.unshift(b.widget),b=this.typer.getNode(b.widget.element);return a},getParagraphElements:function(){var a=this;return a.startNode===a.endNode?Qa(a.startNode,pa)?[a.startNode.element]:[]:Ta(W(a,pa),function(a){return a.element})},getSelectedElements:function(){var b=this;return b.isCaret?[b.startElement]:a(X(b)).parent().get()},getSelectedText:function(){return this.typer.extractText(this)},getSelectedTextNodes:function(){var a=this;return a.isCaret?[]:(Y(a),X(a))},createTreeWalker:function(a,b){return W(this,a,b)},collapse:function(a){return a=this.getCaret(a),(a===this.baseCaret?this.extendCaret:this.baseCaret).moveTo(a)},select:function(a,b,c,d){var e,f=this;return Z(function(){if("word"===a)e=f.getCaret("start").moveByWord(-1)+f.getCaret("end").moveByWord(1)>0;else{var g=Ia(a,b,c,d);e=f.baseCaret.moveTo(g,!0)+f.extendCaret.moveTo(g,!1)>0}}),a.acceptNode&&(nb.get(f).d=a),e},selectAll:function(){return this.select(this.typer.element,"contents")},focus:function(){var a=this.typer.element;Ea(c,a)&&(M(this),f.IS_IE||c.activeElement===a||a.focus(),Ba.scrollIntoView(a,this.extendCaret.getRect()))},clone:function(){var a=this,b=new i(a.typer);return Z(function(){b.baseCaret.moveTo(a.baseCaret),b.extendCaret.moveTo(a.extendCaret)}),nb.get(b).d=nb.get(a).d,b},widgetAllowed:function(a){return this.typer.widgetAllowed(a,this.focusNode)}}),Ma("moveTo moveToPoint moveToText moveByLine moveToLineEnd moveByWord moveByCharacter",function(a,b){i.prototype[b]=function(){var a=this;return Z(function(){return t.prototype[b].apply(a.baseCaret,arguments)+a.collapse("base")>0},arguments)}}),Ma("getWidgets getParagraphElements getSelectedElements getSelectedText getSelectedTextNodes",function(a,b){var c=i.prototype[b];i.prototype[b]=function(){var d=nb.get(this);return d.m&1<<a||(d[b]=d.d&&d.d[b]?d.d[b](this):c.apply(this),d.m|=1<<a),d[b]}}),La(t,{getRect:function(){var a=ba(this);if(!a.textNode){return Oa(a.element).collapse(H(2|!a.offset,C(a.element)))}return ea(a.textNode,a.offset,a.beforeSoftBreak,!0)},getRange:function(){var a=ba(this),b=a.textNode||a.element,c=a.offset;return b===a.typer.element?Ia(b,c?0:-0):c%b.length==0?Ia(b,!c):Ia(b,c)},clone:function(){var a=ba(this);return Na(new t(a.typer),a)},moveTo:function(a,b){if(Qa(a,t))return ca(this,a.node,a.element,a.textNode,a.offset,a.beforeSoftBreak);var c=Ia(a,b);return!(!c||!Ea(this.typer.element,c.startContainer))&&da(this,c.startContainer,c.startOffset)},moveToPoint:function(a,b){var c=this,d=c.typer.nodeFromPoint(a,b);return!!d&&fa(c,d.element,$a(a,b))},moveToText:function(a,b){if(3!==a.nodeType){var c=new s(new r(this.typer.getNode(a),xa),4);if(1/b>0)for(;b>=0&&c.nextNode();b-=c.currentNode.length);else for(;c.nextNode(););a=c.currentNode,b=a&&g.min(b+a.length,a.length)}return!!a&&da(this,a,E(a,b))},moveToLineEnd:function(a){var b=ba(this);return fa(b,b.textNode||b.element,b.getRect(),a,0)},moveByLine:function(a){var b=this;return fa(b,b.textNode||b.element,b.getRect(),0,a)||b.moveToLineEnd(a)},moveByWord:function(a){var b,c=this,d=c.textNode,e=a<0?/\b(\S*\s+|\S+)$/:/^(\s+\S*|\S+)\b/,f="";if(d&&(f=a<0?d.data.substr(0,c.offset):d.data.slice(c.offset),(b=e.test(f))&&k.$1.length!==f.length))return c.moveToText(d,c.offset+a*k.$1.length);for(var g=_(c,c.node),h=g.currentNode,i=b&&k.$1.length;d=v(g,a);){if(f=a<0?d.data+f:f+d.data,(b=e.test(f))&&k.$1.length!==f.length)return k.$1.length===i?c.moveToText(h,0*-a):c.moveToText(d,a*(k.$1.length-(f.length-d.length)));h=d,i=k.$1.length}return!(!b||!d&&!i)&&c.moveToText(d||h,0*-a)},moveByCharacter:function(a){for(var b=this,c=C(b.element),d=G(Oa(b),c),e=_(b,null,5),f=y(e.currentNode),g=b.offset,h=!1;;){if(!f||g===E(f,0*-a)){for(;!(f=v(e,a))||!f.length;){if(!f)return!1;if(Qa(b.typer.getNode(f),ma)&&!Ea(f,b.element))return b.moveToText(f,0*a)||b.moveTo(f,a<0);h|=!!z(f)}g=(a<0?f.length:0)+((h||!Ea(b.node.element,f))&&-a)}if(g+=a,!ib.test(f.data.charAt(g))){var i=G(ea(f,g),c);if(!Wa(d,i))return da(b,f,g,a>0&&d.centerY!==i.centerY)}}}}),Ma("moveByLine moveByWord moveByCharacter",function(a,b){var c=t.prototype[b];t.prototype[b]=function(a){var b=ba(this);return aa(b,function(){for(var d=a;d&&c.call(b,a/g.abs(a));d+=d>0?-1:1);return!a||d!==a})}}),!f.IS_IE){try{c.designMode="on",c.execCommand("enableObjectResizing",!1,!1),c.execCommand("enableInlineTableEditing",!1,!1)}catch(a){}c.designMode="off"}setInterval(function(){!Ba.focused(b)&&ga&&ga()},100)}(a,zeta),function(a,g){function i(a,b){return Ra(b,function(b,c){a[b]=c}),a}function j(a){return Ia.eval('"'+a+'"')}function l(a,b){Ra(a.attributes,function(a,c){b(c.nodeName,c.value,c)})}function n(a,b,c){return a[b]||(a[b]=new c)}function p(a,b,c,e){if(Wa(c))return Ra(c,p.bind(null,a,b));n(a,c,d)[b||"default"]=e}function q(a,b){return a=a.templates||lb,b=b.templates,b&&b!==lb?Ta(a,b):a}function r(a,b,c,d){var e=Xa("globals",c);return d?Ia.eval(a.slice(2,-2),b,e):Ia(a,b,e)}function s(a,b){for(;a;a=a.parent){var c=nb(a).values;if(b in c)return c[b]}return mb[b]}function t(a,b,c){c&&!L(a)||(b(a),Ra(a.controls,function(a,d){t(d,b,c)}))}function u(a,b,c,d){return nb(a).container.emit(b,a.element||a,c,d)}function v(a,b,c,d,e){return nb(a).container.emitAsync(b,a.element||a,c,d,e)}function w(a,b){if(v(a,"stateChange"),b)for(var c=a.parent;c&&c.requireChildControls;c=c.parent)I(c),v(c,"stateChange")}function x(a,b,c,d){v(a,"propertyChange",{oldValues:Xa(b,c),newValues:Xa(b,d)},!1,function(a,b){return b.oldValues=i(b.oldValues,a.oldValues),b.newValues=i(a.newValues,b.newValues),b}),Ra(nb(a).values,function(c,d){c!==b&&Ua(d,z)&&d.needEvaluate&&d.getValue(a,c,!0)}),I(a),w(a,!0)}function y(a,b){var c=Ga(a),d={};if(b){var e=nb(a);Ha(a).forEach(function(b){d[b]=a[b]}),Sa(d,e.values),d.value=e.value}else Sa(d,a);return Ra(d,function(b,e){b in c||$a(b,za)||Oa(d,b,function(){return C(c,b),a[b]})}),d}function z(a,b,c,d,e,f){var g=this;g.rawValue=c,g.displayValue=d,g.lastValue=d,g.needEvaluate=e,g.getValue(a,b,f)}function A(a,b){var c=a.toolset.labels;if(b in c)return A.value=e(c[b][ob.language]||c[b].default||""),!0}function B(a,b,c,d){if("string"==typeof c){var e=nb(a),f="icon"!==b&&(A(e.container,c)||A(e,c))?A.value:c,g=Ba.test(f);if(f!==c||g)return new z(a,b,c,f,g,d)}return c}function C(a,b){b in a||$a(b,za)||(Oa(a,b,function(){var a=this,c=Fa.call(mb,b)?s(a,b):nb(a).values[b];return Ua(c,z)?c.lastValue:c},function(a){var c=this,d=nb(c).values,e=Ua(d[b],z);if(a!==d[b]&&(!e||a!==e.rawValue)){var f=Fa.call(mb,b),g=e?e.lastValue:d[b];!f||null!==a&&void 0!==a?d[b]=B(c,b,a):delete d[b];var h=c[b];if(nb(c).inited&&(x(c,b,g,h),f)){var i=function(a){Ra(a.controls,function(a,c){b in nb(c).values||(x(c,b,g,h),i(c))})};i(c)}}}),Ra(Za(fb,a),function(a,c){nb(c).values[b]=B(c,b,c[b]),delete c[b];var d=nb(c).initialValues;d[b]=b in d?B(c,b,d[b],!1):void 0}))}function D(a,b,c){var d=nb(a);if(!d.inited)return d.value=b,!0;var e=d.value;if(e===b)return!1;var f=d.container.event;return f&&"setValue"===f.eventName&&f.context===a||!u(a,"setValue",{oldValue:e,newValue:b})?(d.value=b,c||(x(a,"value",e,b),(a.errors||a.validateOnSetValue)&&E(a)),!0):d.value!==e}function E(a){var b;if(L(a)&&(b=a.required&&!a.value?ab("required"):u(a,"validate")),b)return b.then(function(){a.errors=null},function(b){if(Wa(b))a.errors=b;else{var c={};Ra(Ya(b),function(a,b){c[b]=b}),a.errors=c}}),b;a.errors=null}function F(a,b){var c=[],d=[];if(t(a,function(a){var b=E(a);b&&(b.catch(function(){d.push(a.element)}),c.push(b))},!0),c[0]){var e=Ja.waitAll(c);return e.catch(function(){b&&Ka.focus(d)}),e}}function G(a){var b=nb(a),c=b.initialValues;Ra(Ha(a),function(b,d){$a(d,za)||(c[d]=a[d])}),i(c,b.values),Pa(c,"value",b.value)}function H(a){var b=nb(a),c=b.initialValues;a.errors=null,b.flag=1,c&&(Ra(c,function(c,d){(c in b.values?b.values:a)[c]=d}),D(a,c.value,!0)),u(a,"reset"),w(a)}function I(a,b){nb(a).flag&=255,b&&[L,M,N].forEach(function(c,d){return b&1<<d&&c(a)})}function J(a,b,c){var d=nb(a),e=d.flag,f=(e&b)>0;return(d.flag|=b<<8)!==e&&f^!!c(d)?(d.flag^=b,w(a,!0),!f):f}function K(a,b,c){nb(a)[Aa[b>>1]]=c,I(a,b)}function L(a){return J(a,1,function(b){return!(O(a)||b.position&&!b.position.enabled)&&(!(a.requireChildControls&&(!a.controls.some(L)||a.controls.every(N)))&&(!1!==b.enabled&&!1!==(b.options.enabled||_a).call(a,a)))})}function M(a){return J(a,2,function(b){return b.active||(b.options.active||_a).call(a,a)})}function N(a){return J(a,4,function(b){var c=a.hiddenWhenDisabled;return O(a)||!L(a)&&(c||!1!==c&&a.parent&&a.parent.hideDisabledChild)||!1===b.visible||!1===(b.options.visible||_a).call(a,a)})}function O(a){return J(a,8,function(b){return b.toolsetState&&(!1===L(b.toolsetState)||a.realm&&!b.toolsetState[a.realm])})}function P(b,e,g,h){function i(a,b,c,d){n(s,a,f).push({type:d||"text",name:c||"",expression:b})}function m(a){var b;return a.value=a.value.replace(/([\w-]+)\:(\{\{(?:[^\}]|\}(?!\}))+\}\})/g,function(c,d,e){return b=!0,i(r,e,d,a.nodeName),""}),b}function o(a,b){return Ja.single(b,function(b,c){return Fa.call(a,c)&&c})}function p(b,c){var f=h===b?Ga(e):e,g=f[b]||"<div><children controls/></div>",i=a.parseHTML(g)[0];a("children",i).each(function(b,d){var e=Na(d.attributes.controls&&!c.childNodes[0]?[Ja.createElement("controls")]:c.cloneNode(!0).childNodes),f=a("controls",e);l(d,function(a,b){f.attr(a,b)}),a(d).replaceWith(e)}),g=i.outerHTML;for(var n=e,p=e;p;p=Ga(p)){var q=Za(gb,p,d)[g];if(q){n=o(e,q.roles)?e:p;break}}var u=P(g,e,n,V.prototype[b]?b:h),v=u.dom.cloneNode(!0),w=a("controls",v),x={};return l(c,function(b,c,d){if("class"===b)m(d),a(v).addClass(d.value);else{var e=Ba.test(c)&&k.$1;x[Ma(b)]=e?{expression:c,evalAsObject:e.length===c.length-4}:j(c),e||w.attr(b,c)}}),Ra(u.binds,function(a,b){var c=+a+r;s[c]=b.concat(s[c]||[]),s[c].context=Sa({},b.context,x)}),Ra(u.roles,function(a,b){t[a]=+b+r}),t[b]=r,r+=u.nodeCount,v}var q=Za(gb,g||e,d)[b];if(q)return q;var r=0,s={},t={};s[0]=[];var u={dom:function(b){var d=new Da,e=c.createTreeWalker(b,5,function(a){return/z\:([\w-]+)/.test(db(a))?(d.set(a,p(Ma(k.$1),a)),2):1},!1);return Ja.iterate(e,function(b){1===b.nodeType?("controls"!==db(b)||a(b).attr("layout")||b.setAttribute("layout",h),l(b,function(a,c,d){!Ba.test(c)||$a(a,"class style")&&m(d)||(i(r,c,a,$a(a,ya)&&a in b?"prop":"attr"),d.value="")}),r++):Ba.test(b.data)&&(b.previousSibling||b.nextSibling?(i(r,b.data),d.set(b,c.createElement("span")),r++):i(r-1,b.data),b.data="")}),d.forEach(function(b,c){a(c).replaceWith(b)}),b.childNodes[0]}(Na(a.parseHTML(b)[0])),roles:Ia.eval("sortby [ . ]",t),binds:s,nodeCount:r};for(g=g||e;g!==lb&&!o(g,t);)g=Ga(g);return Za(gb,g,d)[b]=u,u}function Q(b){var c=b.element,d=nb(b).position;1===d.count?d.start=d.end=a(d.placeholder).insertBefore(c)[0]:d.start===c?d.start=c.nextSibling:d.end===c&&(d.end=c.previousSibling),d.count--,a(c).detach()}function R(b,c,d){var e,f=nb(b),g=nb(c).dom.positions,h=f.position,i=f.dom;if(g[0]){var j=y(b);e=La(g,function(a){return!a.condition||Ia.eval(a.condition,j)}),I(b)}else e=new aa(c),e.layoutType=c.type,a(e.placeholder).appendTo(c.element),g[0]=e;if(h!==e){var k=i;if(i&&Q(b),!i||e&&(i||"").layoutType!==e.layoutType){var l=e.layoutType,m=f.allDOM||(f.allDOM={});k=m[l]||(m[l]=new ba(b,l)),b.element=k.element}var n=b.element;e.count?(a(n).insertAfter(e.end),e.end=n):(a(e.start).replaceWith(n),e.start=e.end=n),e.count++,f.position=e,f.dom=k,c&&!d&&k!==i&&k.update()}}function S(a,b,c,d,e){if(Ra(c,function(c,f){var g=nb(f);if("import"===g.type)S(a,b,kb[g.name]||[],!0,g.options);else{var h=new g.ctor(a,f,b,d,e);R(h,b||a,!0),S(a,h,Ya(g.options.controls)),u(h,"init"),G(h),w(h),b||(a.control=h)}}),b&&c[0]){if(b.controls[1]){var f=new Da;Ra(b.controls,function(a,b){f.set(b,a)}),b.controls.sort(function(a,b){function c(a,b,c,d){return a[c]?"*"===a[c]||$a(b.name,a[c])?d:-d:0}var d=c(a,b,"after",1),e=c(a,b,"before",-1),g=c(b,a,"after",-1),h=c(b,a,"before",1);return(!d&&!e)^(!g&&!h)?d||e||g||h:d+e+g+h||f.get(a)-f.get(b)})}w(b)}}function T(a,b,c){var d=Ka.getContext(),e=null,f=La(hb,function(a){return Ka.focused(a.element)});if(f)d=f.context,e=f.element;else if(Ua(d,U)){var h=nb(d).container;e=h.event&&h.event.context.element}e&&Ka.retainFocus(e,a);var i=new g.Container(a);return i.context=new U(i,c),i.toolset=nb(b).toolset,i.parentContext=d,i.parentElement=e,nb(i,{dom:{positions:[]}}),i.tap(function(b){var c=i.getContext(b.target)||i.control;L(c)&&(i.emit(b,b.target===a?c.element:b.target),$a(b.eventName,"focusin focusout")?(c.focusBy=b.source,w(c)):$a(b.eventName,"asyncStart asyncEnd")&&t(c,function(a){w(a)}))}),S(i,null,[b],!0),i.flushEvents(),i}function U(a,b){var c=Sa(this,b);nb(c,{container:a,toolsets:new Da})}function V(a,b){var c=this;c.name=a||"",c.labels=a?n(jb,a,d):{},c.options=b||{}}function W(a,b,c){var d=this;d.name=b.name,d.context=c,d.all={},nb(d,{container:a,options:b.options,control:d,flag:1}),a.add(d,b.options),a.emit("contextChange",d)}function X(a,b){for(var c=0;a[b+(c||"")];c++);return b+(c||"")}function Y(a){var b=nb(a);if(!Ua(b.childContext,U)){var c=new U(b.container);"value"in b.options||(b.value=c,Oa(a.context,a.name,function(){return c},function(b){var d=Sa({},c);x(a,"value",d,Sa(c,b))})),b.childContext=c}return b.childContext}function Z(a,b,c,d){var e=a.name+(d?"":Ja.ucfirst(c));Va(a[c])?Pa(b,e,a[c].bind(a)):(Fa.call(b,e)&&(a[c]=b[e]),Oa(b,e,function(){return a[c]},function(b){a[c]=b})),nb(a).exports.push(e)}function $(a,b,c,d,e){var f=this,g=nb(b),h=!d&&c&&nb(c).toolset!==g.toolset,i=h?Y(c):c&&nb(c).childContext||(c||a).context,j=Za(nb(i).toolsets,g.toolset,function(){return new W(a,g.toolset,i)}),k=X(j.all,g.name),l={control:f,species:b,container:a,toolset:g.toolset,options:g.options,templates:q(nb(c)||{},g),flag:1,values:{},initialValues:{},exports:[],pending:!1,toolsetState:j,toolsetEventHandle:a.add(j,{stateChange:function(){I(f,5)}})};nb(f,l),Za(fb,Ga(f),Ea).add(f),f.name=k,f.type=g.type,f.required=!1,Ra(g.options,function(a,b){Va(b)||Va(f[a])||(f[a]=b)}),Ra(e,function(a,b){Va(b)||Va(f[a])||(f[a]=b)}),void 0===f.label&&(f.label=g.name),"string"==typeof g.options.execute&&(f.shortcut=Ka.getShortcut(g.options.execute)[0]),f.icon=f.icon||"",f.parent=c||null,f.state=j,f.context=i,f.parentContext=a.parentContext||null,f.parentElement=a.parentElement||null,f.controls=[],f.errors=null,f.id=Ja.randomId(),f.all=j.all,f.all[k]=f,c&&(c.controls.push(f),d&&c.all!==f.all&&(c.all[k]=f)),g.defaultExport&&Z(f,i,g.defaultExport,!0),Ra(g.options.exports,function(a,b){Z(f,i,b)}),l.inited=!0}function _(a,b,c,d){function e(){$.apply(this,arguments)}e.prototype=Ta($);var f=this;f.name=c,f.type=b,nb(f,{toolset:a,type:b,name:c||d.name||b,options:d,defaultExport:d.defaultExport||"value"in d&&"value",templates:q(ib[b]||{},d),ctor:e})}function aa(a,b){b=b||c.createElement("controls"),b.style.display="none!important";var d={};l(b,function(a,b){d[Ma(a)]=j(b)});var e=this;e.control=a,e.context=d,e.placeholder=b,e.condition=d.of||"",e.layoutType=d.layout||a.type||"default",e.start=b,e.end=b,e.count=0}function ba(b,c){var d=this,e=nb(b),f=e.container,g=P(e.options.template||"<z:"+Ja.hyphenate(b.type)+"/>",(ib[c]||"").templates||lb),h=g.dom.cloneNode(!0),i=Ja.iterateToArray(Ja.createNodeIterator(h,1)),j=i.filter(function(a,b){return g.binds[b]}),k=Ia.eval("sortby [ ! condition ]",a("controls",h).map(function(a,c){return new aa(b,c)}).get());f.setContext(h,b),Ra(ib[b.type].handlers,function(a,b){f.add(h,b)}),f.add(h,e.options),Ra(g.roles,function(a,c){ib[a]&&a!==b.type&&f.add(i[c],a,ib[a])}),f.add(h,{stateChange:function(){d.update()}}),Sa(d,{control:b,element:h,roles:g.roles,binds:g.binds,bindedNode:j,positions:k,layoutType:c}),b.cssClass&&a(h).addClass(b.cssClass)}function ca(a){this.args=a,this.done=!1}function da(a,b,c){b=Sa({},b),b.templates=q({},b),b.handlers=[b],lb[a]=b.template||"",ib[a]=b;var d={};Ra(b,function(a,c){Va(c)||$a(a,"templates template handlers")||(d[a]=c,delete b[a])}),b.defaultOptions=d,c||Qa(V,Xa(a,function(){for(var c=0,e=arguments.length,g=new f(e);c<e;c++)g[c]=arguments[c];var h=new ca(g),i=h.string(),j={};return b.parseOptions&&b.parseOptions(j,h),Sa(j,h.next("object")&&h.value),new _(this,a,i,Sa({},d,j))}))}function ea(a,b){a.execute=b.fn()}function fa(a,b){a.controls=b.nextAll(_),ea(a,b)}function ga(a,b){a.icon=b.string(),ea(a,b)}function ha(a,b){if("button"===b.type||"submit"===b.type)return b.execute()}function ia(a,b){return b.value=!b.value,"checkbox"===b.type?b.execute():void 0}function ja(a,b,c){var d,e=nb(a).ddToolset.all(a),f=La(e,function(a){return d=d||a,a.value===b});f||a.allowEmpty||(f=d),(a.setValue(f?f.value:"")||c)&&(a.hintValue=b,a.selectedText=(f&&a.valueAsLabel?f:a).label,Ra(a.controls,function(a,b){b.selected=b===f}))}function ka(a){var b=Ja.isArray(a.choices),c=[];Ra(a.choices,function(a,d){c[c.length]=b&&Wa(d)?d:{value:b?d:j(a),label:d}});for(var e=nb(a).ddToolset,f=[],g=0,h=c.length-d.keys(e.all(a)).length;g<h;g++)f[g]=e.choiceButton;a.append(f),Ra(e.all(a),function(a,b){b.enabled=b.visible=!!c[0],Sa(b,c.shift())}),ja(a,a.hintValue,!0)}function la(b){var d=a(":file",b.target)[0],e=d.parentNode,f=c.createElement("form");f.appendChild(d),f.reset(),a(d).prependTo(e)}function ma(a,b){var c={},d=(b||"").init;return b=Sa({inline:!0,defaultOptions:!1,disallowedElement:"*"},Xa(sb,Sa({},b))),Ra(a,function(a,d){(Va(d)||"options"===a||"commands"===a?c:b)[a]=d}),Ra(b[sb],function(a,d){c.options&&a in c.options||(b[a]=d,delete b[sb][a])}),b.widgets=Sa(b.widgets,Xa(sb,c)),b.init=function(c){var e=c.typer.getStaticWidget(sb);Ra(a.overrides,function(a,b){c.typer[a]=function(a){return b.call(this,e,a)}}),Va(d)&&d.call(b,c)},b}function na(a,b){var c=a.editor;c.focused(!0)||b===c.getValue()||c.setValue(b),a.setValue(c.getValue())}function oa(a){var b=pa(a,"deferred");Pa(a.context,a.name,b.promise()),qa(a,"guard",!0)}function pa(b,c){return b[c]||(b[c]=a.Deferred())}function qa(a,b,c,d){a[b]&&(a[b][c?"resolve":"reject"](d),delete a[b])}function ra(a){a.value=a.optional?!!a.value:void 0,a.enableChildren=!a.optional||a.value}function sa(a,b,c){var d=[];!function a(b){Ra(b.controls,function(b,c){c.hasRole("buttonlist")?a(c):c.hasRole("button")&&c.enabled&&(d[d.length]=c)})}(a);var e=d.indexOf(b);return d[e<0?0:e+c]}function ta(a,b){b.destroy()}function ua(a,b,c,d,e){return a.import("dialog.prompt").render({prompt:"prompt"===b,cancellable:"alert"!==b,value:c,message:d,action:e.string(),dialogTitle:e.string(),dialogDescription:e.string(),callback:e.fn()}).dialog}function va(a){return Ia.string(a).replace(/ctrl|alt|shift/gi,function(a){return Ja.ucfirst(a)+"+"})}function wa(a){var b={},c=Ia.string(a).replace(/ctrl|alt|shift/gi,function(a){return a=Ja.lcfirst(a),b[a]=xa[a],""});return(b.alt||"")+(b.shift||"")+(b.ctrl||"")+(xa[Ja.lcfirst(c)]||c)}var xa=JSON.parse('{"ctrl":"⌘","alt":"⌥","shift":"⇧","enter":"↩","tab":"ℵ","pageUp":"⇞","pageDown":"⇟","backspace":"⌫","escape":"⎋","leftArrow":"⭠","upArrow":"⭡","rightArrow":"⭢","downArrow":"⭣","home":"⭦","end":"⭨"}'),ya="checked selected disabled readonly multiple ismap",za="element name type parent all controls context previousSibling nextSibling",Aa="enabled active visible".split(" "),Ba=/\{\{((?:[^\}]|\}(?!\}))+)\}\}/,Ca=o.WeakMap,Da=o.Map,Ea=o.Set,Fa=d.hasOwnProperty,Ga=d.getPrototypeOf,Ha=d.getOwnPropertyNames,Ia=b.waterpipe,Ja=g.helper,Ka=g.dom,La=Ja.any,Ma=Ja.camel,Na=Ja.createDocumentFragment,Oa=Ja.defineGetterProperty,Pa=Ja.defineHiddenProperty,Qa=Ja.definePrototype,Ra=Ja.each,Sa=Ja.extend,Ta=Ja.inherit,Ua=Ja.is,Va=Ja.isFunction,Wa=Ja.isPlainObject,Xa=Ja.kv,Ya=Ja.makeArray,Za=Ja.mapGet,$a=Ja.matchWord,_a=Ja.noop,ab=Ja.reject,bb=Ja.runCSSTransition,cb=Ja.setState,db=Ja.tagName,eb=Ja.when,fb=new Ca,gb=new Ca,hb=new Ea,ib={},jb={},kb={},lb={},mb={},nb=Ja.createPrivateStore(),ob={language:"en"};Qa(z,{getValue:function(a,b,c){var d=this;if(d.needEvaluate){var e=Ia(d.displayValue,y(a,!0));return!1!==c&&e!==d.lastValue&&x(a,b,d.lastValue,e),d.lastValue=e,e}return d.displayValue}}),Qa(U,{toJSON:function(){return Sa({},this)},update:function(a){var b=nb(this),c=b.container;Sa(this,a),Ra(c.components,function(a,b){Ua(b.context,W)&&u(b.context,"contextChange"),I(b.context,1)}),Ra(c.components,function(a,b){var c=Ua(b.context,$);c&&(I(c,7),O(c)||u(c,"contextChange"))})},validate:function(){return nb(this).container.control.validate()},reset:function(){Ra(nb(this).container.components,function(a,b){H(b.context)})}}),Qa(V,{i18n:function(a,b,c){p(this.labels,a,b,c)},alert:function(a,b,c,d,e){return ua(this,"alert",!0,a,new ca([b,c,d,e]))},confirm:function(a,b,c,d,e){return ua(this,"confirm",!0,a,new ca([b,c,d,e]))},prompt:function(a,b,c,d,e,f){return ua(this,"prompt",b,a,new ca([c,d,e,f]))},notify:function(a,b,c,d){var e=new ca([b,c,d]);return this.import("dialog.notify").render({label:a,kind:e.string()||!0,timeout:e.next("number")&&e.value,within:e.next(h)&&e.value}).dialog},import:function(a,b){return new _(this,"import",a,b||{})},export:function(a){for(var b=n(kb,a,f),c=1,d=arguments.length;c<d;c++)b[b.length]=arguments[c]},all:function(a){if(Ua(a,h))a=Ua(Ka.getContext(a),U);else if(Ua(a,$)){if(nb(a).toolset===this)return a.all;a=nb(a).childContext}var b=a&&nb(a).toolsets.get(this);return b?b.all:{}}}),Qa(W,{get enabled(){return L(this)},set enabled(a){K(this,1,a)}}),Qa($,{get previousSibling(){var a=Ua(nb(this).position,aa);return a&&a.start!==this?nb(this).container.getContext(this.element.previousSibling):null},get nextSibling(){var a=Ua(nb(this).position,aa);return a&&a.end!==this?nb(this).container.getContext(this.element.nextSibling):null},get focused(){return Ka.focused(this.element)},get pending(){return Ka.locked(this.element)},get enabled(){return L(this)},set enabled(a){K(this,1,a)},get active(){return M(this)},set active(a){K(this,2,a)},get visible(){return!N(this)},set visible(a){K(this,4,a)},get value(){return nb(this).value},set value(a){D(this,a)},setValue:function(a){return D(this,a)},contains:function(a){for(var b=a;b&&b!==this;b=b.parent);return!!b},hasRole:function(a){var b=nb(this).dom.roles;return La(a,function(a){return a in b})},getRoleContext:function(a){var b=nb(this).dom;return b.binds[b.roles[a]].context},on:function(a,b){nb(this).container.add(this.element,Wa(a)||Xa(a,b))},watch:function(a,b){C(Ga(this),a),Va(b)&&this.on("propertyChange",function(c,d){a in c.oldValues&&b.call(d,d,a,c.oldValues[a],d[a])})},focus:function(){L(this)&&Ka.focus(this.element)},validate:function(){return eb(F(this,"script"!==Ka.getEventScope(this.element).source))},execute:function(a){var b=this;if(!L(b)||N(b)||hb.has(b))return ab();void 0!==a&&(b.value=a);var c=Ka.getEventScope(b.element),d=c.wrap(function(a,c){hb.delete(b),a&&(u(b,"executed",{data:c}),b.parent&&u(b.parent,"childExecuted",{control:b},!0)),u(b,"afterExecute",a)}),e=c.wrap(function(){var a;u(b,"beforeExecute"),hb.add(b);try{var c=nb(b).options.execute;"string"==typeof c?a=(Ka.support(c,b.focused)||_a)(b.value):Va(c)&&(a=c.call(b,b))}catch(b){console.error(b),a=ab(b)}return b.waitForExecution&&a&&Va(a.then)?(a=Ka.lock(b.element,a,function(){return u(b,"cancel")||ab()}),Ja.always(a,d),a):(d(!0),eb())}),f=F(b,"script"!==c.source);return f?f.then(e):e()},reset:function(){t(this,H)},append:function(a,b){var c=this;b&&Ra(c.controls.slice(0),function(a,b){b.destroy()}),S(nb(c).container,c,Ya(a))},destroy:function(){var a=this;a.pending&&Ka.cancel(a.element,!0),eb(u(a,"beforeDestroy")).then(function(){var b=nb(a).container;if(t(a,function(a){var c=nb(a);Ra(c.allDOM,function(a,c){b.delete(c.element)}),b.delete(a.state,c.toolsetEventHandle),Za(fb,Ga(a)).delete(a),delete a.all[a.name],a.parent&&a.parent.all[a.name]===a&&delete a.parent.all[a.name],Ra(c.exports,function(b,c){delete a.context[c]})}),a.parent){var c=a.parent.controls;c.splice(c.indexOf(a),1),Q(a)}else m(function(){b.destroy()}),Ja.removeNode(b.autoDestroy?b.element:a.element)})}}),Ra("icon label errors placeholder description",function(a,b){C($.prototype,b)}),function(a,b){Ra(Wa(a)||Xa(a,b),function(a,b){mb[a]=b,C($.prototype,a)})}({showIcon:"auto",showText:!0,hideDisabledChild:!1,hideCalloutOnBlur:!0,hideCalloutOnExecute:!0,waitForExecution:!0,enableChildren:!0}),Qa(_,{clone:function(a){var b=Ta(_,this),c=Sa({},nb(this));return c.options=Sa({},c.options,a),nb(b,c),b},render:function(b,d){Ua(b,h)||(d=b,b=c.createElement("div"));var e=T(b,this,d);return a(b).addClass("zeta-ui"),e.context}}),Qa(aa,{get enabled(){return!1!==this.control.enableChildren}}),Qa(ba,{update:function(){var b=this,c=b.control,d=c.element;c.parent&&R(c,c.parent);var e=nb(c).position;if(e){var f=/\*\*(([^*]|\*(?!\*))+)\*\*/g,g=/\*([^*]+)\*/g,h=y(c),i=0;if(Ra(b.binds,function(c,d){var j=b.bindedNode[i++],k=Sa({},e.context);Ra(d.context,function(a,b){k[a]=b.expression?r(b.expression,h,null,b.evalAsObject):b}),Ra(d,function(b,c){var d=r(c.expression,h,k,"class"===c.type||"prop"===c.type);switch(c.type){case"class":return cb(j,c.name,d);case"style":return a(j).css(c.name,d);case"prop":return void(j[c.name]=!!d);case"attr":return d=d.replace(f,"$1").replace(g,"$1"),a(j).attr(c.name,d||null)}(d=d.replace(f,"<b>$1</b>").replace(g,"<i>$1</i>").replace(/\n/g,"<br>"))!==j.innerHTML&&(j.innerHTML=d)})}),cb(d,"active",h.active),cb(d,"loading",h.pending),cb(d,"error",h.errors),cb(d,"disabled",!h.enabled),cb(d,"hidden",!h.visible),cb(d,"focused",h.focused&&h.focusBy),d.disabled=!h.enabled,c.controls[1]){var j=new Da;Ra(c.controls,function(a,b){j.set(b.element,a)}),Ra(b.positions,function(b,c){for(var d=c.count-1;d>0;d--)for(var e=0,f=c.start;e<d;e++,f=f.nextSibling)j.get(f)>j.get(f.nextSibling)&&(a(f.nextSibling).insertBefore(f),f=f.previousSibling,0===e?c.start=f:e===c.count-1&&(c.end=f.nextSibling))})}Ra(c.controls,function(a,b){R(b,c)})}}}),Qa(ca,{next:function(a){var b=this.args;if("object"===a?Wa(b[0]):"string"==typeof a?typeof b[0]===a:Ua(b[0],a))return this.value=b.shift(),this.done=!b.length,!0},nextAll:function(a){for(var b=[];this.next(a)&&b.push(this.value););return b},fn:function(){return this.next("function")&&this.value},string:function(){return this.next("string")&&this.value}}),Sa(V,{define:da,on:function(a,b,c){ib[a].handlers.push(Wa(b)||Xa(b,c))},i18n:function(a,b,c,e){p(n(jb,a,d),b,c,e)},hasRole:function(a,b){var c=Ua(Ka.getContext(a),U);return c&&nb(c).container.getContext(a).hasRole(b)}}),g.UI=V,da("button",{template:'<button class="danger:{{danger}}"><z:label/><children/></button>',danger:!1,defaultExport:"execute",parseOptions:ga,enter:ha,click:ha}),da("submit",{template:'<z:button class="zeta-submit"/>',defaultExport:"execute",parseOptions:function(a,b){a.icon=b.string(),a.execute=function(a){for(var b=a;b&&!b.hasRole("form");b=b.parent);return b&&b.execute()}},enter:ha,click:ha});var pb="[ @global.showIcon ?? showIcon ]",qb="[ @global.showText ?? showText ]",rb="[ @global.icon ?? icon ]";da("label",{template:'<span class="zeta-label hidden:{{[ ! '+pb+" || ! "+rb+" ] && ! "+qb+'}}" title="{{tooltip || label}}"><i class="material-icons hidden:{{[ ! '+rb+" && "+pb+" != true ] || ! "+pb+'}}">{{'+rb+"}}</i>{{? "+qb+' [ @global.label ?? label ] ""}}</span>',showIcon:"auto",showText:!0,defaultExport:"label"}),da("checkbox",{template:'<z:button class="zeta-checkbox checked:{{value}}" show-icon="false" show-text="true"/>',value:!1,preventLeave:!0,parseOptions:ea,click:ia,enter:ia,space:ia}),da("dropdown",{template:'<label class="zeta-dropdown"><z:button label="{{selectedText}}" show-text="true"/><z:menu/></label>',requireChildControls:!0,hideCalloutOnBlur:!0,hideCalloutOnExecute:!0,preventLeave:!0,allowEmpty:!0,valueAsLabel:!0,value:"",parseOptions:function(a,b){a.icon=b.string(),(b.next(f)||b.next(Da))&&(a.choices=b.value,a.value=b.next("string")||b.next("number")?b.value:""),fa(a,b)},init:function(a,b){var c=new V(nb(b).toolset.name);c.choiceButton=c.button({template:'<z:button class="selected:{{selected}}" show-icon="true" show-text="true"/>'}),nb(b).ddToolset=c,b.hintValue=b.value,b.selectedText=b.label,b.watch("choices",ka),ka(b)},setValue:function(a,b){ka(b),ja(b,a.newValue),a.handled()},childExecuted:function(a,b){ja(b,a.control.value),b.execute()}}),da("callout",{template:'<label class="zeta-callout"><controls of="not parent.alwaysShowCallout && parent.controls where enabled as _enabled && _enabled.length == 1 && _enabled.0.id == id"/><z:button class="hidden:{{[ not alwaysShowCallout ] && controls where enabled length == 1}}"/><z:menu/></button>',requireChildControls:!0,hideCalloutOnExecute:!0,hideCalloutOnBlur:!0,alwaysShowCallout:!0,parseOptions:function(a,b){a.icon=b.string(),a.controls=b.nextAll(_)}}),da("buttonlike",{template:'<label class="has-clickeffect"><children/></label>'},!0),da("link",{template:'<z:buttonlike><a href="{{value}}" target="{{target}}"><z:label show-icon="auto"/></a></z:buttonlike>',parseOptions:function(a,b){a.icon=b.string(),a.value=b.string(),a.target=b.string()}}),da("file",{template:'<z:buttonlike><z:label show-icon="auto"/><input type="file" multiple="{{multiple}}"/></z:buttonlike>',autoReset:!0,multiple:!1,parseOptions:ga,init:function(b,c){a(":file",b.target).change(function(a){c.execute(Ya(a.target.files))})},afterExecute:function(a,b){b.autoReset&&la(a)},reset:function(a,b){la(a)}});var sb="__preset__",tb={overrides:{getValue:function(){return this.extractText()}}};da("textbox",{template:'<z:textboxlike><z:contenteditable spellcheck="false"/></z:textboxlike>',hideCalloutOnExecute:!1,preventLeave:!0,value:"",placeholder:"",parseOptions:ea,init:function(a,b){b.editorOptions=ma(b.preset||tb,b.options),b.watch("editor",function(a,c,d,e){b.options=e.getStaticWidget(sb).options})}}),da("textboxlike",{template:'<label class="zeta-textbox keep-placeholder:{{showPlaceholder == always && ! $placeholder}}"><z:label show-text="false" show-icon="auto"/><div class="zeta-textbox-wrapper" data-label="{{? $placeholder label}}"><div class="zeta-textbox-inner"><children/><div class="zeta-textbox-placeholder">{{placeholder || label}}</div><div class="zeta-textbox-error"></div></div></div></label>'},!0),da("richtext",{template:'<div class="zeta-richtext"><div class="zeta-richtext-toolbar"></div><label class="zeta-textbox"><z:contenteditable/><div class="zeta-textbox-placeholder"><p>{{label}}</p></div></label></div>',hideCalloutOnExecute:!1,preventLeave:!0,value:"",parseOptions:ea,init:function(b,c){c.editorOptions=c.options||{},c.editorOptions.toolbar={container:a(".zeta-richtext-toolbar",b.target)[0]}}}),da("contenteditable",{template:'<div class="zeta-editable" contenteditable spellcheck="{{spellcheck}}"></div>',init:function(a,b){b.editor=new g.Editor(a.target,b.editorOptions),b.editor.enable("stateclass",{target:b.element}),b.editor.on("contentChange",function(){b.setValue(b.editor.getValue())&&b.execute()}),na(b,b.value)},setValue:function(a,b){na(b,a.newValue),a.handled()},validate:function(a,b){return b.editor.validate()}},!0),da("form",{template:'<div class="zeta-form"><children controls/></div>',templates:{buttonset:'<z:buttonset><children controls show-text="true"/></z:buttonset>',textbox:'<z:textbox show-placeholder="always"/>'},parseOptions:fa,preventLeave:!0,init:function(a,b){oa(b)},childExecuted:function(a,b){"script"!==a.source&&a.control.preventLeave&&!b.guard&&Ka.lock(b.element,pa(b,"guard"),function(){return b.preventLeave?nb(b).toolset.confirm("leaveForm"):eb()})},beforeExecute:function(a,b){qa(b,"guard",!0)},executed:function(a,b){qa(b,"deferred",!0,null!==a.data?a.data:void 0!==b.value?b.value:b.context.toJSON()),b.reset()},cancelled:function(a,b){qa(b,"deferred",!1)},destroy:function(a,b){qa(b,"deferred",!1)},reset:function(a,b){b.deferred||oa(b)}}),da("fieldset",{template:'<div class="zeta-fieldset optional:{{optional && [ ? value checked [ ! value ] ]}}"><div class="zeta-fieldset-title"><z:checkbox/><p>{{description}}</p></div><div class="zeta-form hidden:{{not enableChildren}}"><children controls/></div></div>',templates:{textbox:'<z:textbox show-placeholder="always"/>'},value:!1,optional:!1,parseOptions:fa,init:function(a,b){ra(b)},propertyChange:function(a,b){
("optional"in a.newValues||"value"in a.newValues)&&ra(b)}}),da("buttonset",{template:'<div class="zeta-buttonset"><children controls/></div>',templates:{textbox:'<z:textbox show-placeholder="auto"/>'},requireChildControls:!0,hiddenWhenDisabled:!0,parseOptions:fa}),da("buttonlist",{template:'<div class="zeta-buttonlist"><children show-text="true" show-icon="true" controls/></div>',templates:{button:'<z:button><span class="zeta-label zeta-label-description">{{description}}</span><span class="zeta-label zeta-label-description is-shortcut">{{shortcut :zeta-shortcut}}</span></z:button>'},showIcon:!0,showText:!0,requireChildControls:!0,hiddenWhenDisabled:!0,parseOptions:fa,stateChange:function(a,b){Ra(b.controls,function(a,b){if("buttonlist"===b.type){var c=function(a){for(var c=b[a];c&&!c.visible;c=c[a]);return c},d=c("previousSibling"),e=c("nextSibling");cb(b.element,"sep",{before:d,after:e&&"buttonlist"!==e.type})}})}}),da("menu",{template:"<z:float><z:buttonlist/></z:float>",waitForExecution:!1,parseOptions:fa,init:function(a,b){var c=Ja.ucfirst(b.name);Pa(b.context,"show"+c,function(a,c,d){b.showCallout=!0,(Ua(a,h)?Ka.snap:Ja.position)(b.callout,a,c,d),Ka.focus(b.callout)}),Pa(b.context,"hide"+c,function(){b.showCallout=!1})},focusin:function(a,b){"keyboard"===a.source&&(b.activeButton=sa(b,b,1),b.activeButton&&(b.activeButton.active=!0))},focusout:function(a,b){b.activeButton&&(b.activeButton.active=!1)},keystroke:function(a,b){var c=b.activeButton;switch(a.data){case"upArrow":case"downArrow":var d=sa(b,c,"u"===a.data[0]?-1:1);return d&&((c||{}).active=!1,d.active=!0,b.activeButton=d,d.focus()),d||c;case"leftArrow":return c&&b.parent&&(c.active=!1,b.activeButton=null,b.parent.focus()),c;case"rightArrow":var e=c&&c.controls[0];return e&&c.hasRole("menu")&&(c.showCallout=!0,e.focus()),e}},childExecuted:function(a,b){b.activeButton=null}}),da("dialog",{template:'<div class="zeta-ui zeta-dialog is-modal:{{modal}}"><z:anim class="zeta-dialog-inner"><div class="zeta-dialog-content"><h2>{{title}}</h2><z:form><p>{{description}}</p><controls/></z:form></div><div class="zeta-dialog-error error hidden:{{not errorMessage}}">{{errorMessage}}</div><controls of="type == buttonset"/></z:anim></div>',templates:{buttonset:'<z:buttonset class="zeta-dialog-buttonset"><controls of="danger" show-text="true"/><div class="zeta-buttonset-pad"></div><controls show-text="true"/></z:buttonset>'},pinnable:!0,modal:!0,title:"",description:"",errorMessage:"",parseOptions:fa,init:function(d,e){var f=e.element,g=e.parentElement,h=g&&e.pinnable&&screen.availWidth>=600&&screen.availHeight>=600&&V.hasRole(g,"button buttonlike")?g:b;a(f).appendTo(c.body),e.modal&&Ka.setModal(f),Ka.snap(f,h,"auto"),Ja.setZIndexOver(f,g||c.activeElement)},error:function(a,b){b.errorMessage=(a.error||"").message||a.error||"",a.handled()},focusout:ta,escape:ta,afterExecute:function(a,b){a.data&&ta(a,b)},enter:function(a,b){return b.execute()}}),da("anim",{template:"<div><children controls/></div>",init:function(a,b){bb(a.target,"open")},focusreturn:function(b,c){bb(b.target,"pop").then(function(){a(b.target).removeClass("pop")})},beforeDestroy:function(a,b){return bb(a.target,"closing")}},!0),da("float",{template:'<div class="zeta-ui zeta-float is:{{type}} hidden:{{not showCallout}}"><children controls/></div>',init:function(b,c){var d=b.target;c.showCallout=!1,c.parent||d!==c.element?c.parent&&c.parent.hasRole("buttonlist")?Ja.bind(c.element,"mouseover mouseout mousemove",function(a){if(c.showCallout="mouseout"!==a.type,c.showCallout){var b=Ja.getRect(),e=Ja.getRect(d),f=Ja.getState(d,"float")||[];cb(d,"float",{top:e.bottom>b.height||!(e.top<0)&&f.indexOf("top")>=0,left:e.right>b.width||!(e.left<0)&&f.indexOf("left")>=0})}}):(c.callout=d,c.originalParent=d.parentNode,Ka.retainFocus(c.element,c.callout),c.watch("showCallout",function(b,e,f,g){g?(Ka.snap(d,c.originalParent),Ka.focus(d)):a(d).detach()}),a(d).detach()):(c.callout=c.element.parentNode,Pa(c.context,"element",c.callout),c.watch("showCallout",function(b,d,e,f){f||a(c.callout).detach()}),a(c.callout).addClass("zeta-float"))},click:function(a,b){b.originalParent&&(b.showCallout=!0)},childExecuted:function(a,b){for(var c=a.control;c&&c!==b.parent;c=c.parent)if(!c.hideCalloutOnExecute)return;b.showCallout=!0,b.showCallout=!1},focusout:function(a,b){b.hideCalloutOnBlur&&(b.showCallout=!0,b.showCallout=!1)}},!0),da("generic",{parseOptions:fa});var ub=new V("dialog");ub.i18n("en",{action:"OK",cancel:"Cancel",leaveForm:"There are unsubmitted information on the page. Are you sure to leave?"}),ub.export("dialog.prompt",ub.dialog({preventLeave:!1,exports:"title description errorMessage",controls:[ub.label("message"),ub.textbox("value"),ub.buttonset(ub.submit("action","done",{defaultExport:"label",exports:"icon"}),ub.button("cancel","cancel",function(a){return a.all.dialog.destroy()}))],init:function(a,b){b.all.message.visible=!b.context.prompt,b.all.cancel.visible=b.context.cancellable,b.all.value.visible=b.context.prompt,b.all.value.label=b.context.message},execute:function(a){return(Va(a.context.callback)||eb)(a.context.value)}}));var vb;ub.export("dialog.notify",ub.generic({template:'<z:anim class="zeta-ui zeta-snackbar notify:{{kind}}"><div class="zeta-float"><z:buttonset><z:label/><z:button icon="close" show-text="false" show-icon="true"/></z:buttonset></div></z:anim>',init:function(a,b){vb&&vb.destroy(),Sa(b,b.context),Ka.snap(a.target,b.within||c.body,"top center inset"),b.timeout&&m(function(){b.destroy()},b.timeout),vb=b},click:function(a,b){b.destroy()}})),Ra("alert confirm prompt notify",function(a,b){V[b]=ub[b].bind(ub)}),Ia.pipes[":zeta-shortcut"]=g.IS_MAC?wa:va}(a,zeta),function(a,d){function e(){N.timestamp=s.getSelection().timestamp,N.rect=D(s).translate(J.scrollLeft,J.scrollTop),C(this,{typer:s,pointerX:N.x||0,pointerY:N.y||0,mousedown:P,hoverNode:u||null,activeHandle:t||null,editorReflow:!O.rect||!z.rectEquals(O.rect,N.rect),pointerMoved:O.x!=N.x||O.y!=N.y,selectionChanged:O.timestamp!==N.timestamp}),C(O,N)}function f(a,b){this.cursor=a||"pointer",this.done=b}function i(){var e={N:"typer-visualizer",G:"background",S:"selection",X:"transparent"};a(c.body).append("<style>.has-N{caret-color:X;}.has-N:focus{outline:none;}.has-N::S,.has-N ::S{G:X;}.has-N::-moz-S,.has-N ::-moz-S{G:X;}@keyframes caret{0%{opacity:1;}100%{opacity:0;}}</style>".replace(/\b[A-Z]/g,function(a){return e[a]||a})).append(I),a(I).mousedown(function(a){1&a.buttons&&(t=K.get(a.target),z.always(d.dom.drag(a,s.element),function(){(t.done||z.noop).call(t),t=null}),a.preventDefault())}),a(c.body).on("mousedown mousemove mouseup",function(a){N.x=a.clientX,N.y=a.clientY,u=s&&s.nodeFromPoint(N.x,N.y),n(x),"mousemove"===a.type?x=m(q,0):(P=1&a.buttons,x=m(q,0,!0))}),a(b).on("scroll resize orientationchange focus",q)}function j(a){var b=s.getAbstractSide("inline-start",a.startContainer),c=s.getAbstractSide("inline-end",a.startContainer),d=[];return B(z.getRects(a),function(a,e){g.abs(e[b]-e[c])<=1&&(e[c]+=5),d.forEach(function(a){g.abs(e.left-a.right)<=1&&(a.right=e.left),g.abs(e.top-a.bottom)<=1&&(a.bottom=e.top)}),d.unshift(e)}),d}function k(a,b){L[a]=[b,[],{},!0]}function p(a,b,c,d,e){for(var f=0,g=v.length;f<g;f++)if(v[f].state===b&&v[f].kind===a)return void(w[w.length]=v.splice(f,1)[0]);w[w.length]={kind:a,state:b,rect:c||("top"in b?b:D),css:d,handle:e}}function q(b){if(b=!0===b,n(x),s&&(b||s.focused(!0))){var d=new e;(b||d.editorReflow||d.selectionChanged||d.pointerMoved)&&B(L,function(e,f){w=f[1],v=w.splice(0),!1!==f[3]&&f[0].call(null,d,f[2]),v.forEach(function(b){M[M.length]=a(b.dom).detach().removeAttr("style")[0],K.delete(b.dom)}),w.forEach(function(e){if(b||!e.dom||d.editorReflow||F(e.rect)){var f=e.dom||(e.dom=a(M.pop()||c.createElement("div"))[0]);a(f).appendTo(I).css(C({position:"absolute",cursor:(e.handle||"").cursor,pointerEvents:e.handle?"all":"none"},e.css,z.cssFromRect("top"in e.rect?e.rect:e.rect(e.state),I))),K.set(f,e.handle)}})})}}function r(b){s=b,b?(d.helper.setZIndexOver(I,b.element),q(!0)):a(I).children().detach()}var s,t,u,v,w,x,y=d.Editor,z=d.helper,A=z.createRange,B=z.each,C=z.extend,D=z.getRect,E=z.is,F=z.isFunction,G=z.matchWord,H=z.toPlainRect,I=a('<div style="position:absolute;top:0;left:0;">')[0],J=c.documentElement,K=new o.WeakMap,L={},M=[],N={},O={},P=!1;C(e.prototype,{refresh:function(){m(q,0,!0)},toggleLayer:function(a,b){var c=!1;a.split(" ").forEach(function(a){c|=b^(L[a]||"")[3],(L[a]||{})[3]=b}),c&&m(q,0,!0)},fill:function(a,b,c){var d={};if(d.background=b||"rgba(0,31,81,0.2)",a instanceof h||"top"in a)p("f",a,null,d,c);else{var e=[];z.iterate(s.createSelection(a).createTreeWalker(-1,function(b){return z.rangeCovers(a,b.element)?(e[e.length]=D(b),2):E(b,y.NODE_ANY_ALLOWTEXT)?(e.push.apply(e,j(A(a,A(b.element,"content")))),2):1})),e.forEach(function(a){p("f",a,null,d,c)})}},drawCaret:function(a){p("k",a,null,{animation:"caret 0.5s infinite alternate ease-in",outline:"1px solid rgba(0,31,81,0.8)"})},drawBorder:function(a,b,c,d,e){var f={};f.border=l(b)+"px "+(d||"solid")+" "+(c||"black"),f.margin=e?"0px":-l(b)+"px",f.boxSizing=e?"border-box":"auto",p("b",a,null,f)},drawLine:function(a,b,c,d,e,f,h,i){var j=c-a,k=d-b,m={};m.borderTop=l(e)+"px "+(h||"solid")+" "+(f||"black"),m.transformOrigin="0% 50%",m.transform="translateY(-50%) rotate("+g.atan2(k,j)+"rad)",p("l",H(a,b,a+g.sqrt(k*k+j*j),b),null,m,i)},drawHandle:function(a,b,c,d,e){var f={};f.border="1px solid #999",f.background="white"+(d?' url("'+d+'")':""),c=c||8,p("c",a,function(){var d=D(a),e=G(b,"left right")||"centerX",f=G(b,"top bottom")||"centerY";return d.left-=c,d.top-=c,H(d[e],d[f],d[e]+c,d[f]+c)},f,e)}}),k("selection",function(a){var b=a.typer.getSelection(),c=b.startNode;b.isCaret?"caretColor"in J.style&&a.drawCaret(b.baseCaret):E(c,y.NODE_WIDGET)===b.focusNode?a.fill(c.element):a.fill(b.getRange())}),y.widgets.visualizer={init:function(b){a(b.typer.element).addClass("has-typer-visualizer"),i.init||(i(),i.init=!0)},focusin:function(a){r(a.typer)},focusout:function(a){r(null)},contentChange:function(a){q(!0)},stateChange:function(a){a.typer.enabled()?s===a.typer?q():a.typer.focused()&&r(a.typer):r(null)}},y.defaultOptions.visualizer=!0,C(y,{addLayer:k,handle:function(a,b){return new f(a,b)}})}(a,zeta),function(a,b){var c,d,e=b.helper.getRect,f=b.helper.containsOrEquals,g=b.Editor.prototype.closest,h=b.Editor.handle("move",function(){c&&d&&c.typer.invoke(function(a){a.selection.select(d),a.insertHtml(c.element)})});b.Editor.addLayer("dragWidget",function(a){var i=a.hoverNode;if(a.activeHandle===h){var j=g(i,b.Editor.NODE_PARAGRAPH|b.Editor.NODE_WIDGET);if(d=null,j&&!f(c,j)){var k=e(j),l=e(g(j,b.Editor.NODE_EDITABLE)),m=a.pointerY<k.centerY,n=m?j.previousSibling:j.nextSibling;if(n!==c&&a.typer.widgetAllowed(c.widget.id,j)){var o;if(n){var p=e(n);o=(k.bottom<=p.top?k.bottom+p.top:p.bottom+k.top)/2}else o=e(j,!0)[m?"top":"bottom"];a.drawLine(l.left,o,l.right,o,1,"red","dashed"),d=a.typer.createCaret(j.element,m)}}a.fill(c.element)}else!i||c&&!f(c,i)&&b.helper.pointInRect(a.pointerX,a.pointerY,e(c),10)||(c=g(i,b.Editor.NODE_WIDGET));c&&a.drawHandle(c,"top left",11,"data:image/gif;base64,R0lGODlhCwALAKEBAE1PUP///////////yH5BAEKAAIALAAAAAALAAsAAAIUjI8ZoAffDFOzuoexk5zGBUXTlxQAOw==",h)})}(0,zeta),function(a,c){function d(a){return a.filter(function(b){return!a.some(function(a){return a!==b&&a.contains(b)})})}function e(b){var c=a(b).css("text-align"),d=a(b).css("direction");switch(c){case"-webkit-left":case"-webkit-right":case"-webkit-center":return c.slice(8);case"start":return"ltr"===d?"left":"right";case"end":return"ltr"===d?"right":"left";default:return c}}function f(b,c){var d;return a(b).each(function(b,f){var g;g="textAlign"===c?e(f):"inlineClass"===c?a(f).attr("class")||"":a(f).css(c),d=""===d||d&&d!==g?"":g}),d||""}function g(a,b){return a=a.toLowerCase(),b=b.toLowerCase(),a===b||H.test(a)&&H.test(b)}function i(a,b){var c=B.createElement(a);return b&&(c.className=b),c}function j(b,c){return c=B.is(c,h)||i(c),a(c).append(b.childNodes).replaceAll(b)[0]}function l(c,d,e,f,g){var h=c.selection,i=h.getParagraphElements();if(h.isCaret&&!f)c.insertHtml(d),d.appendChild(B.createTextNode()),h.moveToText(d,-0);else{var j=h.getSelectedTextNodes();i.forEach(function(c){if(!g||!B.matchWord(b.getComputedStyle(c)[g[0]],g[1]))if(f){var h=a(j,c).parentsUntil(c).filter(e),i=h.contents().filter(function(a,b){return j.every(function(a){return!B.containsOrEquals(b,a)})});h.contents().unwrap(),i.wrap(d)}else a(c).find(j).wrap(d)}),h.select(j[0],0,j[j.length-1],-0)}a(i).find(e).filter(":has("+e+")").each(function(b,c){a(c).contents().unwrap().filter(function(a,b){return 3===b.nodeType}).wrap(c)}),a(i).find('span[class=""],span:not([class])').contents().unwrap(),a(i).find(e).each(function(b,c){B.sameElementSpec(c.previousSibling,c)&&(a(c.childNodes).appendTo(c.previousSibling),F(c))})}function m(b){a(b.selection.getParagraphElements()).attr("align",w[b.commandName])}function n(a){var b=a.commandName;l(a,i(x[b].split(",")[0]),x[b],a.widget[b],y[b])}function o(b,c){var d="insertOrderedList"===b.commandName||c?"ol":"ul",e="<"+d+(c||"").replace(/^.+/,' type="$&"')+">",f=function(b,e){return B.is(e,d)&&(a(e).attr("type")||"")===(c||"")},g=[];E(b.selection.getParagraphElements(),function(c,d){if(a(d).is("ol>li,ul>li"))a(d.parentNode).filter(f)[0]?a(d).is("li")&&a.inArray(d.parentNode,g)<0&&q(b,[d]):(j(d.parentNode,a(e)[0]),g.push(d.parentNode));else{var h=a(d).prev().filter(f)[0]||a(d).next().filter(f)[0]||a(e).insertAfter(d)[0];a(d)[B.comparePosition(d,h)<0?"prependTo":"appendTo"](h),j(d,"li"),g.push(h)}})}function p(b,c){c=a.makeArray(c||d(b.selection.getParagraphElements())),E(c,function(b,c){var d=a(c).parent("ul,ol")[0]||a(c).prev("ul,ol")[0]||a("<ul>").insertBefore(c)[0],e=d;if(e===c.parentNode){var f=a(c).prev("li")[0]||a("<li>").insertBefore(c)[0];e=a(f).children("ul,ol")[0]||a(d.cloneNode(!1)).appendTo(f)[0]}a(j(c,"li")).appendTo(e),a(e).parent("li")[0]&&a(B.createTextNode(" ")).insertBefore(e),d.children[0]||F(d)})}function q(b,c){c=a.makeArray(c||d(b.selection.getParagraphElements())),E(c,function(c,d){var e=a(d).parent("ul,ol")[0],f=a(e).parent("li")[0];a(d).next("li")[0]&&(f?a(e.cloneNode(!1)).append(a(d).nextAll()).appendTo(d):(a(e.cloneNode(!1)).append(a(d).nextAll()).insertAfter(e),a(d).children("ul,ol").insertAfter(e))),f?(a(d).insertAfter(f),B.trim(b.typer.extractText(f))||F(f)):a(j(d,"p")).insertAfter(e),e.children[0]||F(e)})}function r(b){var c=b.typer.getSelection().getSelectedElements();b.widget.inlineClass=f(a(c).filter("span"),"inlineClass"),E(y,function(a,d){b.widget[a]=!!B.matchWord(f(c,d[0]),d[1])})}function s(b){var c=b.typer.getSelection(),d=c.getParagraphElements().slice(-1)[0];a(d).is("li")&&(d=a(d).closest("ol, ul")[0]||d);var e=d&&d.tagName.toLowerCase(),g=e+(a(d).attr("class")||"").replace(/^(.)/,".$1"),h=f(c.getSelectedElements(),"textAlign");D(b.widget,{justifyLeft:"left"===h,justifyCenter:"center"===h,justifyRight:"right"===h,justifyFull:"justify"===h,formatting:e,formattingWithClassName:g})}function t(a,b){var c=a.context.typer.getSelection();return!!("inlineStyle"===b?c.startNode.nodeType&(A.NODE_PARAGRAPH|A.NODE_EDITABLE_PARAGRAPH|A.NODE_INLINE):c.getParagraphElements()[0])}function u(a,b){return I.button(a,J[a],{realm:b,execute:a,active:function(c){var d=c.context.typer.getStaticWidget(b);return d&&d[a]},enabled:function(a){return t(a,b)}})}function v(b,c){return I.button(B.camel(z[b]),{description:c,execute:function(a){a.context.typer.invoke(function(a){a.insertWidget("list",b)})},active:function(c){var d=c.context.typer.getSelection().getWidget("list");return d&&a(d.element).attr("type")===b}})}var w={justifyLeft:"left",justifyRight:"right",justifyCenter:"center",justifyFull:"justify"},x={bold:"b,strong",italic:"i,em",underline:"u",strikeThrough:"strike"},y={bold:["fontWeight","bold 700"],italic:["fontStyle","italic"],underline:["textDecoration","underline"],strikeThrough:["textDecoration","line-through"]},z={1:"decimal",A:"upper-alpha",a:"lower-alpha",I:"upper-roman",i:"lower-roman"},A=c.Editor,B=c.helper,C=c.dom,D=B.extend,E=B.each,F=B.removeNode,G=/^([a-z\d]*)(?:\.(.+))?/i,H=/^(p|h[1-6])(?:\.(.+))?$/i;A.widgets.inlineStyle={stateChange:r,contentChange:r,commands:{bold:n,italic:n,underline:n,strikeThrough:n,superscript:n,subscript:n,applyClass:function(a,b){l(a,i("span",b),"span")}}},A.widgets.formatting={stateChange:s,contentChange:s,enter:function(a){a.typer.widgetEnabled("lineBreak")&&B.is(a.typer.getSelection().startNode,A.NODE_EDITABLE_PARAGRAPH)?a.typer.invoke("insertLineBreak"):a.typer.invoke("insertLine"),a.handled()},commands:{justifyCenter:m,justifyFull:m,justifyLeft:m,justifyRight:m,formatting:function(b,c){var d=/^([a-z\d]*)(?:\.(.+))?/i.exec(c)||[];"ol"===d[1]||"ul"===d[1]?b.insertWidget("list","ol"===d[1]&&"1"):a(b.selection.getParagraphElements()).not("li").each(function(a,b){d[1]&&!B.is(b,d[1])&&g(d[1],b.tagName)?j(b,i(d[1]||"p",d[2])):b.className=d[2]||""})},insertLine:function(a){a.insertText("\n\n")},insertLineBefore:function(a){var b=a.selection.focusNode.widget;"__root__"!==b.id&&(a.selection.select(b.element,!0),a.insertText("\n\n"))}}},A.widgets.lineBreak={enter:function(a){a.typer.invoke("insertLineBreak"),a.handled()},shiftEnter:function(a){a.typer.invoke("insertLineBreak"),a.handled()},commands:{insertLineBreak:function(a){a.insertHtml("<br>")}}},A.widgets.list={element:"ul,ol",editable:"ul,ol",textFlow:!0,create:o,remove:function(a){q(a,a.widget.element.children)},extract:function(a){},receive:function(a){B.sameElementSpec(a.widget.element,a.receivedNode)&&(a.preventDefault(),a.typer.invoke(function(b){b.insertHtml(a.receivedNode.childNodes)}))},tab:function(a){a.typer.invoke("indent")},shiftTab:function(a){a.typer.invoke("outdent")},init:function(b){a(b.widget.element).filter("ol").attr("type-css-value",z[a(b.widget.element).attr("type")]||"decimal"),a(b.widget.element).parent("li")[0]&&!b.widget.element.previousSibling&&a(B.createTextNode()).insertBefore(b.widget.element)},contentChange:function(b){a(b.widget.element).children("li")[0]||b.typer.invoke(function(a){F(b.widget.element)})},setup:function(a){a.typer.on("tab",function(a){a.typer.invoke(p),a.handled()})},commands:{indent:p,outdent:q}},D(A.defaultOptions,{lineBreak:!0,formatting:!0,inlineStyle:!0,list:!0}),C.setShortcut({bold:"ctrlB",italic:"ctrlI",underline:"ctrlU",justifyLeft:"ctrlShiftL",justifyCenter:"ctrlShiftE",justifyRight:"ctrlShiftR",insertLineBefore:"ctrlEnter"});var I=new c.UI("zeta.editor.formatting",{contextChange:function(a,b){E("formatting inlineStyle list",function(a,c){b[c]=b.context.typer.widgetEnabled(c)})}}),J={bold:"",italic:"",underline:"",strikeThrough:"",unorderedList:"",orderedList:"",indent:"",outdent:"",justifyLeft:"",justifyCenter:"",justifyRight:"",justifyFull:""},K=I.buttonlist(I.button("inlineStyleClear",function(a){a.context.typer.invoke("applyClass","")}),{after:"*"});I.export("zeta.editor.toolbar",I.buttonset(I.dropdown("paragraph",{realm:"formatting",execute:"formatting",visible:function(a){return t(a,"formatting")&&a.controls.length>0},contextChange:function(a,b){var c=b.context.typer.getSelection(),d=b.context.typer.getStaticWidget("formatting"),e=(c.startNode===c.endNode?c.startNode:c.focusNode).element,f=B.any(b.controls,function(a){return a.value===d.formattingWithClassName});b.choices=B.map(b.context.options.formattings,function(a,b){return!G.test(b)||g(e.tagName,k.$1)?{value:b,label:a}:null}),b.value=f?f.value:d.formatting}}),I.dropdown("inlineStyle",{realm:"inlineStyle",execute:"applyClass",init:function(a,b){b.choices=b.context.options.inlineClass,b.append(K)},visible:function(a){return t(a,"inlineStyle")&&a.controls.length>1},contextChange:function(a,b){var c=b.context.typer.getStaticWidget("inlineStyle");b.value=c.inlineClass}}),u("bold","inlineStyle"),u("italic","inlineStyle"),u("underline","inlineStyle"),u("strikeThrough","inlineStyle"),I.button("unorderedList",J.unorderedList,{realm:"list",execute:function(a){a.context.typer.invoke(function(a){a.insertWidget("list")})},active:function(a){var b=a.context.typer.getSelection().getWidget("list");return b&&B.is(b.element,"ul")},enabled:function(a){return t(a,"list")&&a.context.typer.getSelection().widgetAllowed("list")}}),I.callout("orderedList",J.orderedList,v("1","1, 2, 3, 4"),v("a","a, b, c, d"),v("A","A, B, C, D"),v("i","i, ii, iii, iv"),v("I","I, II, III, IV"),{realm:"list",active:function(a){var b=a.context.typer.getSelection().getWidget("list");return b&&B.is(b.element,"ol")},enabled:function(a){return t(a,"list")&&a.context.typer.getSelection().widgetAllowed("list")}}),u("indent","list"),u("outdent","list"),u("justifyLeft","formatting"),u("justifyCenter","formatting"),u("justifyRight","formatting"),u("justifyFull","formatting"))),I.i18n("en",{bold:"Bold",italic:"Italic",underline:"Underlined",strikeThrough:"Strikethrough",unorderedList:"Bullet list",orderedList:"Numbered list",indent:"Indent",outdent:"Outdent",justifyLeft:"Align left",justifyCenter:"Align center",justifyRight:"Align right",justifyFull:"Align justified",paragraph:"Formatting",inlineStyle:"Text style",inlineStyleClear:"Clear style",decimal:"Decimal numbers",lowerAlpha:"Alphabetically ordered list, lowercase",upperAlpha:"Alphabetically ordered list, uppercase",lowerRoman:"Roman numbers, lowercase",upperRoman:"Roman numbers, uppercase",format_p:"Paragraph",format_h1:"Header 1",format_h2:"Header 2",format_h3:"Header 3",format_h4:"Header 4",format_h5:"Header 5",format_h6:"Header 6",format_table:"Table",format_td:"Table cell",format_th:"Table header",format_ul:"Unordered list",format_ol:"Ordered list",format_li:"List item",format_blockquote:"Blockquote"})}(a,zeta),function(a,d){function e(a){var b=c.createElement("a");return b.href=a||"",location.protocol===b.protocol&&location.hostname===b.hostname&&(location.port===b.port||""===location.port&&b.port===("https:"===location.protocol?"443":"80"))?b.pathname.replace(/^(?!\/)/,"/")+b.search+b.hash:a}function f(b){var c,d=b.context.typer,e=(b.state.widget||"").element;if(e)c={href:e.getAttribute("href"),text:e.textContent,blank:"_blank"===e.getAttribute("target")};else{var f=d.getSelection().getSelectedText();c={href:/^[a-z]+:\/\//g.test(f)?f:"",text:f,blank:!1}}var g,i=b.context.options.selectLink;return g="function"==typeof i?i(c):h.render(c).dialog,g.then(function(b){if(!b)return null;var c=b.href||b,f=b.text||c;d.invoke(function(g){e||(e=a('<a href="">').text(f)[0],g.insertHtml(e),g.selection.select(e,"contents")),a(e).text(f),a(e).attr("target",b.blank?"_blank":null),d.invoke("setURL",c)})})}d.Editor.widgets.link={element:"a[href]",inline:!0,create:function(b,c){c=e(c),"link"===b.selection.focusNode.widget.id?b.invoke("setURL",c):b.insertHtml(a("<a>").text(b.selection.getSelectedText()||c).attr("href",c)[0])},remove:"keepText",setup:function(a){a.typer.on("contentChange",function(a){var b=a.sourceKeyName;if("enter"===b||"space"===b){var c=a.typer.getSelection().clone();if(c.moveByCharacter(-1),c.getCaret("start").moveByWord(-1)&&"link"!==c.focusNode.widget.id&&/^([a-z]+:\/\/\S+)|(\S+@\S+\.\S+)/g.test(c.getSelectedText())){var d=k.$1||"mailto:"+k.$2;a.typer.invoke(function(b){var e=b.selection.clone();a.typer.snapshot(!0),a.typer.select(c),b.insertWidget("link",d),a.typer.select(e)})}}})},init:function(a){a.widget.element.style.cursor="text"},ctrlClick:function(a){b.open(a.widget.element.href)},commands:{setURL:function(a,b){a.widget.element.href=e(b)},unlink:function(a){a.removeWidget(a.widget)}}},d.Editor.defaultOptions.link=!0;var g=new d.UI("zeta.editor.link",{contextChange:function(a,b){var c=b.context.typer;if(c){var d=c.getSelection();b.widget=d.getWidget("link"),b.widgetAllowed=d.widgetAllowed("link")}}}),h=g.dialog(g.textbox("text",!0),g.textbox("href",!0),g.checkbox("blank"),g.buttonset(g.button("remove","delete",{danger:!0,execute:function(a){a.parentContext.typer.invoke("unlink")},visible:function(a){return a.parentContext.typer.hasCommand("unlink")}}),g.submit("submit","done"),g.button("cancel","cancel",function(a){return a.all.dialog.destroy()})));g.export("zeta.editor.toolbar",g.button("insertLink","insert_link",{realm:"widgetAllowed",after:"insertWidgets",execute:f,active:function(a){return a.state.widget},contextChange:function(a,b){b.label=b.state.widget?"editLink":"insertLink"}})),g.export("zeta.editor.contextmenu",g.buttonlist(g.button("open",{realm:"widget",shortcut:"ctrlClick",execute:function(a){b.open(a.state.widget.element.href)}}),g.button("editLink",{realm:"widget",execute:f}),g.button("removeLink",{realm:"widget",execute:"unlink"}))),g.i18n("en",{insertLink:"Insert hyperlink",editLink:"Edit hyperlink",removeLink:"Remove hyperlink",remove:"Remove",text:"Text",href:"Link URL",blank:"Open in new window",open:"Open hyperlink"})}(a,zeta),function(a,b){function c(a,b){var c,d=a.context.options.selectMedia;if(f.isFunction(d)){c=d(e.exec(a.label)&&(k.$1?"image":k.$2?"video":"audio"),a.value)}else c=g.prompt("imageURL",a.value);return c.then(b)}function d(a,b){return g.button(a,b,{realm:"widgetAllowed",execute:function(a){return c(a,function(){a.context.typer.invoke(function(b){b.insertWidget("media",a.value)})})}})}var e=/\.(?:(jpg|jpeg|png|gif|webp)|(mp4|ogg|webm)|(mp3))(?:\?.*)?$/i,f=b.helper;b.Editor.widgets.media={element:"img,audio,video,a:has(>img)",text:function(a){return a.element.src},create:function(b,c){var d=f.createElement(e.test(c.src||c)?k.$2?"video":k.$3?"audio":"img":"img");d.src=c.src||c,f.is(d,"video")&&a(d).attr("controls",""),b.insertHtml(d)}},b.Editor.defaultOptions.media=!0;var g=new b.UI("zeta.editor.media",{contextChange:function(a,b){var c=b.context.typer.getSelection();b.widget=c.getWidget("media"),b.widgetAllowed=c.widgetAllowed("media")}});g.export("zeta.editor.insertMenu",d("image","insert_photo"),d("video","videocam")),g.export("zeta.editor.toolbar",g.buttonset(g.button("filePicker",{realm:"widget",showText:!0,showIcon:!1,contextChange:function(b,c){c.value=a(c.state.widget.element).attr("src"),c.label=(/(?:^|\/)([^\/?#]+)(?:\?.+)?$/.exec(c.value)||[])[1]||""},execute:function(b){return c(b,function(c){a(b.state.widget.element).attr("src",c.src||c)})}}),g.textbox("altText",{realm:"widget",icon:"comment",contextChange:function(b,c){c.value=a(c.state.widget.element).attr("alt")},execute:function(b){a(b.state.widget.element).attr("alt",b.value).attr("title",b.value)}}))),g.i18n("en",{insertImage:"Image",insertVideo:"Video",altText:"Alternate text",imageURL:"Image URL"})}(a,zeta),function(a,b){function c(b,c,e){var f=b.options.target;d.setState(d.is(f,h)||a(b.typer.element).parents(f).addBack()[0],b.options[c],e)}var d=b.helper;b.Editor.widgets.stateclass={options:{target:null,disabled:"disabled",focused:"focused",empty:"empty"},focusin:function(a){c(a.widget,"focused",!0)},focusout:function(a){c(a.widget,"focused",!1)},stateChange:function(a){c(a.widget,"disabled",!a.typer.enabled())},typing:function(a){c(a.widget,"empty",!a.typer.hasContent())},contentChange:function(a){c(a.widget,"empty",!a.typer.hasContent())},init:function(a){c(a.widget,"empty",!a.typer.hasContent())}}}(a,zeta),function(a,b){function c(a,b,c,d,e){var f=this;f.widget=a,f.element=a.element,f.minCol=c,f.minRow=b,f.maxCol=e,f.maxRow=d}function d(b){var d=b.focusNode.widget;if("table"===d.id){var e=a(b.startElement).parentsUntil(d.element).addBack(),f=a(b.endElement).parentsUntil(d.element).addBack();return new c(d,e.eq(1).index(),e.eq(2).index(),f.eq(1).index(),f.eq(2).index())}}function e(b,c){return a(v,b.element||b)[c]}function f(a,b,c){return"string"==typeof b?f(a,g.min(a[b+"Row"],h(a)-1),g.min(a[b+"Col"],i(a)-1)):e(a,b).children[c]}function h(b){return a(v,b.element||b).length}function i(a){return e(a,0).childElementCount}function j(a){return!!w.is(f(a,0,0),"th")}function k(b,c,d){if(b.isSingleEditable){var e=a(b.focusNode.element)[c]()[0]||a(b.focusNode.element).parent()[c]().children(d)[0];e&&b.moveToText(e,-0)}}function l(b){a("td,th",b.element||b).css({outline:"1px dotted rgba(0,0,0,0.3)",minWidth:"3em"})}function m(a,b,d,e,f){a.typer.select(new c(a,b,d,b+e-1,d+f-1))}function n(b,c,d,e){var f="string"==typeof c?c+"-child":"nth-child("+(c+1)+")",g=e?"before":"after";a(b.element||b).find(v+">th:"+f)[g](y(t,d)),a(b.element||b).find(v+">td:"+f)[g](y(s,d)),l(b)}function o(b,c,d,f,g){a(e(b,"last"===c?h(b)-1:c))[g?"before":"after"](y(u.replace("%",y(f,i(b))),d)),l(b)}function p(b,c){var d=j(b);d&&!c?(a(">th",e(b,0)).wrapInner("<p>").each(function(b,c){a(c).replaceWith(a(s).append(c.childNodes))}),l(b)):d||!c&&void 0!==c||o(b,0,1,t,!0)}function q(b,c,d){for(var e=a(c?v+":first>*":v,b.element),f=e.length-1;f>=0;f--){var g=w.getRect(e[f]);if((c?g.left:g.top)<d)return f}return 0}var r,s="<td></td>",t="<th></th>",u="<tr>%</tr>",v=">tbody>tr",w=b.helper,x=w.removeNode,y=w.repeat;c.prototype={get numCol(){return g.abs(this.maxCol-this.minCol)+1},get numRow(){return g.abs(this.maxRow-this.minRow)+1},get mode(){return(this.numCol===i(this))+2*(this.numRow===h(this))},rows:function(b){a(v,this.element).splice(this.minRow,this.numRow).forEach(b)},cells:function(b){var c=this;c.rows(function(d,e){a(d.children).splice(c.minCol,c.numCol).forEach(function(a,c){b(a,e,c)})})},getRange:function(){return w.createRange(f(this,"min"),0,f(this,"max"),-0)},acceptNode:function(a){var b=!1;return a.element===this.element?1:(this.cells(function(c){b|=w.containsOrEquals(c,a.element)}),b||2)},remove:function(a){var b=this;1===a?b.rows(x):2===a&&b.cells(x),b.widget.typer.select(f(b,"min"),-0)}},b.Editor.widgets.table={element:"table",editable:"th,td",create:function(a,b){b=b||{},a.insertHtml("<table>"+y(u.replace("%",y(s,b.columns||2)),b.rows||2)+"</table>")},init:function(b){a(b.widget.element).removeAttr("x-table-copymode"),l(b.widget)},extract:function(b){var c=b.widget.element,d=b.extractedNode;if(r&&r.widget===b.widget){var e=r.mode;1!==e&&2!==e||(a(d).attr("x-table-copymode",e),"paste"!==b.source&&"cut"!==b.source||r.remove(e))}else if(h(d)>1){var f=i(c);a(v,d).each(function(b,c){c.childElementCount<f&&a(y(a(">th",c)[0]?t:s,f-c.childElementCount))[b?"appendTo":"prependTo"](c)})}},receive:function(b){var c=+a(b.receivedNode).attr("x-table-copymode");if(c||"paste"===b.source){var k=b.typer.getSelection(),q=r&&r.widget===b.widget?r:d(k),t=b.widget.element,u=b.receivedNode,w=j(t);p(u,1!==c&&(2===c?w:0===q.minRow&&w));var x=h(u),y=i(u),z=h(t),A=i(t),B=1===c?q.minRow===z:q.minCol===A;2===c?(o(x>z?t:u,"last",g.abs(x-z),s,!1),a(v,u).each(function(b,c){a(c.children)[B?"insertAfter":"insertBefore"](f(t,b,q.minCol-B))}),m(b.widget,0,q.minCol,h(t),y)):1===c?(0===q.minRow&&w&&q.minRow++,n(y>A?t:u,"last",g.abs(y-A),!1),a(v,u)[B?"insertAfter":"insertBefore"](e(t,q.minRow-B)),m(b.widget,q.minRow,0,x,i(t))):(1===q.numRow&&1===q.numCol&&(q.maxCol=q.minCol+y-1,q.maxRow=q.minRow+x-1,q.maxRow>z-1&&o(t,"last",q.maxRow-z+1,s,!1),q.maxCol>A-1&&n(t,"last",q.maxCol-A+1,!1)),q.cells(function(b,c,d){a(b).replaceWith(f(u,c%x,d%y).cloneNode(!0))}),k.select(q)),l(t),b.preventDefault()}},tab:function(a){k(a.typer.getSelection(),"next",":first-child"),a.handled()},shiftTab:function(a){k(a.typer.getSelection(),"prev",":last-child"),a.handled()},keystroke:function(a){if(r&&r.widget===a.widget&&("backspace"===a.data||"delete"===a.data)){var b=r.mode;1!==b&&2!==b||(r.remove(b),a.handled())}},commands:{addColumnBefore:function(a){var b=d(a.selection);n(a.widget,b.minCol,b.numCol,!0)},addColumnAfter:function(a){var b=d(a.selection);n(a.widget,b.maxCol,b.numCol,!1)},addRowAbove:function(a){var b=d(a.selection);o(a.widget,b.minRow,b.numRow,s,!0)},addRowBelow:function(a){var b=d(a.selection);o(a.widget,b.maxRow,b.numRow,s,!1)},removeColumn:function(a){d(a.selection).remove(2)},removeRow:function(a){d(a.selection).remove(1)},toggleTableHeader:function(b){p(b.widget),a(">th",e(b.widget,0)).text(function(a,b){return b||"Column "+(a+1)})}}},b.UI.define("tableGrid",{
template:'<div class="zeta-grid"><div class="zeta-grid-wrapper"></div><z:label/></div>',init:function(b,c){var d=a(c.element);d.find(".zeta-grid-wrapper").append(y('<div class="zeta-grid-row">'+y('<div class="zeta-grid-cell"></div>',7)+"</div>",7)),d.find(".zeta-grid-cell").mouseover(function(){c.value.rows=a(this).parent().index()+1,c.value.columns=a(this).index()+1,c.label=c.value.rows+" × "+c.value.columns,d.find(".zeta-grid-cell").removeClass("active"),d.find(".zeta-grid-row:lt("+c.value.rows+")").find(".zeta-grid-cell:nth-child("+c.value.columns+")").prevAll().addBack().addClass("active")}),c.label="0 × 0",c.value={}},click:function(a,b){return b.execute()}});var z=new b.UI("zeta.editor.table",{contextChange:function(a,b){var c=b.context.typer.getSelection();b.widget=c.getWidget("table"),b.widgetAllowed=c.widgetAllowed("table")}});z.export("zeta.editor.insertMenu",z.callout("insertTable",z.tableGrid({realm:"widgetAllowed",execute:function(a){a.context.typer.invoke(function(b){b.insertWidget("table",a.value)})}}))),z.export("zeta.editor.contextmenu",z.callout("modifyTable",z.checkbox("showHeader",{realm:"widget",execute:"toggleTableHeader",contextChange:function(a,b){b.value=j(b.state.widget)}}),z.dropdown("style",{realm:"widget",valueAsLabel:!1,init:function(a,b){b.choices=b.context.options.tableStyles,b.append(z.button("styleDefault",{after:"*"}))},execute:function(a){a.state.widget.element.className=a.value||""},contextChange:function(a,b){b.value=b.state.widget.element.className||""}}),z.dropdown("tableWidth",{realm:"widget",valueAsLabel:!1,choices:{"":"fitContent","100%":"fullWidth"},execute:function(b){a(b.state.widget.element).attr("width",b.value||null)},contextChange:function(b,c){c.value=a(c.state.widget.element).attr("width")||""}}),z.buttonlist("addRemoveCell",z.button("addColumnBefore",{realm:"widget",execute:"addColumnBefore"}),z.button("addColumnAfter",{realm:"widget",execute:"addColumnAfter"}),z.button("addRowAbove",{realm:"widget",execute:"addRowAbove",enabled:function(a){return!j(a.state.widget)||d(a.context.typer.getSelection()).minRow>0}}),z.button("addRowBelow",{realm:"widget",execute:"addRowBelow"}),z.button("removeColumn",{realm:"widget",execute:"removeColumn"}),z.button("removeRow",{realm:"widget",execute:"removeRow"})),{hiddenWhenDisabled:!0})),z.i18n("en",{insertTable:"Table",modifyTable:"Modify table",showHeader:"Show header",style:"Table style",styleDefault:"Default",addColumnBefore:"Add column before",addColumnAfter:"Add column after",addRowAbove:"Add row above",addRowBelow:"Add row below",removeColumn:"Remove column",removeRow:"Remove row",tableWidth:"Table width",fitContent:"Fit to content",fullWidth:"Full width"});var A,B=b.Editor.handle("cell"),C=b.Editor.handle("cell");b.Editor.addLayer("table",function(a){var b=a.hoverNode&&a.hoverNode.widget;if(b&&"table"===b.id){var e=w.getRect(b);a.drawLine(e.left,e.top,e.right,e.top,10,"transparent","solid",B),a.drawLine(e.left,e.top,e.left,e.bottom,10,"transparent","solid",C)}var j=a.typer.getSelection(),k=a.activeHandle;if(k===B||k===C){var l=k===B,n=q(A?r:b,l,l?a.pointerX:a.pointerY);A||(r=new c(b,0,0,h(b)-1,i(b)-1),r[l?"minCol":"minRow"]=n),r[l?"maxCol":"maxRow"]=n,A=!0}else a.selectionChanged&&(r=d(j),!r||1===r.numRow&&1===r.numCol?(r=null,A=!1):A=!0);if(A&&!a.mousedown&&(A=!1,3===r.mode?(j.select(r.element),r=null):m(r.widget,g.min(r.minRow,r.maxRow),g.min(r.minCol,r.maxCol),r.numRow,r.numCol)),r){var o=f(r,"min"),p=f(r,"max");a.fill(w.mergeRect(w.getRect(o),w.getRect(p)))}a.toggleLayer("selection",!r)})}(a,zeta),function(a,d){function e(b){if(!1===o)b();else if(!o){var d=function(){o=!0};a(c).one("paste",d),m(function(){a(c).off("paste",d),o||(o=!1,b())})}}function f(b){var c=a(b.element).height(),e=d.helper.getRect(b.widget||b.typer);if(0!==e.left||0!==e.top||0!==e.width||0!==e.height){var f={position:"fixed",left:e.left,top:g.max(0,e.top-c-10)},h=b.typer.getSelection().extendCaret.getRect();h.top>=f.top&&h.top<=f.top+c&&(f.top=h.bottom+10),a(b.element).css(f)}}function h(b){n!==b&&(i(),n=b,a(b.element).appendTo(c.body),d.helper.setZIndexOver(b.element,b.typer.element)),f(b)}function i(b){n&&(b||n)===n&&(a(n.element).detach(),n.position="",n=null)}function j(b,d,e){var f=c.createElement("div"),g=e.render(f,{typer:b,options:d,element:f});return b.retainFocus(f),d.container&&e!==l?a(f).appendTo(d.container):a(f).addClass("zeta-float"),g}var k,l,n,o;d.Editor.widgets.toolbar={options:{container:"",formattings:{p:"Paragraph",h1:"Heading 1",h2:"Heading 2",h3:"Heading 3",h4:"Heading 4"},inlineClasses:{}},init:function(a){a.widget.toolbar=j(a.typer,a.widget.options,k),a.widget.contextmenu=j(a.typer,a.widget.options,l)},focusin:function(a){var b=a.widget.toolbar;b.update(),b.options.container||h(b)},focusout:function(a){i(a.widget.toolbar)},rightClick:function(a){var b=a.widget.contextmenu;b.update(),d.helper.position(b.element,{x:a.clientX,y:a.clientY}),m(function(){d.dom.focus(b.element)}),a.preventDefault()},stateChange:function(a){var b=a.widget.toolbar;b.update(),n===b&&(a.typer.enabled()?f(b):i(b))}},a(b).scroll(function(){n&&f(n)});var p=new d.UI("zeta.editor");k=p.buttonset(p.callout("insertWidgets","widgets",p.import("zeta.editor.insertMenu")),p.import("zeta.editor.toolbar"),{showText:!1}),l=p.menu(p.buttonlist(p.button("undo","",{execute:"undo",enabled:function(a){return a.context.typer.canUndo()}}),p.button("redo","",{execute:"redo",enabled:function(a){return a.context.typer.canRedo()}}),{hiddenWhenDisabled:!1}),p.buttonlist(p.button("selectAll","select_all",{execute:"selectAll"}),p.button("selectParagraph",{hiddenWhenDisabled:!0,execute:function(a){var b=a.context.typer.getSelection();b.select(b.startNode.element,"contents"),b.focus()},enabled:function(a){return a.context.typer.getSelection().isCaret}})),p.buttonlist(p.button("cut","content_cut",{shortcut:"ctrlX",execute:function(a){a.context.typer.getSelection().focus(),c.execCommand("cut")}}),p.button("copy","content_copy",{shortcut:"ctrlC",execute:function(a){a.context.typer.getSelection().focus(),c.execCommand("copy")}}),p.button("paste","content_paste",{shortcut:"ctrlV",execute:function(a){a.context.typer.getSelection().focus(),c.execCommand("paste"),e(function(){p.alert("clipboardError")})}})),p.import("zeta.editor.contextmenu")),p.i18n("en",{undo:"Undo",redo:"Redo",cut:"Cut",copy:"Copy",paste:"Paste",selectAll:"Select all",selectParagraph:"Select paragraph",insertWidgets:"Insert",clipboardError:"Unable to access clipboard due to browser security. Please use Ctrl+V or [Paste] from browser's menu."})}(a,zeta),function(a,b){function c(a,b,c){return b.invalidCharsRegex&&(a=a.replace(b.invalidCharsRegex,"")),b.maxlength&&(a=a.substr(0,b.maxlength-c)),a}b.Editor.widgets.validation={options:{invalidChars:"",allowChars:"",maxlength:0},init:function(a){var b=a.widget.options;b.invalidChars&&(b.invalidCharsRegex=new k("["+b.invalidChars.replace(/[\[\]\\^]/g,"\\$&")+"]","g")),b.allowChars&&(b.invalidCharsRegex=new k("[^"+b.allowChars.replace(/[\[\]\\^]/g,"\\$&")+"]","g"))},contentChange:function(a){if("script"===a.source){var b=a.typer.extractText(),d=c(b,a.widget.options,0);d!==b&&a.typer.setValue(d)}},textInput:function(a){var b=c(a.data,a.widget.options,a.typer.extractText().length-a.typer.getSelection().getSelectedText().length);b!==a.data&&(a.handled(),b&&a.typer.invoke(function(a){a.insertText(b)}))}}}(0,zeta),function(a,b){var d=b.helper;b.IS_TOUCH||a(c.documentElement).on("mousedown",".zeta-ui button, .zeta-ui .has-clickeffect",function(c){var e=c.currentTarget,f=c.clientX,h=c.clientY,i=d.getRect(e),j=g.pow(h-i.top,2)+g.pow(f-i.left,2),k=g.pow(h-i.top,2)+g.pow(f-i.right,2),n=g.pow(h-i.bottom,2)+g.pow(f-i.left,2),o=g.pow(h-i.bottom,2)+g.pow(f-i.right,2),p=.5+2*g.sqrt(g.max(j,k,n,o))/l(a.css(e,"font-size")),q=a('<div class="zeta-clickeffect"><i></i></div>').appendTo(e),r=q.children().css({top:h-i.top,left:f-i.left});m(function(){r.css("transform",r.css("transform")+" scale("+p+")").addClass("animate-in")}),q.css("border-radius",a.css(e,"border-radius")),d.always(b.dom.drag(c),function(){d.runCSSTransition(q.children()[0],"animate-out").then(function(){q.remove()})})})}(a,zeta),function(a,b,d){function e(a,b){for(var c=[],d=0;d<a;d++)c[d]=b(d);return c}function f(a){return a.getFullYear()}function h(a){return a.getMonth()}function i(a){return a.getDate()}function j(a){return a.getHours()}function l(a){return a.getMinutes()}function n(a,b){return f(a)===f(b)&&h(a)===h(b)}function p(a){return"string"==typeof a&&/^today|([+-]\d+)(day|week|month|year)?$/g.test(a)?k.$1?s(k.$2||"day",new d,+k.$1):new d:(a=null===a?void 0:a instanceof d?a:new d(a),isNaN(a)?void 0:a)}function q(a,b){var c=new d;return c.setHours(a,b,0,0),c}function r(a,b){var c=p(a.min),e=p(a.max);switch(b=new d(+(b<c?c:b>e?e:b)),a.mode||a){case"week":b.setDate(i(b)-b.getDay());break;case"month":b.setDate(1)}return"datetime"!==(a.mode||a)?b.setHours(0,0,0,0):b.setSeconds(0,0),b}function s(a,b,c,e){switch(a){case"minute":var j=c/g.abs(c);return new d(+b+6e4*(((j>0?e:0)-l(b)%e||e*j)+e*(c-j)));case"day":return new d(+b+C*c);case"week":return new d(+b+7*C*c);case"month":return new d(f(b),h(b)+c,i(b));case"year":return new d(f(b)+c,h(b),i(b))}}function t(a,b){switch(a){case"month":return A[h(b)]+" "+f(b);case"week":var c=s("day",b,6);return A[h(b)]+" "+i(b)+" - "+(h(c)!==h(b)?A[h(c)]+" ":"")+i(c)+", "+f(b)}var d=A[h(b)]+" "+i(b)+", "+f(b);return"datetime"===a?d+" "+(j(b)||12)+":"+("0"+l(b)).slice(-2)+" "+(j(b)>=12?"PM":"AM"):d}function u(b,c){if(!isNaN(+c)){"number"==typeof c&&(c=s("month",b.currentMonth,c));var g=p(b.min),j=p(b.max),k=r({mode:"month",min:g,max:j},c),l=f(k),m=h(k),o=I.all(b),q=k.getDay(),t=a("td",b.element).removeClass("selected disabled");if(!b.currentMonth||!n(k,b.currentMonth)){var u=new d(l,m+1,0).getDate(),v=new d(l,m,0).getDate();t.removeClass("prev cur next today"),t.each(function(b,c){b<q?a(c).children().text(b+1-q+v).end().addClass("prev"):b>=u+q?a(c).children().text(b+1-q-u).end().addClass("next"):a(c).children().text(b+1-q).end().addClass("cur")});var w=new d;n(k,w)&&t.eq(i(w)+q-1).addClass("today"),a("tr:last",b.element).toggle(q+u>35),o.year.choices=e(11,function(a){return l+a-5}),b.currentMonth=k}o.year.value=l,o.month.value=m;var x=g&&n(k,g),y=j&&n(k,j);o.prevMonth.enabled=!x,o.nextMonth.enabled=!y,x&&t.slice(0,i(g)+q-1).addClass("disabled"),y&&t.slice(i(j)+q).addClass("disabled");var z=n(k,b.value);if(z||"week"===b.mode&&n(k,s("day",b.value,6)))switch(b.mode){case"day":t.eq(i(b.value)+q-1).addClass("selected");break;case"week":t.slice(z?i(b.value)+q-1:0).slice(0,7).addClass("selected");break;case"month":t.filter("td.cur").addClass("selected")}a(b.element).toggleClass("select-range","day"!==b.mode)}}function v(){var a={template:'<z:callout label="{{selectedText}}" show-text="true"/>'},b=new o.Map;e(12,function(a){b.set(a,A[a].toLowerCase())}),x={year:I.dropdown("year",function(a){return u(a.parent,new d(a.value,h(a.parent.currentMonth)))},a),month:I.dropdown("month",b,function(a){return u(a.parent,new d(f(a.parent.currentMonth),a.value))},a),prev:I.button("prevMonth","",function(a){return u(a.parent,-1)}),setToday:I.button("setToday","",function(a){return a.parent.execute(new d)}),next:I.button("nextMonth","",function(a){return u(a.parent,1)}),hour:I.number("hour",{options:{min:0,max:23,loop:!0},execute:function(a){a.parent.execute(q(a.value,a.all.minute.value))}}),timeSeperator:I.label("timeSeperator"),minute:I.number("minute",{options:{min:0,max:59,digits:"fixed",loop:!0},execute:function(a){a.parent.execute(q(a.all.hour.value,a.value))}}),meridiem:I.button("meridiem",{value:!1,label:"am",showText:!0,propertyChange:function(a,b){b.label=b.value?"pm":"am"},execute:function(a){a.value=!a.value,a.parent.execute(q(a.all.hour.value%12+(a.value?12:0),a.all.minute.value))}})}}function w(){var b=function(a,b){var c=new d(+b.all.calendar.value);c.setHours(j(b.all.clock.value),l(b.all.clock.value)),y.setValue(c)},c=I.calendar({executed:b,contextChange:function(a,b){b.min=z.min,b.max=z.max,b.mode="datetime"===z.mode?"day":z.mode}}),e=I.clock({hiddenWhenDisabled:!0,executed:b,contextChange:function(a,b){b.step=z.minuteStep,b.enabled="datetime"===z.mode}}),f=I.submit("done","done",{execute:function(b){a(z.element).detach()}});z=I.menu(I.buttonset(c,e),I.generic({controls:[I.buttonset(f)],template:'<z:generic><controls layout="dialog"/></z:generic>'}),{hideCalloutOnBlur:!1}).render()}var x,y,z,A="January February March April May June July August September October November December".split(" "),B="Su Mo Tu We Th Fr Sa".split(" "),C=864e5,D=6e4*(new d).getTimezoneOffset(),E={datetime:"datetime-local",day:"date",week:"week",month:"month"},F=b.helper,G=b.dom,H=F.repeat,I=new b.UI("zeta.ui.datepicker");b.UI.define("calendar",{template:'<div class="zeta-calendar"><div class="zeta-calendar-header"><z:buttonset show-text="false"/></div><div class="zeta-calendar-body"><table></table></div></div>',hideCalloutOnExecute:!1,value:null,mode:"day",min:null,max:null,setValue:function(a,b){var c=r(this,a.newValue);b.selectedDate=c,b.value=c,u(b,c)},init:function(b,c){x||v(),c.append([x.year,x.month,x.prev,x.setToday,x.next]);var e=function(){c.value=r(c,c.selectedDate)};c.watch("mode",e),c.watch("min",e),c.watch("max",e);var g=a("table",c.element);a(H("<tr></tr>",7)).appendTo(g),a(H("<th></th>",7)).appendTo(g.find("tr:first")),a(H("<td></td>",7)).appendTo(g.find("tr+tr")),a("<button>").appendTo(g.find("td")),g.find("th").text(function(a){return B[a]}),g.find("td").click(function(){var b=a(this).hasClass("prev")?-1:a(this).hasClass("next")?1:0;c.execute(new d(f(c.currentMonth),h(c.currentMonth)+b,+this.textContent))}),c.value?u(c,0):c.value=new d},mousewheel:function(a,b){u(b,a.data),a.handled()},contextChange:function(a,b){u(b,b.currentMonth||b.value||new d)}}),b.UI.define("clock",{template:'<div class="zeta-clock"><div class="zeta-clock-face"><s hand="h"></s><s hand="m"></s></div><z:buttonset/></div>',hideCalloutOnExecute:!1,step:1,value:null,init:function(b,e){x||v(),e.append([x.hour,x.timeSeperator,x.minute,x.meridiem]),e.value||(e.value=new d),e.watch("step",function(){I.all(e).minute.options.step=e.step}),60%e.step>0&&(e.step=1);var f=a(".zeta-clock-face",e.element);a(H("<i></i>",12)).appendTo(f).each(function(b,c){a(c).css("transform","rotate("+30*b+"deg)")}),a("s",e.element).on("mousedown touchstart",function(b){var d=b.target,f=F.getRect(d.parentNode),h="touchstart"===b.type,i={};i[h?"touchmove":"mousemove"]=function(a){if(!h&&1!==a.which)return i.mouseup();var b=h?a.originalEvent.touches[0]:a,c=g.atan2(b.clientY-f.centerY,b.clientX-f.centerX)/g.PI,k=l(e.value),m=j(e.value);if("m"===d.getAttribute("hand")){var n=g.round((30*c+75)/e.step)*e.step%60;if(n!==k){var o=g.floor(g.abs(k-n)/30)*(n>k?-1:1);e.setValue(q(m+o,n))}}else{var p=g.round(6*c+15)%12+(I.all(e).meridiem.value?12:0);p!==m&&e.setValue(q(p,k))}},i[h?"touchend":"mouseup"]=function(){a(c.body).off(i),e.execute()},1!==b.which&&1!==(b.originalEvent.touches||"").length||a(c.body).on(i)}),e.setValue(new d)},setValue:function(b,c){var d=b.newValue,e=I.all(c);e.hour.value=j(d)||12,e.minute.value=l(d),e.meridiem.value=j(d)>=12,a('s[hand="h"]',c.element).css("transform","rotate("+(30*j(d)+.5*l(d)-90)+"deg)"),a('s[hand="m"]',c.element).css("transform","rotate("+(6*l(d)-90)+"deg)")},mousewheel:function(a,b){b.setValue(s("minute",b.value,a.data,b.step)),b.mousewheelTimeout=b.mousewheelTimeout||m(function(){b.mousewheelTimeout=null,b.execute()}),a.preventDefault(),a.handled()}});var J={options:{mode:"day",minuteStep:1,min:null,max:null,required:!1,formatDate:null},overrides:{getValue:function(a){return a.selectedDate?r(a.options,a.selectedDate):null},setValue:function(a,b){b=b?r(a.options,b):null,a.selectedDate=b,a.softSelectedDate=null;var c="";if(b){var e=function(c){return F.isFunction(c)&&c(a.options.mode,b)};c=e(a.options.formatDate)||e(t)}c!==this.extractText()&&(this.invoke(function(a){a.selection.selectAll(),a.insertText(c)}),this===y&&(z.calendar=z.clock=a.selectedDate||new d))},hasContent:function(a){return!!this.extractText()},validate:function(a){if(a.options.required&&a.selectedDate)return F.reject("required")}},commands:{step:function(a,b){var c=a.widget.options,e=s("datetime"===c.mode?"minute":c.mode,a.typer.getValue()||new d,b,c.minuteStep);a.typer.setValue(e)}},contentChange:function(a){if(a.typer===y&&"script"!==a.source){var b=new d(a.typer.extractText());isNaN(+b)||(z.calendar=z.clock=r(a.widget.options,b)),a.widget.softSelectedDate=b}},click:function(a){a.typer===y&&z.showMenu(a.typer.element)},mousewheel:function(a){a.typer.invoke("step",a.data),a.preventDefault()},upArrow:function(a){a.typer.invoke("step",-1)},downArrow:function(a){a.typer.invoke("step",1)},escape:function(b){F.containsOrEquals(c,z.element)&&(a(z.element).detach(),b.handled())},focusin:function(a){z||w(),G.retainFocus(a.typer.element,z.element),y=a.typer;var b=a.widget.options,c=a.typer.getValue()||new d;F.extend(z,{mode:b.mode,minuteStep:b.minuteStep,min:b.min,max:b.max,calendar:c,clock:c}),z.update(),z.showMenu(a.typer.element)},focusout:function(a){if(a.typer===y){var b=a.widget.softSelectedDate;a.typer.setValue(!b||isNaN(+b)?a.widget.selectedDate:b),y=null,z.hideMenu()}}};b.UI.define("datepicker",{template:"<z:textbox/>",preventLeave:!0,value:"",preset:J,options:{},init:function(c,e){if(b.IS_TOUCH){var f=e.options.mode||e.preset.options.mode;e.nativeInput=a('<input type="'+E[f]+'">').appendTo(e.element)[0],F.bind(e.nativeInput,"change",function(a){e.setValue(new d(e.nativeInput.valueAsNumber+D*("datetime"===f?1:-1)))})}},focusin:function(a,c){if(b.IS_TOUCH){var e=c.options.mode||c.preset.options.mode;c.nativeInput.valueAsNumber=+(c.value||new d)-D*("datetime"===e?1:-1)}}});var K={setToday:"Today",prevMonth:"Previous month",nextMonth:"Next month",timeSeperator:":",am:"AM",pm:"PM",done:"Done"};e(12,function(a){K[A[a].toLowerCase()]=A[a]}),I.i18n("en",K)}(a,zeta,Date),function(a,b){function d(){t=x.menu(x.dropdown({template:"<z:buttonlist/>",execute:function(a){t.typer.invoke("add",a.value),t.typer.getSelection().focus()},contextChange:function(a,b){b.choices=b.context.suggestions}}),{hideCalloutOnBlur:!1,hideCalloutOnExecute:!1}).render()}function f(a,b){var d=c.createTextNode(b?a:a.replace(/\s/g," ")),e=c.createElement("div");return e.appendChild(d),e.innerHTML}function h(a){return a.value}function i(a){return"object"!=typeof a?{value:a,label:a}:a}function j(a,b){return a.value.localeCompare(b.value)}function l(a,b){return a.options.allowFreeInput||a.knownValues[b]}function n(a,b){return a.length!==b.length||a.some(function(a){return b.indexOf(a)<0})}function o(a,b){a=e(a||"");for(var c=[],d=a.toLowerCase(),f=0,g=-1,h=0;h<b.length;h++){var i=b.charAt(h).toLowerCase();if(" "!=i){if(-1==(f=d.indexOf(i,f)))return{firstIndex:1/0,consecutiveMatches:-1,formattedText:a};c[c.length]=f-g-1,g=f++}}var j=c[0],l=/^(0+)/.test(c.slice(0).sort().join(""))&&k.$1.length,m="";for(f=0,h=0;h<c.length;h++)m+=a.substr(f,c[h])+"**"+a[f+c[h]]+"**",f+=c[h]+1;return m+=a.slice(f),{firstIndex:j,consecutiveMatches:l,formattedText:m.replace(/<\/b><b>/g,"")}}function p(a,b,c){var d=a.options.suggestions||a.options.allowedValues||[];return v.isFunction(d)&&(d=d(b)),v.when(d).then(function(b){return b=b.map(i),b.forEach(function(b){a.knownValues[b.value]=b.label}),c&&(b=b.filter(function(a){return c.indexOf(a.value)<0})),b})}function q(a,b,c){return a=a.filter(function(a){return v.extend(a,o(a.label,b)),[a.value].concat(a.matches||[]).forEach(function(c){var d=o(c,b);a.firstIndex=g.min(a.firstIndex,d.firstIndex),a.consecutiveMatches=g.max(a.consecutiveMatches,d.consecutiveMatches)}),a.firstIndex!==1/0}),a.sort(function(a,b){return b.consecutiveMatches-a.consecutiveMatches+(a.firstIndex-b.firstIndex)||j(a,b)}),a.slice(0,c)}function r(a){var b=a.typer.extractText();p(a,b,a.typer.getValue()).then(function(c){c=q(c,b,a.options.suggestionCount),b&&a.options.allowFreeInput&&c.push({value:b,label:b,formattedText:"*"+b+"*"}),t.suggestions=c.map(function(a){return{value:a.value,label:a.formattedText,icon:a.icon||""}}),t.update()}),t||d(),m(function(){a.typer.focused()&&(w.retainFocus(a.typer.element,t.element),t.typer=a.typer,t.showMenu(a.typer.element))})}function s(a,b){var c=p(a);x.dialog({title:b.label,description:b.placeholder,controls:[x.textbox("newValue",{enter:function(a,b){return b.all.list.append(x.checkbox({label:b.value,entry:b.value,value:!0,description:"new value",before:"*"})),b.execute()},visible:function(){return a.options.allowFreeInput}}),x.buttonlist("list",{templates:{checkbox:'<z:checkbox show-icon="true"/>'}}),x.buttonset(x.submit("done","done"),x.button("cancel","close",function(a){a.all.dialog.destroy()}))],childExecuted:function(a,b){b.value=b.all.list.controls.filter(function(a){return a.value}).map(function(a){return a.entry})},init:function(b,d){var e=a.typer.getValue();d.all.dialog.value=e.slice(0),c.then(function(a){var b=a.map(h);a=a.concat(e.filter(function(a){return b.indexOf(a)<0}).map(i)),a.sort(j),d.all.list.append(a.map(function(a){var b=e.indexOf(a.value)>=0;return x.checkbox({label:a.label,icon:a.icon,entry:a.value,value:b,before:b?"*":""})}))})}}).render().dialog.then(function(b){a.typer.setValue(b)})}var t,u=b.IS_TOUCH,v=b.helper,w=b.dom,x=new b.UI("zeta.ui.keyword"),y={options:{required:!1,allowFreeInput:!0,allowedValues:null,suggestionCount:5,suggestions:!1},overrides:{getValue:function(b){return a("span",this.element).map(function(b,c){return e(a(c).data("value"))}).get()},setValue:function(b,c){c=(a.isArray(c)?c:e(c).split(/\s+/)).filter(function(a){return a}),n(c,this.getValue())&&this.invoke(function(a){a.selection.select(a.typer.element,"contents"),a.insertText(""),c.forEach(function(b){a.typer.invoke("add",b)})})},hasContent:function(){return!(!a("span",this.element)[0]&&!this.extractText())},validate:function(b){return b.options.required&&!this.getValue().length?v.reject("required"):a(".invalid",this.element)[0]?v.reject("invalid-value"):void 0}},widgets:{tag:{element:"span",inline:!0,editable:"none",create:function(a,b){a.insertHtml('<span class="zeta-keyword" data-value="'+f(b.value,!0)+'">'+f(b.label)+"<i>delete</i></span>")},click:function(b){b.target!==b.widget.element&&a(b.widget.element).detach()}}},commands:{add:function(b,c){if(c&&!(b.typer.getValue().indexOf(c.value||c)>=0)){"object"!=typeof c&&(c={value:c,label:b.widget.knownValues[c]||c});var d=a("span:last",b.typer.element)[0];d?b.selection.select(d,!1):b.selection.select(b.typer.element,0),b.insertWidget("tag",c),d=a("span:last",b.typer.element)[0],b.selection.select(v.createRange(d,!1),v.createRange(b.typer.element,-0)),b.insertText(""),l(b.widget,c.value)||a(d).addClass("invalid"),!u&&t&&t.typer===b.typer&&r(b.typer.getStaticWidget("__preset__"))}}},init:function(a){a.typer.getSelection().moveToText(a.typer.element,-0),a.widget.knownValues={}},focusin:function(a){u||r(a.widget)},focusout:function(a){u||(t.hideMenu(),a.typer.invoke("add",a.typer.extractText()))},upArrow:function(a){w.focus(t.element),a.handled()},downArrow:function(a){w.focus(t.element),a.handled()},enter:function(a){a.typer.invoke("add",a.typer.extractText()),a.handled()},escape:function(a){v.containsOrEquals(c,t.element)&&(t.hideMenu(),a.handled())},backspace:function(b){var c=b.typer.getSelection().clone();c.isCaret&&!c.moveByCharacter(-1)&&a("span:last",b.typer.element).remove()},contentChange:function(a){u||"script"===a.source||r(a.widget)}};b.UI.define("keyword",{template:"<z:textbox/>",preventLeave:!0,options:{},value:[],preset:y,init:function(a,b){b.options.required=b.required,b.watch("required",function(a,c,d,e){b.options.required=e}),u&&b.watch("editor",function(a,c,d,e){e.on("click",function(){s(e.getStaticWidget("__preset__"),b)})})}}),x.i18n("en",{newValue:"Enter new value"})}(a,zeta),function(a,b){function c(a,b){b=+b||0;var c=a.options.min,d=a.options.max,g=a.options.loop&&null!==c&&null!==d;if(g&&b<c||!g&&null!==d&&b>d?b=d:(g&&b>d||!g&&null!==c&&b<c)&&(b=c),b=e(+b||0),"fixed"===a.options.digits){var h=e(+a.options.max||0).length;b=(new f(h+1).join("0")+b).substr(-h)}b!==a.typer.extractText()&&a.typer.invoke(function(a){a.selection.selectAll(),a.insertText(b)})}function d(a,b){c(a,(a.typer.getValue()||0)+(b||0)*a.options.step)}var g={validation:{allowChars:"0-9"},options:{max:null,min:null,digits:"auto",step:1,loop:!1},overrides:{getValue:function(a){return parseInt(this.extractText())},setValue:function(a,b){c(a,b)},hasContent:function(){return!!this.extractText()},validate:function(a){return!0}},focusout:function(a){d(a.widget)},mousewheel:function(a){d(a.widget,-a.data),a.handled()},upArrow:function(a){d(a.widget,1),a.handled()},downArrow:function(a){d(a.widget,-1),a.handled()},contentChange:function(a){"keyboard"!==a.source&&d(a.widget)}};b.UI.define("number",{template:"<z:textbox/>",preventLeave:!0,value:0,preset:g})}(0,zeta)}(jQuery,window,document,Object,String,Array,Math,Node,Range,DocumentFragment,RegExp,parseFloat,setTimeout,clearTimeout,new function(){this.Map=window.Map||function(a){function b(a,b){return a.items.indexOf(b)}function c(){var b=this;b.items=[],b.values=[],b._keys=a.Set.prototype._keys}return c.prototype={get size(){return this.items.length},has:function(a){return b(this,a)>=0},get:function(a){var c=b(this,a);return c>=0?this.values[c]:void 0},set:function(a,c){var d=this,e=b(d,c);return d.values[e>=0?e:d.items.push(a)-1]=c,d},delete:function(a){var c=this,d=b(c,a);return d>=0&&(c.items.splice(d,1),c.values.splice(d,1)),d>=0},keys:function(){return this._keys()},values:function(){var a=this;return a._keys(function(b){return a.get(b)})},entries:function(){var a=this;return a._keys(function(b){return[b,a.get(b)]})},forEach:function(a,b){var c=this;c.items.forEach(function(d,e){a.call(b,c.values[e],d,c)})},clear:function(){this.items.splice(0),this.values.splice(0)}},c}(this),this.MutationObserver=window.MutationObserver||function(){function a(a){this.records=[],this.handler=a}return a.prototype={observe:function(a,b){var c=zeta.helper,d=this;c.bind(a,"DOMNodeInserted DOMNodeRemoved DOMAttrModified DOMCharacterDataModified",function(e){var f=e.type.charAt(7),g=e.prevValue,h={};h.addedNodes=[],h.removedNodes=[],"M"===f?(h.type="attributes",h.target=e.target,h.attributeName=e.attrName,b.attributeOldValue&&(h.oldValue=g)):"a"===f?(h.type="characterData",h.target=e.target,b.characterDataOldValue&&(h.oldValue=g)):(h.type="childList",h.target=e.target.parentNode,h["I"===f?"addedNodes":"removedNodes"][0]=e.target);var i=!1;c.each(d.records,function(a,b){return!(i|="childList"===b.type&&b.addedNodes.some(function(a){return c.containsOrEquals(a,h.target)}))}),i||!b[h.type]||!b.subtree&&h.target!==a||(d.records[d.records.length]=h,clearTimeout(d.timeout),d.timeout=setTimeout(function(){d.handler(d.takeRecords(),d)}))})},takeRecords:function(){return this.records.splice(0)}},a}(),this.Set=window.Set||function(){function a(a,b){var c=this;c.items=a,c.index=-1,c.callback=b||function(a){return a}}function b(){this.items=[]}return a.prototype={next:function(){var a=this;return++a.index<a.items.length?{value:a.callback(a.items[a.index],a.index),done:!1}:{value:void 0,done:!0}}},b.prototype={get size(){return this.items.length},has:function(a){return this.items.indexOf(a)>=0},add:function(a){var b=this.items;return b.indexOf(a)<0&&b.push(a),this},delete:function(a){var b=this.items.indexOf(a);return b>=0&&this.items.splice(b,1),b>=0},keys:function(){return this._keys()},values:function(){return this._keys()},entries:function(){return this._keys(function(a){return[a,a]})},forEach:function(a,b){var c=this;c.items.forEach(function(d){a.call(b,d,d,c)})},clear:function(){this.items.splice(0)},_keys:function(b){return new a(this.items,b)}},b}(),this.WeakMap=window.WeakMap||function(){function a(){this.key="__WeakMap"+ ++c}var b,c=0,d=0;return a.prototype={get:function(a){if(this.has(a))try{if(d=1,a[this.key](),2!==d)throw new Error("Invalid operation");var c=b;return b=null,c}finally{d=0}},set:function(a,c){return Object.defineProperty(a,this.key,{configurable:!0,value:function(){1===d&&(b=c,d=2)}}),this},has:function(a){return a&&Object.hasOwnProperty.call(a,this.key)},delete:function(a){var b=this.has(a);return b&&delete a[this.key],b}},a}()});
//# sourceMappingURL=zeta-ui.min.js.map
